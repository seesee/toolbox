<!doctype html><html lang="en-GB"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="favicon.ico" type="image/x-icon"><title>Activity Tracker</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);min-height:100vh;color:#333}.container{max-width:1200px;margin:0 auto;padding:20px}.header{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 8px 32px rgba(0,0,0,.1)}.nav{display:flex;gap:15px;margin-top:15px}.nav-btn{padding:10px 20px;border:none;background:#667eea;color:#fff;border-radius:8px;cursor:pointer;font-weight:500}.nav-btn:hover{background:#5a67d8;transform:translateY(-2px)}.nav-btn.active{background:#4c51bf;box-shadow:0 4px 15px rgba(76,81,191,.4)}.section{display:none;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:15px;padding:30px;box-shadow:0 8px 32px rgba(0,0,0,.1)}.section.active{display:block}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#4a5568}.form-group input,.form-group select,.form-group textarea{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:border-color .3s}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;transition:.3s;margin-right:10px;margin-bottom:10px}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5a67d8;transform:translateY(-2px)}.btn-secondary{background:#718096;color:#fff}.btn-secondary:hover{background:#4a5568}.btn-danger{background:#e53e3e;color:#fff}.btn-danger:hover{background:#c53030}.btn-success{background:#38a169;color:#fff}.btn-success:hover{background:#2f855a}.entries-list{margin-top:30px}.entry-item{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:flex-start}.entry-content{flex:1}.entry-time{font-weight:600;color:#667eea;margin-bottom:5px}.entry-activity{font-size:18px;margin-bottom:5px}.entry-description{color:#718096;font-size:14px}.entry-description .md-paragraph{margin:5px 0}.entry-description .md-list{margin:5px 0;padding-left:20px}.entry-description .md-blockquote{margin:8px 0;padding:5px 10px;font-size:13px}.entry-description .md-code{font-size:12px}.entry-actions{display:flex;gap:10px}.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px}.settings-section{background:#f7fafc;padding:20px;border-radius:8px;border:1px solid #e2e8f0}.settings-section h3{margin-bottom:15px;color:#2d3748}.checkbox-group{display:flex;align-items:center;margin-bottom:10px}.checkbox-group input[type=checkbox]{width:auto;margin-right:10px}.notification-status{padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:600}.notification-enabled{background:#c6f6d5;color:#22543d}.notification-disabled{background:#fed7d7;color:#742a2a}.notification-warning{background:#fef5e7;color:#744210}.report-filters{background:#f7fafc;padding:20px;border-radius:8px;margin-bottom:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;align-items:end}.report-summary{background:#e6fffa;padding:20px;border-radius:8px;margin-bottom:20px;border-left:4px solid #38b2ac}.report-navigation{display:flex;gap:10px;align-items:center;margin-bottom:20px}.week-display{background:#f7fafc;padding:10px 15px;border-radius:8px;font-weight:600;min-width:200px;text-align:center}.download-section{background:#f0fff4;padding:20px;border-radius:8px;margin-top:20px;border-left:4px solid #38a169}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000}.modal.active{display:flex;align-items:center;justify-content:center}.modal-content{background:#fff;padding:30px;border-radius:15px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto}.status-indicator{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:8px}.status-active{background:#48bb78}.status-inactive{background:#f56565}.notification-buttons{display:flex;gap:10px;flex-wrap:wrap}.debug-info{background:#f7fafc;padding:15px;border-radius:8px;margin-top:15px;font-family:monospace;font-size:14px;border-left:4px solid #667eea}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.markdown-preview{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin:15px 0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6}.markdown-preview .md-h1{color:#2d3748;border-bottom:2px solid #667eea;padding-bottom:10px;margin:20px 0 15px}.markdown-preview .md-h2{color:#2d3748;border-bottom:1px solid #e2e8f0;padding-bottom:5px;margin:18px 0 12px}.markdown-preview .md-h3{color:#4a5568;margin:15px 0 10px}.markdown-preview .md-blockquote{border-left:4px solid #667eea;margin:15px 0;color:#718096;font-style:italic;background:rgba(102,126,234,.05);padding:10px 15px;border-radius:0 4px 4px 0}.markdown-preview .md-code{background:#edf2f7;padding:2px 6px;border-radius:4px;font-family:Monaco,Consolas,monospace;font-size:14px}.markdown-preview .md-list{margin:10px 0;padding-left:30px}.markdown-preview .md-paragraph{margin:10px 0}.markdown-preview .md-hr{border:none;border-top:1px solid #e2e8f0;margin:20px 0}.markdown-preview .md-preview-more{color:#718096;font-style:italic;text-align:center;margin:15px 0 5px}.md-paragraph{margin:8px 0}.md-paragraph:first-child{margin-top:0}.md-paragraph:last-child{margin-bottom:0}.md-list{margin:8px 0}.md-list li{margin:3px 0}.md-blockquote{margin:8px 0}.report-format-tabs{display:flex;margin-bottom:15px;border-bottom:1px solid #e2e8f0}.format-tab{padding:10px 20px;border:none;background:0 0;cursor:pointer;font-weight:600;color:#718096;border-bottom:2px solid transparent;transition:.3s}.format-tab:hover{color:#4a5568}.format-tab.active{color:#667eea;border-bottom-color:#667eea}.nav-btn{transition:.3s,background 1s ease-out}@media (max-width:768px){.container{padding:10px}.nav{flex-wrap:wrap}.entry-item{flex-direction:column;gap:15px}.entry-actions{align-self:flex-end}.report-navigation{flex-wrap:wrap}.week-display{min-width:150px}}</style></head><body><div class="container"><div class="header"><h1>Activity Tracker</h1><p>Track your daily activities with automatic reminders</p><div class="nav"><button class="nav-btn active" onclick="showSection('tracker', event)">Tracker</button> <button class="nav-btn" onclick="showSection('reports', event)">Reports</button> <button class="nav-btn" onclick="showSection('settings', event)">Settings</button> <button id="pauseButton" class="nav-btn" onclick="togglePause()">Pause Alerts</button></div></div><div id="tracker" class="section active"><h2>Activity Entry</h2><form id="activityForm"><div class="form-group"><label for="activity">What are you doing?</label> <input id="activity" required placeholder="e.g., Writing report, Meeting with team" autocomplete="off"></div><div class="form-group"><label for="description">Description (optional)</label> <textarea id="description" rows="3" placeholder="Additional details about this activity"></textarea></div><div class="form-group"><label for="timestamp">Time</label> <input type="datetime-local" id="timestamp" required></div><button type="submit" class="btn btn-primary">Add Entry</button> <button type="button" class="btn btn-secondary" onclick="addCurrentTime()">Use Current Time</button></form><div class="entries-list"><h3>Recent Entries</h3><div id="entriesList"></div></div></div><div id="reports" class="section"><h2>Activity Reports</h2><div class="report-navigation"><button class="btn btn-secondary" onclick="previousWeek()">← Previous Week</button><div class="week-display" id="weekDisplay">Week of ...</div><button class="btn btn-secondary" onclick="nextWeek()">Next Week →</button></div><div class="report-filters"><div class="form-group"><label for="reportStartDate">Start Date</label> <input type="date" id="reportStartDate"></div><div class="form-group"><label for="reportEndDate">End Date</label> <input type="date" id="reportEndDate"></div><div class="form-group"><label>&nbsp;</label> <button class="btn btn-primary" onclick="generateReport()">Generate Report</button> <button class="btn btn-secondary" onclick="setWeeklyReport()">This Week</button></div></div><div class="download-section"><h3>Download Report</h3><p>Generate and download the current report in your preferred format</p><div style="margin-top:15px"><div class="form-group" style="display:inline-block;width:200px;margin-right:15px"><select id="downloadFormat"><option value="html">HTML Report</option><option value="markdown">Markdown</option><option value="csv">CSV (with timings)</option></select></div><button class="btn btn-success" onclick="downloadReport()">Download Report</button></div></div><div id="reportResults"></div></div><div id="settings" class="section"><h2>Settings</h2><div class="notification-status" id="notificationStatus"><span class="status-indicator" id="statusIndicator"></span> <span id="statusText">Checking notification status...</span></div><div class="settings-grid"><div class="settings-section"><h3>Notification Settings</h3><div class="notification-buttons"><button class="btn btn-primary" onclick="enableNotifications()">Enable Notifications</button> <button class="btn btn-secondary" onclick="testNotification()">Test Notification</button> <button class="btn btn-secondary" onclick="refreshNotificationStatus()">Refresh Status</button> <button class="btn btn-secondary" onclick="testNotificationSound()">Test Sound</button></div><div class="form-group"><label for="notificationInterval">Reminder Interval (minutes)</label> <select id="notificationInterval"><option value="1">1 minute</option><option value="2">2 minutes</option><option value="5">5 minutes</option><option value="15">15 minutes</option><option value="30">30 minutes</option><option value="60" selected="selected">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option></select></div><div class="form-group"><label for="pauseDuration">Auto-resume alerts after</label> <select id="pauseDuration"><option value="15">15 minutes</option><option value="60">1 hour</option><option value="240">4 hours</option><option value="1440">24 hours</option><option value="-1">Never</option></select></div><div class="form-group"><label for="notificationSoundType">Notification Sound</label> <select id="notificationSoundType"><option value="classic">Classic Bloop</option><option value="gentle">Gentle Chime</option><option value="urgent">Urgent Ping</option><option value="digital">Digital Beep</option><option value="nature">Nature Drop</option><option value="mechanical">Mechanical Click</option><option value="spacey">Spacey Wobble</option><option value="corporate">Corporate Ding</option></select></div><div class="checkbox-group"><input type="checkbox" id="muteNotificationSound"> <label for="muteNotificationSound">Mute notification sound</label></div><div class="debug-info" id="debugInfo"><strong>Debug Information:</strong><br><span id="debugText">Loading...</span></div></div><div class="settings-section"><h3>Working Hours</h3><div class="form-group"><label for="startTime">Start Time</label> <input type="time" id="startTime" value="08:00"></div><div class="form-group"><label for="endTime">End Time</label> <input type="time" id="endTime" value="18:00"></div></div><div class="settings-section"><h3>Working Days</h3><div class="checkbox-group"><input type="checkbox" id="monday" checked="checked"> <label for="monday">Monday</label></div><div class="checkbox-group"><input type="checkbox" id="tuesday" checked="checked"> <label for="tuesday">Tuesday</label></div><div class="checkbox-group"><input type="checkbox" id="wednesday" checked="checked"> <label for="wednesday">Wednesday</label></div><div class="checkbox-group"><input type="checkbox" id="thursday" checked="checked"> <label for="thursday">Thursday</label></div><div class="checkbox-group"><input type="checkbox" id="friday" checked="checked"> <label for="friday">Friday</label></div><div class="checkbox-group"><input type="checkbox" id="saturday"> <label for="saturday">Saturday</label></div><div class="checkbox-group"><input type="checkbox" id="sunday"> <label for="sunday">Sunday</label></div></div></div><button class="btn btn-primary" onclick="saveSettings()">Save Settings</button> <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button></div></div><div id="editModal" class="modal"><div class="modal-content"><h3>Edit Entry</h3><form id="editForm"><input type="hidden" id="editId"><div class="form-group"><label for="editActivity">Activity</label> <input id="editActivity" required></div><div class="form-group"><label for="editDescription">Description</label> <textarea id="editDescription" rows="3"></textarea></div><div class="form-group"><label for="editTimestamp">Time</label> <input type="datetime-local" id="editTimestamp" required></div><button type="submit" class="btn btn-primary">Update Entry</button> <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button></form></div></div><script>function formatDateTime(t){return new Date(t).toLocaleString("en-GB",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function formatDate(t){return t.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function formatTime(t){return new Date(t).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}function escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function showNotification(t,e="info"){const n=document.createElement("div");n.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        padding: 15px 20px;\n        border-radius: 8px;\n        color: white;\n        font-weight: 600;\n        z-index: 10000;\n        background: ${"success"===e?"#48bb78":"error"===e?"#f56565":"#667eea"};\n        box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n        animation: slideIn 0.3s ease-out;\n    `;const i=document.createElement("style");i.textContent="\n        @keyframes slideIn {\n            from {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            to {\n                transform: translateX(0);\n                opacity: 1;\n            }\n        }\n        @keyframes slideOut {\n            from {\n                transform: translateX(0);\n                opacity: 1;\n            }\n            to {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n        }\n    ",document.head.appendChild(i),n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{n.parentNode&&n.remove()},300)},3e3)}function downloadFile(t,e,n){const i=new Blob([t],{type:n}),a=URL.createObjectURL(i),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}function getCurrentTimeForInput(){const t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}function escapeCsv(t){return t?t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t:""}function generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}function isValidDate(t){const e=new Date(t);return e instanceof Date&&!isNaN(e)}function getWeekStart(t){const e=new Date(t),n=t.getDay(),i=0===n?-6:1-n;return e.setDate(t.getDate()+i),e.setHours(0,0,0,0),e}function getWeekEnd(t){const e=new Date(getWeekStart(t));return e.setDate(e.getDate()+6),e.setHours(23,59,59,999),e}function deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>deepClone(t));if("object"==typeof t){const e={};return Object.keys(t).forEach(n=>{e[n]=deepClone(t[n])}),e}}class SoundManager{constructor(){this.audioContext=null,this.soundTypes={classic:"Classic Bloop",gentle:"Gentle Chime",urgent:"Urgent Ping",digital:"Digital Beep",nature:"Nature Drop",mechanical:"Mechanical Click",spacey:"Spacey Wobble",corporate:"Corporate Ding"},this.initAudioContext()}initAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.warn("Web Audio API not supported:",t),this.audioContext=null}}getSoundTypes(){return this.soundTypes}playSound(t="classic",e=!1){if(this.audioContext&&!e)try{"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext.currentTime;switch(t){case"classic":default:this.playClassicBloop(e);break;case"gentle":this.playGentleChime(e);break;case"urgent":this.playUrgentPing(e);break;case"digital":this.playDigitalBeep(e);break;case"nature":this.playNatureDrop(e);break;case"mechanical":this.playMechanicalClick(e);break;case"spacey":this.playSpaceyWobble(e);break;case"corporate":this.playCorporateDing(e)}}catch(t){console.warn("Error playing notification sound:",t)}}playClassicBloop(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(400,t),e.frequency.exponentialRampToValueAtTime(600,t+.1),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playGentleChime(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",n.type="sine",e.frequency.setValueAtTime(523.25,t),n.frequency.setValueAtTime(659.25,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.2,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+1),e.start(t),n.start(t),e.stop(t+1),n.stop(t+1)}playUrgentPing(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(1200,t+.05),e.frequency.exponentialRampToValueAtTime(800,t+.1),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.4,t+.02),n.gain.exponentialRampToValueAtTime(.01,t+.15),e.start(t),e.stop(t+.15)}playDigitalBeep(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),n.connect(this.audioContext.destination),e.type="square",e.frequency.setValueAtTime(1e3,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.3,t+.01),n.gain.linearRampToValueAtTime(.3,t+.05),n.gain.linearRampToValueAtTime(0,t+.06),e.start(t),e.stop(t+.06)}playNatureDrop(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(1200,t),e.frequency.exponentialRampToValueAtTime(200,t+.8),i.type="lowpass",i.frequency.setValueAtTime(2e3,t),i.frequency.exponentialRampToValueAtTime(300,t+.8),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.25,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+.8),e.start(t),e.stop(t+.8)}playMechanicalClick(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();e.connect(i),i.connect(n),n.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(150,t),i.type="highpass",i.frequency.setValueAtTime(100,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.5,t+.005),n.gain.linearRampToValueAtTime(0,t+.05),e.start(t),e.stop(t+.05)}playSpaceyWobble(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain(),a=this.audioContext.createGain();n.connect(i),i.connect(e.frequency),e.connect(a),a.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(300,t),n.type="sine",n.frequency.setValueAtTime(6,t),i.gain.setValueAtTime(50,t),a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(.3,t+.1),a.gain.exponentialRampToValueAtTime(.01,t+1.2),n.start(t),e.start(t),n.stop(t+1.2),e.stop(t+1.2)}playCorporateDing(t){const e=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",n.type="sine",e.frequency.setValueAtTime(880,t),n.frequency.setValueAtTime(1108.73,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.25,t+.02),i.gain.exponentialRampToValueAtTime(.01,t+.5),e.start(t),n.start(t),e.stop(t+.5),n.stop(t+.5)}testSound(t,e=!1){this.playSound(t,e)}}"undefined"!=typeof window&&(window.SoundManager=SoundManager);class PauseManager{constructor(t){this.tracker=t,this.countdownInterval=null,this.pauseButton=null,this.originalButtonText="Pause Alerts",this.init()}init(){this.pauseButton=document.getElementById("pauseButton"),this.pauseButton&&this.updatePauseButtonDisplay()}startPause(t){this.stopCountdown(),-1===t?(this.tracker.settings.notificationsPausedUntil=1/0,this.updatePauseButtonForever()):(this.tracker.settings.notificationsPausedUntil=(new Date).getTime()+60*t*1e3,this.startCountdown()),this.tracker.saveSettings()}resume(){this.stopCountdown(),this.tracker.settings.notificationsPausedUntil=null,this.updatePauseButtonNormal(),this.tracker.saveSettings()}startCountdown(){this.countdownInterval&&clearInterval(this.countdownInterval),this.updateCountdownDisplay(),this.countdownInterval=setInterval(()=>{this.updateCountdownDisplay()},1e3)}stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}updateCountdownDisplay(){if(!this.pauseButton||!this.tracker.settings.notificationsPausedUntil)return void this.updatePauseButtonNormal();const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil;if(e===1/0)return void this.updatePauseButtonForever();const n=e-t;if(n<=0)return this.resume(),void showNotification("Notifications automatically resumed","success");const i=Math.floor(n/1e3),a=Math.floor(i/3600),o=Math.floor(i%3600/60),r=i%60;let s;s=a>0?`${a}h ${o}m ${r}s`:o>0?`${o}m ${r}s`:`${r}s`,this.pauseButton.textContent=`Resume (${s})`;const c=60*this.tracker.settings.pauseDuration*1e3,d=c-n,l=Math.max(0,Math.min(100,d/c*100));this.applyDrainingEffect(l)}applyDrainingEffect(t){const e="rgba(229, 62, 62, 0.3)",n="#e53e3e";this.pauseButton.style.background=`linear-gradient(to top, ${e} 0%, ${e} ${t}%, ${n} ${t}%, ${n} 100%)`,this.pauseButton.style.transition="background 1s ease-out",this.pauseButton.style.animation=t>90?"pulse 1s infinite":"none"}updatePauseButtonForever(){this.pauseButton.textContent="Resume (Paused Forever)",this.pauseButton.style.background="#e53e3e",this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}updatePauseButtonNormal(){this.pauseButton.textContent=this.originalButtonText,this.pauseButton.style.background="",this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}updatePauseButtonDisplay(){this.pauseButton&&(this.tracker.settings.notificationsPausedUntil?this.tracker.settings.notificationsPausedUntil===1/0?this.updatePauseButtonForever():this.startCountdown():this.updatePauseButtonNormal())}isPaused(){return!!this.tracker.settings.notificationsPausedUntil&&(this.tracker.settings.notificationsPausedUntil===1/0||(new Date).getTime()<this.tracker.settings.notificationsPausedUntil)}getRemainingTime(){if(!this.tracker.settings.notificationsPausedUntil)return 0;if(this.tracker.settings.notificationsPausedUntil===1/0)return-1;const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil-t;return Math.max(0,e)}destroy(){this.stopCountdown()}}"undefined"!=typeof window&&(window.PauseManager=PauseManager);class MarkdownRenderer{constructor(){this.rules=[{pattern:/^### (.*$)/gim,replacement:"<h3>$1</h3>"},{pattern:/^## (.*$)/gim,replacement:"<h2>$1</h2>"},{pattern:/^# (.*$)/gim,replacement:"<h1>$1</h1>"},{pattern:/\*\*(.*)\*\*/gim,replacement:"<strong>$1</strong>"},{pattern:/\*(.*)\*/gim,replacement:"<em>$1</em>"},{pattern:/`(.*)`/gim,replacement:"<code>$1</code>"},{pattern:/\[([^\]]*)\]\(([^\)]*)\)/gim,replacement:'<a href="$2">$1</a>'},{pattern:/^---\s*$/gim,replacement:"<hr>"},{pattern:/^> (.*)$/gim,replacement:"<blockquote>$1</blockquote>"},{pattern:/^\- (.*)$/gim,replacement:"<li>$1</li>"}]}render(t,e=!1){if(!t||"string"!=typeof t)return"";let n=t.trim();return this.rules.forEach(t=>{n=n.replace(t.pattern,t.replacement)}),n=n.replace(/\n\s*\n/gim,"</p><p>"),n=n.replace(/\n(?![<\/])/gim,"<br>"),e&&n.match(/^<(h[1-6]|ul|ol|blockquote|hr)/)||(n="<p>"+n+"</p>"),n=n.replace(/<p>\s*<\/p>/gim,""),n=n.replace(/<p><h/gim,"<h"),n=n.replace(/<\/h([1-6])><\/p>/gim,"</h$1>"),n=n.replace(/<p><hr><\/p>/gim,"<hr>"),n=n.replace(/<p><blockquote>/gim,"<blockquote>"),n=n.replace(/<\/blockquote><\/p>/gim,"</blockquote>"),n=n.replace(/<p><ul>/gim,"<ul>"),n=n.replace(/<\/ul><\/p>/gim,"</ul>"),n=this.renderLists(n),n=n.replace(/<br>\s*<\/li>/gim,"</li>"),n=n.replace(/<li><br>/gim,"<li>"),n=n.replace(/<\/ul><br>/gim,"</ul>"),n=n.replace(/<br><ul>/gim,"<ul>"),n}renderLists(t){return(t=(t=(t=(t=(t=(t=t.replace(/(<li>.*?<\/li>)(\s*(<br>)?\s*<li>.*?<\/li>)*/gim,t=>(t.replace(/<br>\s*(?=<li>)/gim,""),"<ul>"+t+"</ul>"))).replace(/<p><ul>/gim,"<ul>")).replace(/<\/ul><\/p>/gim,"</ul>")).replace(/<p><li>/gim,"<li>")).replace(/<\/li><\/p>/gim,"</li>")).replace(/<br>\s*<ul>/gim,"<ul>")).replace(/<\/ul>\s*<br>/gim,"</ul>")}renderInline(t){return this.render(t,!0)}renderWithClasses(t,e=!1){let n=this.render(t,e);return n=n.replace(/<h1>/gim,'<h1 class="md-h1">'),n=n.replace(/<h2>/gim,'<h2 class="md-h2">'),n=n.replace(/<h3>/gim,'<h3 class="md-h3">'),n=n.replace(/<blockquote>/gim,'<blockquote class="md-blockquote">'),n=n.replace(/<code>/gim,'<code class="md-code">'),n=n.replace(/<ul>/gim,'<ul class="md-list">'),n=n.replace(/<p>/gim,'<p class="md-paragraph">'),n=n.replace(/<hr>/gim,'<hr class="md-hr">'),n}renderInlineWithClasses(t){return this.renderWithClasses(t,!0)}preview(t,e=10){if(!t)return"";const n=t.split("\n").slice(0,e),i=n.join("\n");return n.length>=e&&t.split("\n").length>e?this.renderWithClasses(i)+'<p class="md-preview-more">...</p>':this.renderWithClasses(i)}}"undefined"!=typeof window&&(window.MarkdownRenderer=MarkdownRenderer);class ActivityTracker{constructor(){let t=[];try{const e=JSON.parse(localStorage.getItem("activityEntries"));Array.isArray(e)&&(t=e.filter(t=>t&&"object"==typeof t&&t.timestamp))}catch(t){console.error("Error parsing activity entries from localStorage",t),localStorage.removeItem("activityEntries")}this.entries=t,this.settings={notificationInterval:60,startTime:"08:00",endTime:"18:00",workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},pauseDuration:60,notificationsPausedUntil:null,muteNotificationSound:!1,notificationSoundType:"classic",...JSON.parse(localStorage.getItem("activitySettings")||"{}")},this.notificationTimer=null,this.currentReportEntries=[],this.currentWeekStart=null,this.soundManager=null,this.pauseManager=null,this.init()}init(){this.loadSettings(),this.initMarkdownRenderer(),this.displayEntries(),this.updateNotificationStatus(),this.updateDebugInfo(),this.updatePauseButtonState(),this.startNotificationTimer(),this.setDefaultReportDates(),this.initSoundManager(),this.initPauseManager(),this.attachEventListeners(),this.setCurrentTime(),document.getElementById("activity").focus(),"file:"===window.location.protocol&&console.warn("Running from local file - notifications may have limitations")}initMarkdownRenderer(){try{this.markdownRenderer=new MarkdownRenderer}catch(t){console.warn("Markdown Renderer initialization failed:",t)}}initPauseManager(){try{this.pauseManager=new PauseManager(this)}catch(t){console.warn("Pause Manager initialization failed:",t)}}attachEventListeners(){document.getElementById("activityForm").addEventListener("submit",t=>{t.preventDefault(),this.addEntry()}),document.getElementById("editForm").addEventListener("submit",t=>{t.preventDefault(),this.updateEntry()})}initSoundManager(){try{this.soundManager=new SoundManager}catch(t){console.warn("Sound Manager failed to initialise:",t)}}playNotificationSound(){this.soundManager&&this.soundManager.playSound(this.settings.notificationSoundType,this.settings.muteNotificationSound)}testNotificationSound(){this.soundManager&&this.soundManager.playSound(this.settings.notificationSoundType,this.settings.muteNotificationSound),showNotification("Test sound played!","success")}addEntry(t){let e=t;if(!e){const t=document.getElementById("activity").value,n=document.getElementById("description").value,i=document.getElementById("timestamp").value;e={id:generateId(),activity:t,description:n,timestamp:new Date(i).toISOString(),created:(new Date).toISOString()}}this.entries.unshift(e),this.saveEntries(),this.displayEntries(),t||(document.getElementById("activityForm").reset(),this.setCurrentTime()),showNotification("Entry added successfully!","success")}updateEntry(){const t=document.getElementById("editId").value,e=document.getElementById("editActivity").value,n=document.getElementById("editDescription").value,i=document.getElementById("editTimestamp").value,a=this.entries.findIndex(e=>e.id===t);-1!==a&&(this.entries[a]={...this.entries[a],activity:e,description:n,timestamp:new Date(i).toISOString()},this.saveEntries(),this.displayEntries(),this.closeEditModal(),showNotification("Entry updated successfully!","success"))}deleteEntry(t){confirm("Are you sure you want to delete this entry?")&&(this.entries=this.entries.filter(e=>e.id!==t),this.saveEntries(),this.displayEntries(),showNotification("Entry deleted successfully!","success"))}editEntry(t){const e=this.entries.find(e=>e.id===t);e&&(document.getElementById("editId").value=e.id,document.getElementById("editActivity").value=e.activity,document.getElementById("editDescription").value=e.description||"",document.getElementById("editTimestamp").value=new Date(e.timestamp).toISOString().slice(0,16),document.getElementById("editModal").classList.add("active"))}closeEditModal(){document.getElementById("editModal").classList.remove("active")}displayEntries(){const t=document.getElementById("entriesList"),e=this.entries.slice(0,20);0!==e.length?t.innerHTML=e.map(t=>`\n            <div class="entry-item">\n                <div class="entry-content">\n                    <div class="entry-time">${formatDateTime(t.timestamp)}</div>\n                    <div class="entry-activity">${escapeHtml(t.activity)}</div>\n                    ${t.description?`<div class="entry-description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                </div>\n                <div class="entry-actions">\n                    <button class="btn btn-secondary" onclick="tracker.editEntry('${t.id}')">Edit</button>\n                    <button class="btn btn-danger" onclick="tracker.deleteEntry('${t.id}')">Delete</button>\n                </div>\n            </div>\n        `).join(""):t.innerHTML="<p>No entries yet. Add your first activity above!</p>"}renderDescriptionMarkdown(t){return this.markdownRenderer||void 0===MarkdownRenderer||this.initMarkdownRenderer(),this.markdownRenderer&&t?this.markdownRenderer.renderInlineWithClasses(t):escapeHtml(t)}saveEntries(){localStorage.setItem("activityEntries",JSON.stringify(this.entries))}saveSettings(){this.settings={...this.settings,notificationInterval:parseInt(document.getElementById("notificationInterval").value),startTime:document.getElementById("startTime").value,endTime:document.getElementById("endTime").value,pauseDuration:parseInt(document.getElementById("pauseDuration").value),muteNotificationSound:document.getElementById("muteNotificationSound").checked,notificationSoundType:document.getElementById("notificationSoundType").value,workingDays:{monday:document.getElementById("monday").checked,tuesday:document.getElementById("tuesday").checked,wednesday:document.getElementById("wednesday").checked,thursday:document.getElementById("thursday").checked,friday:document.getElementById("friday").checked,saturday:document.getElementById("saturday").checked,sunday:document.getElementById("sunday").checked}},localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.startNotificationTimer(),showNotification("Settings saved successfully!","success")}loadSettings(){document.getElementById("notificationInterval").value=this.settings.notificationInterval,document.getElementById("startTime").value=this.settings.startTime,document.getElementById("endTime").value=this.settings.endTime,document.getElementById("pauseDuration").value=this.settings.pauseDuration,document.getElementById("muteNotificationSound").checked=this.settings.muteNotificationSound,document.getElementById("notificationSoundType").value=this.settings.notificationSoundType,Object.entries(this.settings.workingDays).forEach(([t,e])=>{document.getElementById(t).checked=e})}async enableNotifications(){if(!("Notification"in window)||!("serviceWorker"in navigator))return alert("This browser does not support notifications or service workers."),void this.updateDebugInfo();try{const t=await Notification.requestPermission();setTimeout(()=>{this.updateNotificationStatus(),this.updateDebugInfo()},500),"granted"===t?(showNotification("Notifications enabled successfully!","success"),this.startNotificationTimer(),setTimeout(()=>{this.testNotification(!0)},1e3)):showNotification("denied"===t?"Notifications were denied. Please check your browser settings and try again.":"Notification permission was not granted. Please try again.","error")}catch(t){console.error("Error requesting notification permission:",t),showNotification("Error requesting notification permission: "+t.message,"error"),this.updateDebugInfo()}}async showNotificationWithServiceWorker(t,e){if(!("serviceWorker"in navigator)||!("Notification"in window))return;const n=await navigator.serviceWorker.ready;await n.showNotification(t,e)}testNotification(t=!1){if(this.updateDebugInfo(),this.playNotificationSound(),"granted"===Notification.permission)try{const e={body:"This is a test notification. If you can see this, notifications are working correctly!",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"test-notification",requireInteraction:!1,actions:[{action:"reply",type:"text",title:"Log Activity",placeholder:"e.g. coding"}]};this.showNotificationWithServiceWorker("Activity Tracker Test",e),t||showNotification("Test notification sent successfully!","success")}catch(t){console.error("Error creating test notification:",t),showNotification("Error creating test notification: "+t.message,"error"),this.updateDebugInfo()}else t||showNotification("Please enable notifications first! Current permission: "+Notification.permission,"error")}refreshNotificationStatus(){this.updateNotificationStatus(),this.updateDebugInfo(),showNotification("Notification status refreshed","success")}updateNotificationStatus(){const t=document.getElementById("notificationStatus"),e=document.getElementById("statusIndicator"),n=document.getElementById("statusText");if("Notification"in window)switch(Notification.permission){case"granted":t.className="notification-status notification-enabled",e.className="status-indicator status-active",n.textContent="Notifications are enabled and working";break;case"denied":t.className="notification-status notification-disabled",e.className="status-indicator status-inactive",n.textContent="Notifications are blocked - please enable them in browser settings";break;default:t.className="notification-status notification-warning",e.className="status-indicator status-inactive",n.textContent='Notifications are disabled - click "Enable Notifications" to activate'}else t.className="notification-status notification-disabled",e.className="status-indicator status-inactive",n.textContent="Notifications not supported in this browser";"file:"===window.location.protocol&&(t.className="notification-status notification-warning",n.textContent+=" (Note: Running from local file may limit notification functionality)")}updateDebugInfo(){const t=document.getElementById("debugText"),e=[];e.push(`Browser: ${navigator.userAgent.split(" ").slice(-2).join(" ")}`),e.push(`Protocol: ${window.location.protocol}`),e.push("Notification API: "+("Notification"in window?"Available":"Not Available")),"Notification"in window&&(e.push(`Permission: ${Notification.permission}`),e.push(`Max Actions: ${Notification.maxActions||"Unknown"}`)),e.push("Service Worker: "+("serviceWorker"in navigator?"Available":"Not Available")),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&e.push(`SW State: ${navigator.serviceWorker.controller.state}`),e.push("Web Audio API: "+(this.audioContext?"Available":"Not Available")),e.push("Sound Muted: "+(this.settings.muteNotificationSound?"Yes":"No")),e.push(`Sound Type: ${this.settings.notificationSoundType}`),e.push(`Last Updated: ${(new Date).toLocaleTimeString("en-GB")}`),t.innerHTML=e.join("<br>")}startNotificationTimer(){this.notificationTimer&&clearInterval(this.notificationTimer),this.notificationTimer=setInterval(()=>{this.checkForNotification()},6e4)}checkForNotification(){if(this.settings.notificationsPausedUntil){if((new Date).getTime()<this.settings.notificationsPausedUntil)return;this.unpauseNotifications(!1)}if("granted"!==Notification.permission)return;const t=new Date,e=60*t.getHours()+t.getMinutes(),n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()];if(!this.settings.workingDays[n])return;const[i,a]=this.settings.startTime.split(":").map(Number),[o,r]=this.settings.endTime.split(":").map(Number);if(e<60*i+a||e>60*o+r)return;const s=localStorage.getItem("lastNotificationTime"),c=t.getTime()-(s||0),d=60*this.settings.notificationInterval*1e3;d>0&&c>=d&&(this.showActivityReminder(),localStorage.setItem("lastNotificationTime",t.getTime().toString()))}showActivityReminder(){this.playNotificationSound();try{const t={body:"What are you working on right now?",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"activity-reminder",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Log Activity",placeholder:"e.g. coding"}]};this.showNotificationWithServiceWorker("Activity Tracker Reminder",t)}catch(t){console.error("Error showing activity reminder:",t)}}setCurrentTime(){const t=document.getElementById("timestamp");t&&(t.value=getCurrentTimeForInput())}togglePause(t=!0){if(this.settings.notificationsPausedUntil)this.pauseManager?this.pauseManager.resume():this.unpauseNotifications(t);else if(this.pauseManager)this.pauseManager.startPause(this.settings.pauseDuration);else{const t=this.settings.pauseDuration;this.settings.notificationsPausedUntil=-1===t?1/0:(new Date).getTime()+60*t*1e3,this.updatePauseButtonState(),this.saveSettings()}t&&showNotification(this.settings.notificationsPausedUntil?"Notifications paused":"Notifications resumed",this.settings.notificationsPausedUntil?"info":"success")}unpauseNotifications(t=!0){this.settings.notificationsPausedUntil=null,t&&showNotification("Notifications resumed","success"),this.updatePauseButtonState(),this.saveSettings()}updatePauseButtonState(){this.pauseManager&&this.pauseManager.updatePauseButtonDisplay()}clearAllData(){confirm("Are you sure you want to clear all data? This cannot be undone.")&&(localStorage.removeItem("activityEntries"),localStorage.removeItem("activitySettings"),localStorage.removeItem("lastNotificationTime"),this.entries=[],this.currentReportEntries=[],this.displayEntries(),document.getElementById("reportResults").innerHTML="",showNotification("All data cleared successfully!","success"))}setDefaultReportDates(){this.setWeeklyReport()}}let tracker,deferredPrompt;function showSection(t,e){if(document.querySelectorAll(".section").forEach(t=>{t.classList.remove("active")}),document.getElementById(t).classList.add("active"),document.querySelectorAll(".nav-btn").forEach(t=>{t.classList.remove("active")}),e&&e.target)e.target.classList.add("active");else{const e=document.querySelector(`.nav-btn[onclick*="'${t}'"]`);e&&e.classList.add("active")}"tracker"===t&&setTimeout(()=>{const t=document.getElementById("activity");t&&t.focus()},100)}function addCurrentTime(){tracker&&tracker.setCurrentTime()}function generateReport(){tracker&&tracker.generateReport()}function setWeeklyReport(){tracker&&tracker.setWeeklyReport()}function previousWeek(){tracker&&tracker.previousWeek()}function nextWeek(){tracker&&tracker.nextWeek()}function downloadReport(){tracker&&tracker.downloadReport()}function showReportFormat(t){tracker&&tracker.showReportFormat(t)}function saveSettings(){tracker&&tracker.saveSettings()}function enableNotifications(){tracker&&tracker.enableNotifications()}function testNotification(){tracker&&tracker.testNotification()}function testNotificationSound(){tracker&&tracker.testNotificationSound()}function refreshNotificationStatus(){tracker&&tracker.refreshNotificationStatus()}function clearAllData(){tracker&&tracker.clearAllData()}function closeEditModal(){tracker&&tracker.closeEditModal()}function togglePause(){tracker&&tracker.togglePause()}ActivityTracker.prototype.initMarkdownRenderer=function(){void 0!==MarkdownRenderer&&(this.markdownRenderer=new MarkdownRenderer)},ActivityTracker.prototype.generateReport=function(){const t=document.getElementById("reportStartDate").value,e=document.getElementById("reportEndDate").value;if(!t||!e)return void showNotification("Please select both start and end dates","error");const n=new Date(t),i=new Date(e);i.setHours(23,59,59,999);const a=this.entries.filter(t=>{const e=new Date(t.timestamp);return e>=n&&e<=i});this.currentReportEntries=a,this.displayReport(a,n,i)},ActivityTracker.prototype.displayReport=function(t,e,n){const i=document.getElementById("reportResults");if(this.markdownRenderer||void 0===MarkdownRenderer||this.initMarkdownRenderer(),0===t.length)return void(i.innerHTML=`\n            <div class="report-summary">\n                <h3>No entries found for the selected period</h3>\n                <p>From ${formatDate(e)} to ${formatDate(n)}</p>\n            </div>\n        `);const a={};t.forEach(t=>{const e=new Date(t.timestamp).toDateString();a[e]||(a[e]=[]),a[e].push(t)});const o=t.length,r=Object.keys(a).length,s=(o/r).toFixed(1);i.innerHTML=`\n        <div class="report-format-tabs">\n            <button class="format-tab active" onclick="tracker.showReportFormat('html')">HTML View</button>\n            <button class="format-tab" onclick="tracker.showReportFormat('markdown')">Markdown Preview</button>\n        </div>\n        \n        <div id="htmlReport" class="report-format-content">\n            ${this.generateHTMLReportContent(t,e,n,a,o,r,s)}\n        </div>\n        \n        <div id="markdownReport" class="report-format-content" style="display: none;">\n            <div class="markdown-preview" id="markdownPreview">\n                Loading markdown preview...\n            </div>\n        </div>\n    `,setTimeout(()=>{this.updateMarkdownPreview(t,e,n)},100)},ActivityTracker.prototype.generateHTMLReportContent=function(t,e,n,i,a,o,r){return`\n        <div class="report-summary">\n            <h3>Activity Report</h3>\n            <p><strong>Period:</strong> ${formatDate(e)} to ${formatDate(n)}</p>\n            <p><strong>Total Entries:</strong> ${a}</p>\n            <p><strong>Active Days:</strong> ${o}</p>\n            <p><strong>Average Entries per Day:</strong> ${r}</p>\n        </div>\n        \n        ${Object.entries(i).sort(([t],[e])=>new Date(e)-new Date(t)).map(([t,e])=>`\n                <div class="entry-item">\n                    <div class="entry-content">\n                        <div class="entry-time"><strong>${t}</strong> (${e.length} entries)</div>\n                        ${e.sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)).map(t=>`\n                                <div style="margin-left: 20px; margin-top: 10px;">\n                                    <div class="entry-time">${formatTime(t.timestamp)}</div>\n                                    <div class="entry-activity">${escapeHtml(t.activity)}</div>\n                                    ${t.description?`<div class="entry-description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                                </div>\n                            `).join("")}\n                    </div>\n                </div>\n            `).join("")}\n    `},ActivityTracker.prototype.updateMarkdownPreview=function(t,e,n){if(!this.markdownRenderer)return;const i=this.generateMarkdownReport(t,e,n),a=this.markdownRenderer.renderWithClasses(i),o=document.getElementById("markdownPreview");o&&(o.innerHTML=a)},ActivityTracker.prototype.showReportFormat=function(t){document.querySelectorAll(".format-tab").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[onclick*="'${t}'"]`).classList.add("active"),document.querySelectorAll(".report-format-content").forEach(t=>{t.style.display="none"});const e=document.getElementById(`${t}Report`);e&&(e.style.display="block")},ActivityTracker.prototype.setWeeklyReport=function(){const t=getWeekStart(new Date),e=new Date(t);e.setDate(t.getDate()+4),this.currentWeekStart=new Date(t),this.updateWeekDisplay(),document.getElementById("reportStartDate").value=t.toISOString().split("T")[0],document.getElementById("reportEndDate").value=e.toISOString().split("T")[0]},ActivityTracker.prototype.previousWeek=function(){this.currentWeekStart?(this.currentWeekStart.setDate(this.currentWeekStart.getDate()-7),this.updateWeekFromCurrent()):this.setWeeklyReport()},ActivityTracker.prototype.nextWeek=function(){this.currentWeekStart?(this.currentWeekStart.setDate(this.currentWeekStart.getDate()+7),this.updateWeekFromCurrent()):this.setWeeklyReport()},ActivityTracker.prototype.updateWeekFromCurrent=function(){const t=new Date(this.currentWeekStart),e=new Date(t);e.setDate(t.getDate()+4),document.getElementById("reportStartDate").value=t.toISOString().split("T")[0],document.getElementById("reportEndDate").value=e.toISOString().split("T")[0],this.updateWeekDisplay()},ActivityTracker.prototype.updateWeekDisplay=function(){if(!this.currentWeekStart)return;const t=new Date(this.currentWeekStart),e=new Date(t);e.setDate(t.getDate()+6);const n=`Week of ${t.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`;document.getElementById("weekDisplay").textContent=n},ActivityTracker.prototype.downloadReport=function(){const t=document.getElementById("downloadFormat").value,e=document.getElementById("reportStartDate").value,n=document.getElementById("reportEndDate").value;if(!e||!n)return void showNotification("Please generate a report first","error");if(0===this.currentReportEntries.length)return void showNotification("No entries to download. Generate a report first.","error");const i=new Date(e),a=new Date(n);let o,r,s;switch(t){case"html":o=this.generateHTMLReport(this.currentReportEntries,i,a),r=`activity-report-${e}-to-${n}.html`,s="text/html";break;case"markdown":o=this.generateMarkdownReport(this.currentReportEntries,i,a),r=`activity-report-${e}-to-${n}.md`,s="text/markdown";break;case"csv":o=this.generateCSVReport(this.currentReportEntries,i,a),r=`activity-report-${e}-to-${n}.csv`,s="text/csv";break;default:return void showNotification("Unknown format selected","error")}downloadFile(o,r,s),showNotification(`Report downloaded as ${t.toUpperCase()}`,"success")},ActivityTracker.prototype.generateHTMLReport=function(t,e,n){const i={};return t.forEach(t=>{const e=new Date(t.timestamp).toDateString();i[e]||(i[e]=[]),i[e].push(t)}),`<!DOCTYPE html>\n<html lang="en-GB">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Activity Report</title>\n    <style>\n        body { \n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; \n            max-width: 800px; \n            margin: 0 auto; \n            padding: 20px; \n            line-height: 1.6;\n        }\n        .header { \n            background: #667eea; \n            color: white; \n            padding: 20px; \n            border-radius: 8px; \n            margin-bottom: 20px; \n        }\n        .summary { \n            background: #e6fffa; \n            padding: 15px; \n            border-radius: 8px; \n            margin-bottom: 20px; \n            border-left: 4px solid #38b2ac; \n        }\n        .day-section { \n            background: #f7fafc; \n            padding: 15px; \n            margin-bottom: 15px; \n            border-radius: 8px; \n            border: 1px solid #e2e8f0; \n        }\n        .entry { \n            margin: 10px 0; \n            padding: 10px; \n            background: white; \n            border-radius: 4px; \n            border-left: 3px solid #667eea;\n        }\n        .time { \n            font-weight: 600; \n            color: #667eea; \n            font-size: 14px;\n        }\n        .activity { \n            font-size: 16px; \n            margin: 5px 0; \n            font-weight: 500;\n        }\n        .description { \n            color: #718096; \n            font-size: 14px; \n            font-style: italic;\n        }\n        h1, h2, h3 { margin-top: 0; }\n        @media print {\n            .header { background: #333 !important; }\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1>Activity Report</h1>\n        <p>Generated on ${(new Date).toLocaleString("en-GB")}</p>\n    </div>\n    \n    <div class="summary">\n        <h2>Summary</h2>\n        <p><strong>Period:</strong> ${formatDate(e)} to ${formatDate(n)}</p>\n        <p><strong>Total Entries:</strong> ${t.length}</p>\n        <p><strong>Active Days:</strong> ${Object.keys(i).length}</p>\n        <p><strong>Average per Day:</strong> ${(t.length/Object.keys(i).length).toFixed(1)} entries</p>\n    </div>\n\n    ${Object.entries(i).sort(([t],[e])=>new Date(t)-new Date(e)).map(([t,e])=>`\n            <div class="day-section">\n                <h3>${t} (${e.length} entries)</h3>\n                ${e.sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)).map(t=>`\n                        <div class="entry">\n                            <div class="time">${formatTime(t.timestamp)}</div>\n                            <div class="activity">${escapeHtml(t.activity)}</div>\n                            ${t.description?`<div class="description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                        </div>\n                    `).join("")}\n            </div>\n        `).join("")}\n\n    <footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; color: #718096; font-size: 14px;">\n        <p>Generated by Activity Tracker on ${(new Date).toLocaleString("en-GB")}</p>\n    </footer>\n</body>\n</html>`},ActivityTracker.prototype.generateMarkdownReport=function(t,e,n){const i={};t.forEach(t=>{const e=new Date(t.timestamp).toDateString();i[e]||(i[e]=[]),i[e].push(t)});let a="# Activity Report\n\n";return a+=`**Generated:** ${(new Date).toLocaleString("en-GB")}\n\n`,a+="## Summary\n\n",a+=`- **Period:** ${formatDate(e)} to ${formatDate(n)}\n`,a+=`- **Total Entries:** ${t.length}\n`,a+=`- **Active Days:** ${Object.keys(i).length}\n`,a+=`- **Average per Day:** ${(t.length/Object.keys(i).length).toFixed(1)} entries\n\n`,a+="---\n\n",Object.entries(i).sort(([t],[e])=>new Date(t)-new Date(e)).forEach(([t,e])=>{a+=`## ${t} (${e.length} entries)\n\n`,e.sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)).forEach((t,e)=>{a+=`### ${e+1}. ${formatTime(t.timestamp)} - ${t.activity}\n\n`,t.description&&(a+=`> ${t.description}\n\n`)}),a+="---\n\n"}),a+=`*Report generated by Activity Tracker on ${(new Date).toLocaleString("en-GB")}*\n`,a},ActivityTracker.prototype.generateCSVReport=function(t,e,n){let i="Date,Time,Activity,Description,Duration (minutes),Next Activity Time,Capped Start,Capped End\n";const a=t.sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)),[o,r]=this.settings.startTime.split(":").map(Number),[s,c]=this.settings.endTime.split(":").map(Number);return a.forEach((t,e)=>{const n=new Date(t.timestamp),d=formatTime(t.timestamp),l=n.toLocaleDateString("en-GB");let u="",p="",m=formatTime(t.timestamp),h="";if(e<a.length-1){const t=new Date(a[e+1].timestamp);if(n.toDateString()===t.toDateString()){const e=t.getTime()-n.getTime();u=Math.floor(e/6e4),p=formatTime(t.toISOString()),h=p}else{const t=new Date(n);if(t.setHours(s,c,0,0),n<t){const e=t.getTime()-n.getTime();u=Math.floor(e/6e4),h=`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`}}}else{const t=new Date(n);if(t.setHours(s,c,0,0),n<t){const e=t.getTime()-n.getTime();u=Math.floor(e/6e4),h=`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`}}const g=new Date(n);if(g.setHours(o,r,0,0),n<g&&(m=`${o.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`,h)){const t=new Date(n);t.setHours(o,r,0,0);const i=h===p?new Date(a[e+1].timestamp):new Date(n).setHours(s,c,0,0);u=Math.floor((i-t.getTime())/6e4)}i+=`${l},${d},${escapeCsv(t.activity)},${escapeCsv(t.description||"")},${u},${p},${m},${h}\n`}),i},document.addEventListener("DOMContentLoaded",()=>{tracker=new ActivityTracker,"serviceWorker"in navigator&&(navigator.serviceWorker.register("./sw.js").then(t=>{tracker&&tracker.updateDebugInfo()}).catch(t=>{console.error("❌ Service Worker registration failed:",t),tracker&&tracker.updateDebugInfo()}),navigator.serviceWorker.addEventListener("message",t=>{t.data&&"add-entry"===t.data.type&&tracker&&(tracker.addEntry(t.data.entry),showNotification("Activity logged from notification!","success")),t.data&&"navigate-to-tracker"===t.data.type&&showSection("tracker")})),"#tracker"===window.location.hash&&(showSection("tracker"),history.replaceState(null,document.title,window.location.pathname+window.location.search))}),document.addEventListener("click",t=>{t.target.classList.contains("modal")&&closeEditModal()}),document.addEventListener("keydown",t=>{if("Escape"===t.key&&closeEditModal(),(t.ctrlKey||t.metaKey)&&"Enter"===t.key){const t=document.activeElement;if(t&&("activity"===t.id||"description"===t.id)){const t=document.getElementById("activityForm");t&&t.dispatchEvent(new Event("submit"))}}}),document.addEventListener("visibilitychange",()=>{tracker&&(document.hidden||tracker.updateDebugInfo())}),window.addEventListener("online",()=>{showNotification("Connection restored","success")}),window.addEventListener("offline",()=>{showNotification("Working offline","info")}),window.addEventListener("beforeunload",t=>{const e=document.getElementById("activity");if(e&&e.value.trim())return t.preventDefault(),t.returnValue="You have unsaved activity data. Are you sure you want to leave?",t.returnValue}),window.addEventListener("unload",()=>{tracker&&tracker.pauseManager&&tracker.pauseManager.destroy()}),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),deferredPrompt=t,showNotification("This app can be installed on your device!","info")}),window.addEventListener("appinstalled",()=>{showNotification("Activity Tracker installed successfully!","success"),deferredPrompt=null}),window.addEventListener("error",t=>{console.error("❌ Uncaught error:",t.error),showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("unhandledrejection",t=>{console.error("❌ Unhandled promise rejection:",t.reason),showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("load",()=>{if(window.performance&&window.performance.timing){const t=window.performance.timing;t.loadEventEnd,t.navigationStart}}),"undefined"!=typeof module&&module.exports&&(module.exports={showSection:showSection,addCurrentTime:addCurrentTime,generateReport:generateReport,setWeeklyReport:setWeeklyReport,previousWeek:previousWeek,nextWeek:nextWeek,downloadReport:downloadReport,saveSettings:saveSettings,enableNotifications:enableNotifications,testNotification:testNotification,testNotificationSound:testNotificationSound,refreshNotificationStatus:refreshNotificationStatus,clearAllData:clearAllData,closeEditModal:closeEditModal,togglePause:togglePause});</script></body></html>