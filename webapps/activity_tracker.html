<!doctype html><html lang="en-GB"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="favicon.ico" type="image/x-icon"><title>Activity Tracker</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);min-height:100vh;color:#333}hr{margin:15px 0;border:none;border-top:1px solid #e2e8f0;box-sizing:border-box;max-width:100%}.template-overlay hr{margin:10px 0;max-width:calc(100% - 20px)}.modal hr{margin:15px 0;max-width:calc(100% - 20px)}h2{margin-bottom:20px;padding-bottom:8px}h3{margin-bottom:16px;padding-bottom:6px}.container{max-width:1200px;margin:0 auto;padding:20px}.header{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:15px;padding:20px;margin-bottom:20px;box-shadow:0 8px 32px rgba(0,0,0,.1)}.nav{display:flex;justify-content:space-between;align-items:center;margin-top:15px}.nav-left,.nav-right{display:flex;gap:15px}.nav-btn{padding:10px 20px;border:none;background:#667eea;color:#fff;border-radius:8px;cursor:pointer;font-weight:500}.nav-btn:hover{background:#5a67d8;transform:translateY(-2px)}.nav-btn.active{background:#4c51bf;box-shadow:0 4px 15px rgba(76,81,191,.4)}.section{display:none;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:15px;padding:30px;box-shadow:0 8px 32px rgba(0,0,0,.1)}.section.active{display:block}.form-group{margin-bottom:20px}.form-group-row{display:flex;gap:15px;margin-bottom:20px}.form-group-row .form-group{flex:1;margin-bottom:0}.todo-filters{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #e2e8f0}.filter-row{display:flex;gap:20px;align-items:center;flex-wrap:wrap}.filter-group{display:flex;align-items:center;gap:10px}.filter-group label{font-weight:600;color:#4a5568;margin:0;white-space:nowrap}.filter-group select{padding:8px 12px;border:2px solid #e2e8f0;border-radius:6px;font-size:14px;background:#fff;min-width:150px}.todo-stats{margin-bottom:15px;padding:10px 0;color:#666;font-size:14px}.todo-list{min-height:200px}.todo-item{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:15px;transition:.2s;position:relative}.todo-item.todo-incomplete{border:1px solid #9b2c2c!important}.todo-item.todo-overdue{background:#fef5f5;border:1px solid #7b2d2d!important}.todo-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}.todo-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.todo-content{flex:1}.todo-activity{font-size:16px;font-weight:600;color:#2d3748;margin-bottom:5px}.todo-description{color:#718096;font-size:14px;margin-bottom:10px;line-height:1.4}.todo-meta{display:flex;gap:15px;flex-wrap:wrap;font-size:12px;color:#a0aec0;margin-bottom:10px}.todo-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}.todo-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.todo-tag:hover{background:#2f855a;transform:scale(1.05)}.todo-actions{display:flex;gap:8px;align-items:center}.entries-pagination,.todo-pagination{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:30px;padding:20px 0}.empty-state{text-align:center;color:#a0aec0;font-style:italic;padding:40px 20px}.global-search{margin:20px auto;max-width:600px}.search-container{position:relative;display:flex;align-items:center;gap:10px}#globalSearch{flex:1;padding:15px 20px;border:2px solid #e2e8f0;border-radius:25px;font-size:16px;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.05);transition:.3s}.hashtag-browser-btn{padding:12px;background:#667eea;color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:16px;transition:.3s;flex-shrink:0}.hashtag-browser-btn:hover{background:#5a67d8;transform:scale(1.05)}#hashtagBrowserModal .hashtag-cloud{padding:20px;line-height:1.8;text-align:center;max-height:400px;overflow-y:auto}.hashtag-cloud-item{display:inline-block;margin:5px 8px;padding:4px 12px;background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;border-radius:15px;cursor:pointer;transition:.3s;text-decoration:none;white-space:nowrap;font-weight:500;box-shadow:0 2px 4px rgba(0,0,0,.1)}.hashtag-cloud-item:hover{transform:scale(1.1) translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.4);background:linear-gradient(135deg,#5a67d8 0,#667eea 100%)}.dark-mode .hashtag-cloud-item{background:linear-gradient(135deg,#4f46e5 0,#7c3aed 100%);color:#f7fafc}.dark-mode .hashtag-cloud-item:hover{background:linear-gradient(135deg,#5b21b6 0,#4f46e5 100%);box-shadow:0 4px 12px rgba(139,92,246,.4)}#globalSearch:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1),0 4px 20px rgba(0,0,0,.1)}.search-results{position:absolute;top:100%;left:0;right:0;background:#fff;border:2px solid #e2e8f0;border-top:none;border-radius:0 0 15px 15px;box-shadow:0 8px 25px rgba(0,0,0,.1);z-index:1000;max-height:400px;overflow-y:auto}.search-suggestion{padding:12px 20px;cursor:pointer;border-bottom:1px solid #f7fafc;transition:background-color .2s}.search-suggestion:hover{background:#f7fafc}.search-suggestion.selected{background:#667eea;color:#fff}.search-suggestion-activity{font-weight:600;margin-bottom:4px}.search-suggestion-meta{font-size:12px;color:#a0aec0}.search-suggestion.selected .search-suggestion-meta{color:rgba(255,255,255,.8)}.search-hashtag{background:#667eea;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;margin-right:4px}.search-controls{background:#f8f9fa;padding:20px;border-radius:12px;margin-bottom:20px;border:1px solid #e2e8f0}.search-info{margin-bottom:15px;font-size:14px;color:#666}.search-options{display:flex;gap:20px;align-items:center;flex-wrap:wrap}.search-results-list{min-height:200px}.search-result-item{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:20px;margin-bottom:15px;transition:.2s}.search-result-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.1)}.search-result-item.result-todo{border:1px solid #9b2c2c!important}.search-result-item.result-completed{border:1px solid #38a169!important}.search-result-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.search-result-content{flex:1}.search-result-activity{font-size:16px;font-weight:600;color:#2d3748;margin-bottom:5px}.search-result-description{color:#718096;font-size:14px;margin-bottom:10px;line-height:1.4}.search-result-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}.search-result-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.search-result-tag:hover{background:#2f855a;transform:scale(1.05)}.search-result-meta{display:flex;gap:15px;flex-wrap:wrap;font-size:12px;color:#a0aec0;margin-bottom:10px}.search-result-actions{display:flex;gap:8px;align-items:center}.search-pagination{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:30px;padding:20px 0}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:#4a5568}.form-group input,.form-group select,.form-group textarea{width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:8px;font-size:16px;transition:border-color .3s}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1)}.form-group-buttons{margin-top:32px}.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;transition:.3s;margin-right:10px;margin-bottom:10px}.btn-small{margin-right:5px;margin-bottom:5px}.due-date-quick-sets{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}.btn-quick-set{padding:4px 8px;font-size:11px;background:#e2e8f0;color:#4a5568;border:1px solid #cbd5e0;border-radius:4px;cursor:pointer;transition:.2s}.btn-quick-set:hover{background:#cbd5e0;border-color:#a0aec0}.btn-quick-set.active{background:#38a169;color:#fff;border-color:#2f855a}.btn-quick-set.active:hover{background:#2f855a;border-color:#276749}.btn-primary{background:#667eea;color:#fff}.btn-primary:hover{background:#5a67d8;transform:translateY(-2px)}.btn-secondary{background:#718096;color:#fff}.btn-secondary:hover{background:#4a5568}.btn-danger{background:#e53e3e;color:#fff}.btn-danger:hover{background:#c53030}.btn-success{background:#667eea;color:#fff}.btn-success:hover{background:#5a67d8}.entries-list{margin-top:30px}.entry-item{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin-bottom:15px;display:flex;justify-content:space-between;align-items:flex-start}.entry-content{flex:1}.entry-time{font-weight:600;color:#667eea;margin-bottom:5px}.entry-activity{font-size:18px;margin-bottom:5px}.entry-description{color:#718096;font-size:14px}.entry-description .md-paragraph{margin:5px 0}.entry-description .md-list{margin:5px 0;padding-left:20px}.entry-description .md-blockquote{margin:8px 0;padding:5px 10px;font-size:13px}.entry-description .md-code{font-size:12px}.entry-actions{display:flex;gap:10px}.entry-item.entry-todo{border:1px solid #9b2c2c!important}.entry-item.entry-overdue{background:#fef5f5;border-color:#7b2d2d!important}.entry-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px}.entry-tag{background:#38a169;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:500;cursor:pointer;transition:.2s}.entry-tag:hover{background:#2f855a;transform:scale(1.05)}.entry-due-date{font-size:12px;color:#a0aec0;margin-top:5px}.entry-todo-indicator{font-size:12px;color:#f56565;margin-left:10px}.settings-buttons-section{margin-bottom:30px}.settings-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:25px;margin-bottom:30px}.data-management-section{margin-bottom:30px}.data-management-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px}.settings-section{background:#f7fafc;padding:20px;border-radius:8px;border:1px solid #e2e8f0}.settings-section h3{margin-bottom:8px;color:#2d3748}.settings-description{font-size:14px;color:#718096;margin-bottom:20px;margin-top:0}.settings-toggles{margin-top:20px;padding-top:15px;border-top:1px solid #e2e8f0}.time-inputs{display:grid;grid-template-columns:1fr 1fr;gap:15px}.working-days-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}.settings-card{background:#fff;border:2px solid #e2e8f0;border-radius:12px;padding:24px;transition:.3s;position:relative;overflow:hidden}.settings-card:hover{border-color:#667eea;box-shadow:0 8px 25px rgba(102,126,234,.15);transform:translateY(-2px)}.settings-card h3{margin-bottom:8px;color:#2d3748;font-size:18px}.card-description{font-size:14px;color:#718096;margin-bottom:20px;line-height:1.5}.card-actions{display:flex;gap:12px;flex-wrap:wrap}.about-section .debug-info{margin-top:0}.checkbox-group{display:flex;align-items:center;margin-bottom:10px}.checkbox-group input[type=checkbox]{width:auto;margin-right:10px}.notification-status{padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;font-weight:600}.notification-enabled{background:#c6f6d5;color:#22543d}.notification-disabled{background:#fed7d7;color:#742a2a}.notification-warning{background:#fef5e7;color:#744210}.report-filters{background:#f7fafc;padding:20px;border-radius:8px;margin-bottom:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;align-items:end}.report-summary{background:#e6fffa;padding:20px;border-radius:8px;margin-bottom:20px;border-left:4px solid #38b2ac}.report-navigation{display:flex;gap:10px;align-items:center;margin-bottom:20px}.week-display{background:#f7fafc;padding:10px 15px;border-radius:8px;min-width:200px}.download-section{background:#f0fff4;padding:20px;border-radius:8px;margin-top:20px;border-left:4px solid #38a169}.status-indicator{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:8px}.status-active{background:#48bb78}.status-inactive{background:#f56565}.backup-buttons,.notification-buttons{display:flex;gap:10px;flex-wrap:wrap}.debug-info{background:#f7fafc;padding:15px;border-radius:8px;margin-top:15px;font-family:monospace;font-size:14px;border-left:4px solid #667eea}.markdown-preview{background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:20px;margin:15px 0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6}.markdown-preview .md-h1{color:#2d3748;border-bottom:2px solid #667eea;padding-bottom:10px;margin:20px 0 15px}.markdown-preview .md-h2{color:#2d3748;border-bottom:1px solid #e2e8f0;padding-bottom:5px;margin:18px 0 12px}.markdown-preview .md-h3{color:#4a5568;margin:15px 0 10px}.markdown-preview .md-blockquote{border-left:4px solid #667eea;margin:15px 0;color:#718096;font-style:italic;background:rgba(102,126,234,.05);padding:10px 15px;border-radius:0 4px 4px 0}.markdown-preview .md-code{background:#edf2f7;padding:2px 6px;border-radius:4px;font-family:Monaco,Consolas,monospace;font-size:14px}.markdown-preview .md-list{margin:10px 0;padding-left:30px}.markdown-preview .md-paragraph{margin:10px 0}.markdown-preview .md-hr{border:none;border-top:1px solid #e2e8f0;margin:20px 0}.markdown-preview .md-preview-more{color:#718096;font-style:italic;text-align:center;margin:15px 0 5px}.md-paragraph{margin:8px 0}.md-paragraph:first-child{margin-top:0}.md-paragraph:last-child{margin-bottom:0}.md-list{margin:8px 0}.md-list li{margin:3px 0}.md-blockquote{margin:8px 0}.report-format-tabs{display:flex;margin-bottom:15px;border-bottom:1px solid #e2e8f0}.format-tab{padding:10px 20px;border:none;background:0 0;cursor:pointer;font-weight:600;color:#718096;border-bottom:2px solid transparent;transition:.3s}.format-tab:hover{color:#4a5568}.format-tab.active{color:#667eea;border-bottom-color:#667eea}.report-preview-container{margin-top:20px;background:#f7fafc;border-radius:8px;padding:20px;border:1px solid #e2e8f0}.report-preview-content{margin-top:10px;background:#fff;padding:15px;border-radius:5px;border:1px solid #e2e8f0;max-height:500px;overflow-y:auto;white-space:pre-wrap;font-family:monospace}.dark-mode .report-preview-container{background:#2d3748;border-color:#4a5568}.dark-mode .report-preview-content{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.nav-btn{transition:.3s,background 1s ease-out}#pauseButton{min-width:180px;text-align:center}.pomodoro-btn{background:#f56565!important;min-width:160px;text-align:center}.pomodoro-btn:hover{background:#e53e3e!important}.pomodoro-btn.active{background:#c53030!important;animation:2s infinite pulse}.pomodoro-btn.breaking{background:#0891b2!important}.pomodoro-btn.breaking:hover{background:#0e7490!important}@media (max-width:768px){.container{padding:10px}.nav{flex-direction:column;gap:15px}.nav-left,.nav-right{justify-content:center}.nav-right{gap:10px}.entry-item{flex-direction:column;gap:15px}.entry-actions{align-self:flex-end}.report-navigation{flex-wrap:wrap}.week-display{min-width:150px}.settings-grid{grid-template-columns:1fr;gap:20px}.data-management-grid{grid-template-columns:1fr;gap:15px}.time-inputs{grid-template-columns:1fr;gap:10px}.working-days-grid{grid-template-columns:1fr;gap:6px}.card-actions,.notification-buttons{justify-content:center}}body.dark-mode{background:linear-gradient(135deg,#1a1f3a 0,#2d1b4e 50%,#1a0b2e 100%);color:#e2e8f0}.dark-mode .header,.dark-mode .section{background:rgba(45,55,72,.85);backdrop-filter:blur(10px);color:#e2e8f0}.dark-mode .form-group label{color:#a0aec0}.dark-mode .form-group input,.dark-mode .form-group select,.dark-mode .form-group textarea{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .form-group input:focus,.dark-mode .form-group select:focus,.dark-mode .form-group textarea:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2)}.dark-mode .entry-item{background:#2d3748;border-color:#4a5568}.dark-mode .entry-description{color:#a0aec0}.dark-mode .entry-item.entry-overdue{background:#2d1b1e}.dark-mode .entry-due-date{color:#718096}.dark-mode .entry-todo-indicator{color:#fc8181}.dark-mode .todo-filters{background:#1a202c;border-color:#4a5568}.dark-mode .filter-group label{color:#a0aec0}.dark-mode .filter-group select{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode .todo-stats{color:#a0aec0}.dark-mode .todo-item{background:#2d3748;border-color:#4a5568}.dark-mode .todo-item.todo-incomplete{border-color:#e53e3e}.dark-mode .todo-item.todo-overdue{background:#2d1b1e;border-color:#c53030}.dark-mode .todo-activity{color:#e2e8f0}.dark-mode .todo-description{color:#a0aec0}.dark-mode .empty-state,.dark-mode .todo-meta{color:#718096}.dark-mode #globalSearch{background:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode #globalSearch:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.2),0 4px 20px rgba(0,0,0,.3)}.dark-mode .search-results{background:#2d3748;border-color:#4a5568}.dark-mode .search-suggestion{border-bottom-color:#1a202c}.dark-mode .search-suggestion:hover{background:#1a202c}.dark-mode .search-suggestion-meta{color:#718096}.dark-mode .search-controls{background:#1a202c;border-color:#4a5568}.dark-mode .search-info{color:#a0aec0}.dark-mode .search-result-item{background:#2d3748;border-color:#4a5568}.dark-mode .search-result-activity{color:#e2e8f0}.dark-mode .search-result-description{color:#a0aec0}.dark-mode .search-result-meta{color:#718096}.dark-mode .btn-quick-set{background:#4a5568;color:#a0aec0;border-color:#2d3748}.dark-mode .btn-quick-set:hover{background:#2d3748;border-color:#1a202c}.dark-mode .btn-quick-set.active{background:#38a169;color:#fff;border-color:#2f855a}.dark-mode .btn-quick-set.active:hover{background:#2f855a;border-color:#276749}.dark-mode .settings-section{background:#1a202c;border-color:#4a5568}.dark-mode .settings-section h3{color:#e2e8f0}.dark-mode .settings-description{color:#a0aec0}.dark-mode .settings-toggles{border-top-color:#4a5568}.dark-mode .settings-card{background:#2d3748;border-color:#4a5568}.dark-mode .settings-card:hover{border-color:#667eea;box-shadow:0 8px 25px rgba(102,126,234,.25)}.dark-mode .settings-card h3{color:#e2e8f0}.dark-mode .card-description{color:#a0aec0}.dark-mode .report-filters{background:#2d3748}.dark-mode .week-display{background:#2d3748}.dark-mode .report-summary{background:#2c5282;color:#bee3f8;border-left-color:#63b3ed}.dark-mode .download-section{background:#22543d;color:#f0fff4;border-left-color:#68d391}.dark-mode .download-section label{color:#c6f6d5}.dark-mode .debug-info{background:#1a202c;border-left-color:#667eea}.dark-mode .markdown-preview{background:#1a202c;border-color:#4a5568}.dark-mode .markdown-preview .md-h1,.dark-mode .markdown-preview .md-h2,.dark-mode .markdown-preview .md-h3{color:#e2e8f0}.dark-mode .markdown-preview .md-blockquote{color:#a0aec0;background:rgba(102,126,234,.1);border-left-color:#667eea}.dark-mode .markdown-preview .md-code{background:#2d3748;color:#e2e8f0}.dark-mode .format-tab{color:#a0aec0}.dark-mode .format-tab:hover{color:#e2e8f0}.dark-mode .format-tab.active{color:#667eea;border-bottom-color:#667eea}.dark-mode .preview-format-tabs{border-color:#4a5568}.dark-mode .preview-tab{background:#2d3748;color:#a0aec0}.dark-mode .preview-tab:hover{background:#1a202c;color:#e2e8f0}.dark-mode .preview-tab.active{background:#667eea;color:#fff}.dark-mode .template-editor-tabs{border-bottom-color:#4a5568}.dark-mode .template-tab{color:#a0aec0}.dark-mode .template-tab:hover{color:#e2e8f0;background:#1a202c}.dark-mode .template-tab.active{color:#667eea;border-bottom-color:#667eea;background:#3d4852}.template-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:2000;backdrop-filter:blur(5px)}.template-overlay.active{display:flex;align-items:center;justify-content:center}.template-overlay-content{background:#fff;border-radius:15px;width:95%;max-width:1400px;height:90%;max-height:900px;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.3)}.template-manager-header{padding:15px 20px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;border-radius:15px 15px 0 0;flex-shrink:0;background:#f8f9fa}.template-manager-header h2{margin:0;color:#2d3748;font-size:1.25rem;flex:1}.template-manager-actions{display:flex;gap:10px;align-items:center}.template-manager-actions .btn{font-size:.875rem;padding:8px 16px}.template-manager-body{flex:1;display:grid;grid-template-columns:300px 1fr;min-height:0;overflow:hidden}.template-list-panel{border-right:1px solid #e2e8f0;padding:20px;display:flex;flex-direction:column;background:#f7fafc;overflow-y:auto}.template-list-panel h3{margin:0 0 15px;color:#2d3748}.template-list{flex:1;overflow-y:auto;margin-bottom:15px}.template-list-item{padding:12px 15px;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:.2s;background:#fff}.template-list-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,.1)}.template-list-item.active{border-color:#667eea;background:#f0f2ff;box-shadow:0 2px 8px rgba(102,126,234,.2)}.template-list-item.default::after{content:" (Default)";color:#38a169;font-weight:600;font-size:12px}.template-list-item-name{font-weight:600;color:#2d3748;margin-bottom:2px}.template-list-item-desc{font-size:12px;color:#718096}.template-list-item-type{font-size:11px;color:#667eea;text-transform:uppercase;font-weight:600;margin-top:4px}.template-list-actions{display:flex;gap:10px}.template-editor-panel{padding:20px;display:flex;flex-direction:column;min-height:0;overflow:hidden}.template-editor-tabs{display:flex;border-bottom:1px solid #e2e8f0;margin-bottom:20px;margin-top:15px}.template-tab{padding:10px 20px;border:none;background:0 0;cursor:pointer;font-weight:600;color:#718096;border-bottom:2px solid transparent;transition:.3s}.template-tab:hover{color:#4a5568;background:#f7fafc}.template-tab.active{color:#667eea;border-bottom-color:#667eea;background:#f0f2ff}.template-editor-content{flex:1;display:flex;flex-direction:column;min-height:0}.template-editor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.template-editor-header h3{margin:0;color:#2d3748}.template-editor-actions{display:flex;gap:10px}.template-editor-form{flex:1;overflow-y:auto;display:flex;flex-direction:column}.template-editor-form #templateContent{font-family:Monaco,Consolas,monospace;font-size:13px;resize:vertical;min-height:200px}.template-preview-panel{flex:1;display:flex;flex-direction:column;min-height:0}.template-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.template-preview-controls{display:flex;align-items:center;gap:15px}.preview-format-tabs{display:flex;border:1px solid #e2e8f0;border-radius:6px;overflow:hidden}.preview-tab{padding:6px 12px;border:none;background:#fff;cursor:pointer;font-size:12px;font-weight:600;color:#718096;transition:.2s}.preview-tab:hover{background:#f7fafc;color:#4a5568}.preview-tab.active{background:#667eea;color:#fff}.report-preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.report-preview-header h3{margin:0}.template-preview-header h4{margin:0;color:#2d3748}.template-preview-content{flex:1;background:#f7fafc;border:1px solid #e2e8f0;border-radius:8px;padding:15px;overflow-y:auto;font-family:monospace;font-size:12px;white-space:pre-wrap}.template-preview-placeholder{color:#718096;font-style:italic;text-align:center;margin-top:50px}.template-manager-footer{padding:20px 30px;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:15px;border-radius:0 0 15px 15px}.template-management-preview{margin-top:15px}.template-preview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin-bottom:20px}.template-preview-card{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:15px;transition:.2s}.template-preview-card:hover{border-color:#667eea;box-shadow:0 4px 12px rgba(102,126,234,.1)}.template-preview-card.default{border-color:#38a169;background:#f0fff4}.template-preview-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}.template-preview-card-name{font-weight:600;color:#2d3748;margin-bottom:2px}.template-preview-card-type{font-size:11px;color:#667eea;text-transform:uppercase;font-weight:600;background:#e6f3ff;padding:2px 6px;border-radius:3px}.template-preview-card-desc{font-size:13px;color:#718096;margin-bottom:10px}.template-preview-card-sample{background:#f7fafc;border:1px solid #e2e8f0;border-radius:4px;padding:8px;font-family:monospace;font-size:11px;max-height:60px;overflow:hidden;position:relative}.template-preview-card-sample::after{content:"";position:absolute;bottom:0;left:0;right:0;height:20px;background:linear-gradient(transparent,#f7fafc)}.template-actions{display:flex;gap:10px;flex-wrap:wrap}.dark-mode .template-overlay-content{background:#2d3748}.dark-mode .template-manager-header{border-bottom-color:#4a5568;background:#1a202c}.dark-mode .template-manager-header h2{color:#e2e8f0}.dark-mode .template-list-panel{background:#1a202c;border-right-color:#4a5568}.dark-mode .template-list-panel h3{color:#e2e8f0}.dark-mode .template-list-item{background:#2d3748;border-color:#4a5568}.dark-mode .template-list-item:hover{border-color:#667eea;box-shadow:0 2px 8px rgba(102,126,234,.2)}.dark-mode .template-list-item.active{background:#3d4852}.dark-mode .template-list-item-name{color:#e2e8f0}.dark-mode .template-list-item-desc{color:#a0aec0}.dark-mode .template-editor-header h3,.dark-mode .template-preview-header h4{color:#e2e8f0}.dark-mode .template-preview-content{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.dark-mode .template-manager-footer{border-top-color:#4a5568}.dark-mode .template-preview-card{background:#2d3748;border-color:#4a5568}.dark-mode .template-preview-card-name{color:#e2e8f0}.dark-mode .template-preview-card-desc{color:#a0aec0}.dark-mode .template-preview-card-sample{background:#1a202c;border-color:#4a5568;color:#e2e8f0}.dark-mode .template-preview-card-sample::after{background:linear-gradient(transparent,#1a202c)}@keyframes slideInToastDown{0%{transform:translateX(400px) translateY(-100%);opacity:0}50%{transform:translateX(400px) translateY(0);opacity:.7}100%{transform:translateX(0) translateY(0);opacity:1}}@keyframes slideOutToast{0%{transform:translateX(0) translateY(0);opacity:1}100%{transform:translateX(400px) translateY(0);opacity:0}}.btn-info{background:#3182ce;color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;transition:.3s;font-weight:500}.btn-info:hover{background:#2c5282;transform:translateY(-1px)}.btn-small{padding:6px 12px;font-size:.875rem}.reports-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}.reports-section{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:12px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid rgba(255,255,255,.2)}.reports-section h3{margin:0 0 16px;padding-bottom:6px;color:#4a5568;font-size:1.1rem;font-weight:600}.report-navigation-section{margin-bottom:20px}.report-navigation-section .report-navigation{background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-radius:12px;padding:20px;box-shadow:0 4px 20px rgba(0,0,0,.08);border:1px solid rgba(255,255,255,.2);display:flex;justify-content:space-between;align-items:center;gap:20px}.week-display{font-weight:600;color:#4a5568;text-align:center;flex:1}.dark-mode .report-navigation-section .report-navigation{background:#2d3748;color:#e2e8f0;border-color:#4a5568}.dark-mode .week-display{color:#cbd5e0}.download-actions,.report-actions{margin-top:15px;display:flex;gap:10px;flex-wrap:wrap}.preview-controls{display:flex;align-items:center;gap:15px}.btn-copy-report{background:#38a169;color:#fff;border:2px solid transparent;padding:6px 12px;font-size:.875rem;border-radius:6px;cursor:pointer;transition:.3s;font-weight:500}.btn-copy-report:hover{background:#2f855a;transform:translateY(-1px)}.dark-mode .reports-section{background:#2d3748;color:#e2e8f0;border-color:#4a5568}.dark-mode .reports-section h3{color:#cbd5e0}@media (max-width:768px){.reports-grid{grid-template-columns:1fr}}.settings-grid-two-col{grid-template-columns:1fr 1fr!important}.schedule-section{margin-bottom:20px}.schedule-section h4{margin:0 0 12px;padding-bottom:4px;color:#4a5568;font-size:1rem;font-weight:600}.dark-mode .schedule-section h4{color:#cbd5e0}.pomodoro-section{margin-bottom:20px}.pomodoro-settings{margin-top:15px}.pomodoro-config{margin-top:15px;padding:15px;background:rgba(255,255,255,.5);border-radius:8px;border-left:4px solid #667eea}.dark-mode .pomodoro-config{background:rgba(0,0,0,.2);border-left-color:#764ba2}.pomodoro-timers{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px}.pomodoro-options{display:flex;flex-direction:column;gap:10px}.pomodoro-status-section{margin-bottom:20px;padding:15px;background:rgba(0,0,0,.05);border-radius:8px;text-align:center}.dark-mode .pomodoro-status-section{background:rgba(255,255,255,.05)}.pomodoro-status{font-size:16px;font-weight:600;margin-bottom:10px;padding:8px 12px;border-radius:6px;transition:.3s}.pomodoro-status.disabled{color:#6b7280;background:rgba(107,114,128,.1)}.pomodoro-status.ready{color:#059669;background:rgba(5,150,105,.1)}.pomodoro-status.working{color:#dc2626;background:rgba(220,38,38,.1);animation:2s infinite pulse}.pomodoro-status.breaking{color:#0891b2;background:rgba(8,145,178,.1)}.pomodoro-status.paused{color:#f59e0b;background:rgba(245,158,11,.1)}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.pomodoro-banner{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);color:#fff;padding:15px 20px;margin:0 -20px 20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}.pomodoro-banner-content{max-width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px}.pomodoro-banner-controls{display:flex;align-items:center;gap:10px}.pomodoro-pause-btn{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3);padding:8px 16px;border-radius:6px;font-size:14px;cursor:pointer;transition:.2s}.pomodoro-pause-btn:hover{background:rgba(255,255,255,.3);border-color:rgba(255,255,255,.5)}.pomodoro-pause-btn:active{background:rgba(255,255,255,.1)}.pomodoro-timer{display:flex;align-items:center;gap:15px;font-size:18px;font-weight:600}#pomodoroTimeRemaining{font-family:'Courier New',monospace;font-size:24px;font-weight:700;background:rgba(255,255,255,.2);padding:8px 16px;border-radius:8px;min-width:80px}#pomodoroPhase{font-size:16px;opacity:.9}.dark-mode .pomodoro-banner{background:linear-gradient(135deg,#4f46e5 0,#7c3aed 100%)}.notification-banner{background:linear-gradient(135deg,#059669 0,#047857 100%);color:#fff;padding:15px 20px;margin:0 -20px 20px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}.notification-banner-content{max-width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px}.notification-timer{display:flex;align-items:center;gap:10px}#notificationTimeRemaining{font-size:20px;font-weight:700;background:rgba(255,255,255,.2);padding:8px 12px;border-radius:8px;min-width:80px}.notification-status{font-size:16px;opacity:.9}.dark-mode .notification-banner{background:linear-gradient(135deg,#10b981 0,#059669 100%)}.pomodoro-controls{display:flex;justify-content:center;gap:10px}.pomodoro-hint{font-size:12px;color:#6b7280;margin:8px 0 0;font-style:italic}.dark-mode .pomodoro-hint{color:#9ca3af}.pomodoro-config h4{color:#374151;font-size:14px;font-weight:600;margin:20px 0 10px;text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:5px}.dark-mode .pomodoro-config h4{color:#d1d5db;border-bottom-color:rgba(255,255,255,.1)}.pomodoro-sounds{margin-bottom:15px}.pomodoro-sounds .form-group{margin-bottom:10px}.pomodoro-announce-sounds{margin-bottom:15px}.pomodoro-announce-sounds .form-group{margin-bottom:10px}@media (max-width:768px){.settings-grid-two-col{grid-template-columns:1fr!important}.pomodoro-timers{grid-template-columns:1fr}}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center}.modal[style*=block]{display:flex!important}.modal-content{background:#fff;padding:0;border-radius:15px;max-width:500px;width:90%;max-height:90vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.3);position:relative}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 30px;border-bottom:1px solid #e2e8f0;background:#f8f9fa}.modal-header h3{margin:0;color:#2d3748;font-size:1.25rem}.modal-body{padding:30px;overflow-y:auto;max-height:calc(90vh - 140px)}.btn-close{background:0 0;border:none;font-size:24px;cursor:pointer;color:#718096;padding:5px 10px;border-radius:5px;transition:.2s;position:absolute;top:15px;right:15px;width:35px;height:35px;display:flex;align-items:center;justify-content:center}.btn-close:hover{background:#f7fafc;color:#2d3748}.template-guide-content{max-width:800px;max-height:90vh;overflow:hidden}.template-guide-content .modal-body{overflow-y:auto}.about-modal-content{max-width:600px}.about-section{margin-bottom:25px}.about-section h4{color:#4a5568;margin:0 0 15px;font-size:1.1rem;font-weight:600}.diagnostic-buttons{display:flex;gap:10px;flex-wrap:wrap}.diagnostic-buttons .btn{font-size:.875rem}.about-section p{margin-bottom:10px;line-height:1.6}.user-guide-content{max-width:700px}.guide-section{margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid rgba(0,0,0,.08)}.guide-section:last-child{border-bottom:none;margin-bottom:0}.guide-section h4{color:#2d3748;margin:0 0 12px;font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px}.guide-section p{margin-bottom:15px;line-height:1.6;color:#4a5568}.guide-section ul{margin:0;padding-left:20px;line-height:1.7}.guide-section li{margin-bottom:8px;color:#4a5568}.guide-section kbd{background:#f7fafc;border:1px solid #e2e8f0;border-radius:4px;padding:2px 6px;font-family:monospace;font-size:.875rem;color:#2d3748;box-shadow:0 1px 2px rgba(0,0,0,.1)}.dark-mode .guide-section{border-bottom-color:rgba(255,255,255,.1)}.dark-mode .guide-section h4{color:#e2e8f0}.dark-mode .guide-section li,.dark-mode .guide-section p{color:#a0aec0}.dark-mode .guide-section kbd{background:#4a5568;border-color:#718096;color:#e2e8f0}.about-section ul{margin:10px 0;padding-left:20px}.about-section li{margin-bottom:5px;line-height:1.5}.template-guide-content h4{color:#4a5568;margin:20px 0 10px;font-size:1.1rem}.template-guide-content pre{background:#f7fafc;padding:15px;border-radius:6px;overflow-x:auto;margin:10px 0}.template-guide-content code{background:#edf2f7;padding:2px 6px;border-radius:3px;font-family:Monaco,Menlo,monospace;font-size:.875rem}.template-guide-content pre code{background:0 0;padding:0}.dark-mode .modal-content{background:#2d3748}.dark-mode .modal-header{background:#1a202c;border-bottom-color:#4a5568}.dark-mode .modal-header h3{color:#e2e8f0}.dark-mode .btn-close{color:#a0aec0}.dark-mode .btn-close:hover{background:#1a202c;color:#e2e8f0}.dark-mode .about-section h4,.dark-mode .template-guide-content h4{color:#cbd5e0}.dark-mode .template-guide-content pre{background:#1a202c;color:#e2e8f0}.dark-mode .template-guide-content code{background:#2d3748;color:#e2e8f0}.dark-mode input[type=date],.dark-mode input[type=datetime-local],.dark-mode input[type=time]{color-scheme:dark;background-color:#2d3748;border-color:#4a5568;color:#e2e8f0}.dark-mode input[type=date]::-webkit-calendar-picker-indicator,.dark-mode input[type=datetime-local]::-webkit-calendar-picker-indicator,.dark-mode input[type=time]::-webkit-calendar-picker-indicator{filter:invert(1) brightness(1.2) contrast(1.1);cursor:pointer;opacity:.8}.dark-mode input[type=date]::-webkit-calendar-picker-indicator:hover,.dark-mode input[type=datetime-local]::-webkit-calendar-picker-indicator:hover,.dark-mode input[type=time]::-webkit-calendar-picker-indicator:hover{opacity:1}.dark-mode input[type=date]::-moz-calendar-picker-indicator,.dark-mode input[type=datetime-local]::-moz-calendar-picker-indicator,.dark-mode input[type=time]::-moz-calendar-picker-indicator{filter:invert(1) brightness(1.2)}.notification-stack{position:fixed;top:20px;right:20px;z-index:9999;pointer-events:none;display:flex;flex-direction:column;gap:10px}.notification-toast{background:rgba(45,55,72,.95);backdrop-filter:blur(10px);color:#fff;padding:12px 20px;border-radius:8px;max-width:350px;box-shadow:0 8px 32px rgba(0,0,0,.3);pointer-events:auto;cursor:pointer;transition:.3s;transform:translateX(400px) translateY(-100%);opacity:0;animation:.4s ease-out forwards slideInToastDown}.notification-toast.notification-success{background:rgba(56,161,105,.95);border-left:4px solid #38a169}.notification-toast.notification-error{background:rgba(229,62,62,.95);border-left:4px solid #e53e3e}.notification-toast.notification-warning{background:rgba(237,137,54,.95);border-left:4px solid #ed8936}.notification-toast.notification-info{background:rgba(49,130,206,.95);border-left:4px solid #3182ce}.notification-toast.removing{animation:.3s forwards slideOut}.notification-toast:hover{transform:translateX(-5px);box-shadow:0 12px 40px rgba(0,0,0,.4)}@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}@media (max-width:1200px){.template-manager-body{grid-template-columns:250px 1fr}}@media (max-width:768px){.template-overlay-content{width:98%;height:95%}.template-manager-body{grid-template-columns:1fr;grid-template-rows:auto 1fr}.template-list-panel{border-right:none;border-bottom:1px solid #e2e8f0;max-height:200px}.template-preview-panel{height:150px}}</style></head><body><div class="container"><div class="header"><h1>Activity Tracker</h1><p>Track your daily activities with automatic reminders</p><div class="global-search"><div class="search-container"><input id="globalSearch" placeholder="Search activities, todos, and hashtags..." autocomplete="off"> <button class="hashtag-browser-btn" onclick="showHashtagBrowser()" title="Browse hashtags">üè∑Ô∏è</button><div class="search-results" id="searchResults" style="display:none"></div></div></div><div class="nav"><div class="nav-left"><button class="nav-btn active" onclick="showSection('tracker', event)">Tracker</button> <button class="nav-btn" onclick="showSection('todo', event)">To Do</button> <button class="nav-btn" onclick="showSection('reports', event)">Reports</button> <button class="nav-btn" onclick="showSection('settings', event)">Settings</button></div><div class="nav-right"><button id="pauseButton" class="nav-btn" onclick="togglePause()">Start Alerts</button> <button id="pomodoroButton" class="nav-btn pomodoro-btn" onclick="togglePomodoro()" style="display:none">üçÖ Start Pomodoro</button></div></div></div><div id="pomodoroStatusBanner" class="pomodoro-banner" style="display:none"><div class="pomodoro-banner-content"><div id="pomodoroStatus" class="pomodoro-status disabled">Pomodoro mode disabled</div><div id="pomodoroTimer" class="pomodoro-timer" style="display:none"><span id="pomodoroTimeRemaining">25:00</span> <span id="pomodoroPhase">Work Session</span></div><div id="pomodoroBannerControls" class="pomodoro-banner-controls" style="display:none"><button id="pomodoroPauseBtn" class="pomodoro-pause-btn" onclick="togglePomodoroPause()">Pause</button></div></div></div><div id="notificationStatusBanner" class="notification-banner" style="display:none"><div class="notification-banner-content"><div id="notificationStatus" class="notification-status">Next notification in:</div><div id="notificationTimer" class="notification-timer"><span id="notificationTimeRemaining">--:--</span></div></div></div><div id="tracker" class="section active"><h2>Activity Entry</h2><form id="activityForm"><div class="form-group"><label for="activity">What are you doing?</label> <input id="activity" required placeholder="e.g., Writing report, Meeting with team #work" autocomplete="off"></div><div class="form-group"><label for="description">Description (optional)</label> <textarea id="description" rows="3" placeholder="Additional details about this activity"></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="timestamp">Time</label> <input type="datetime-local" id="timestamp" required><div class="todo-quick-set"><button type="button" class="btn-quick-set" id="todoToggleBtn" onclick="toggleTodoMode()" title="Mark this as a todo item (Shift+Enter to submit as todo automatically)">Add as Todo</button></div></div><div class="form-group"><label for="dueDate">Due Date (optional)</label> <input type="datetime-local" id="dueDate"><div class="due-date-quick-sets"><button type="button" class="btn-quick-set" onclick="setDueDate('tomorrow')">Tomorrow</button> <button type="button" class="btn-quick-set" onclick="setDueDate('nextWeek')">Next Week</button> <button type="button" class="btn-quick-set" onclick="setDueDate('nextMonth')">Next Month</button></div></div></div><button type="submit" class="btn btn-primary">Add Entry</button> <button type="button" class="btn btn-secondary" onclick="addCurrentTime()">Use Current Time</button></form><div class="entries-list"><h3>Recent Entries</h3><div id="entriesList"></div><div class="entries-pagination" id="entriesPagination" style="display:none"><button id="entriesPrevBtn" onclick="tracker.previousEntriesPage()">‚Äπ Previous</button> <span id="entriesPageInfo"></span> <button id="entriesNextBtn" onclick="tracker.nextEntriesPage()">Next ‚Ä∫</button></div></div></div><div id="todo" class="section"><h2>To Do</h2><div class="todo-filters"><div class="filter-row"><div class="filter-group"><label for="todoFilter">Filter:</label> <select id="todoFilter" onchange="tracker.filterTodos()"><option value="all">All Todos</option><option value="due-today">Due Today</option><option value="overdue">Overdue</option><option value="no-due-date">No Due Date</option></select></div><div class="filter-group"><label for="todoSort">Sort by:</label> <select id="todoSort" onchange="tracker.sortTodos()"><option value="created-desc">Newest First</option><option value="created-asc">Oldest First</option><option value="due-asc">Due Date (Earliest)</option><option value="due-desc">Due Date (Latest)</option><option value="activity-asc">Activity A-Z</option><option value="activity-desc">Activity Z-A</option></select></div></div></div><div class="todo-stats" id="todoStats"><span id="todoCount">0 todos</span></div><div class="todo-list" id="todoList"><p class="empty-state">No todos found. Add activities as todos to see them here!</p></div><div class="todo-pagination" id="todoPagination" style="display:none"><button class="btn btn-secondary" id="todoPrevBtn" onclick="tracker.previousTodoPage()">‚Üê Previous</button> <span id="todoPageInfo">Page 1 of 1</span> <button class="btn btn-secondary" id="todoNextBtn" onclick="tracker.nextTodoPage()">Next ‚Üí</button></div></div><div id="reports" class="section"><h2>Activity Reports</h2><div class="reports-grid"><div class="reports-section"><h3>Date Range</h3><p class="settings-description">Select the time period for your report</p><div class="form-group"><label for="reportStartDate" title="Choose the start date for your report">Start Date</label> <input type="date" id="reportStartDate"></div><div class="form-group"><label for="reportEndDate" title="Choose the end date for your report">End Date</label> <input type="date" id="reportEndDate"></div><div class="report-actions"><button class="btn btn-primary" onclick="generateReport()" title="Generate report for the selected date range">Generate Report</button> <button class="btn btn-secondary" onclick="setWeeklyReport()" title="Set date range to current week">This Week</button></div></div><div class="reports-section"><h3>Template & Options</h3><p class="settings-description">Choose format, options and download your report</p><div class="form-group"><label for="reportTemplate" title="Select the format for your report">Report Template</label> <select id="reportTemplate" onchange="tracker.previewReport()"></select></div><div class="form-group"><div class="checkbox-group"><input type="checkbox" id="includeIncompleteTodos" onchange="tracker.generateReport()"> <label for="includeIncompleteTodos" title="Include uncompleted todo items in the report">Include incomplete todos</label></div></div><div class="download-actions"><button class="btn btn-success" onclick="downloadReport()" title="Download the generated report">Download Report</button></div></div></div><div class="report-navigation-section"><div class="report-navigation"><button class="btn btn-secondary" onclick="previousWeek()">‚Üê Previous Week</button><div class="week-display" id="weekDisplay">Week of ...</div><button class="btn btn-secondary" onclick="nextWeek()">Next Week ‚Üí</button></div></div><div id="reportPreviewContainer" class="report-preview-container"><div class="report-preview-header"><h3>Report Preview</h3><div class="preview-controls"><div class="preview-format-tabs"><button class="preview-tab active" id="reportPreviewTabRendered" onclick="switchReportPreviewTab('rendered')" title="View the formatted report output">Rendered</button> <button class="preview-tab" id="reportPreviewTabSource" onclick="switchReportPreviewTab('source')" title="View the raw source code of the report">Source</button></div><button class="btn-copy-report" id="copyReportBtn" onclick="copyReportToClipboard()" title="Copy report content to clipboard" style="display:none">Copy Report</button></div></div><div id="reportPreview" class="report-preview-content">Select a date range and generate a report to see a preview.</div></div></div><div id="settings" class="section"><h2>Settings</h2><div class="notification-status" id="notificationStatus"><span class="status-indicator" id="statusIndicator"></span> <span id="statusText">Checking notification status...</span></div><div class="settings-buttons-section"><div class="notification-buttons"><button class="btn btn-primary" onclick="enableNotifications()">Enable Notifications</button> <button class="btn btn-info" onclick="showAbout()" title="View app information, version details, and diagnostic tools">About & Diagnostics</button> <button class="btn btn-info" onclick="showUserGuide()" title="View user guide and shortcuts">üìö User Guide</button></div></div><div class="settings-grid settings-grid-two-col"><div class="settings-section"><h3>Notification Settings</h3><div class="form-group"><label for="notificationInterval" title="How often you'll receive activity reminder notifications">Reminder Interval</label> <select id="notificationInterval"><option value="1">1 minute</option><option value="2">2 minutes</option><option value="5">5 minutes</option><option value="15">15 minutes</option><option value="30">30 minutes</option><option value="60" selected="selected">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option><option value="180">3 hours</option><option value="240">4 hours</option></select></div><div class="form-group"><label for="pauseDuration" title="How long alerts remain paused before automatically resuming">Auto-resume alerts after</label> <select id="pauseDuration"><option value="1">1 minute</option><option value="2">2 minutes</option><option value="5">5 minutes</option><option value="15">15 minutes</option><option value="30">30 minutes</option><option value="60">1 hour</option><option value="90">1.5 hours</option><option value="120">2 hours</option><option value="180">3 hours</option><option value="240">4 hours</option><option value="480">8 hours</option><option value="1440">24 hours</option><option value="-1">Never</option></select></div><div class="form-group"><div class="checkbox-group"><input type="checkbox" id="autoStartAlerts"> <label for="autoStartAlerts" title="Automatically start notifications when the app loads">Auto-start alerts on page load</label></div></div><div class="form-group"><label for="notificationSoundType" title="Choose the sound that plays with notifications">Notification Sound</label> <select id="notificationSoundType" onchange="previewNotificationSound()"></select></div><div class="form-group"><label for="paginationSize" title="Number of items to show per page in lists">Items per page</label> <select id="paginationSize"><option value="10">10 items</option><option value="20" selected="selected">20 items</option><option value="30">30 items</option><option value="50">50 items</option><option value="100">100 items</option></select></div><div class="settings-toggles"><div class="form-group"><label for="soundMuteMode" title="Choose which sounds to mute">Sound Settings</label> <select id="soundMuteMode"><option value="none">All sounds enabled</option><option value="all">Mute all sounds</option><option value="pomodoro">Mute Pomodoro sounds only</option><option value="notifications">Mute notification sounds only</option></select></div><div class="form-group"><label for="darkModePreference" title="Choose your colour theme preference">Colour Theme</label> <select id="darkModePreference"><option value="light">Light mode</option><option value="dark">Dark mode</option><option value="system">Follow system settings</option></select></div></div></div><div class="settings-section"><h3>Working Schedule</h3><p class="settings-description">Set your active working hours and days for notifications</p><div class="schedule-section"><h4>Working Hours</h4><div class="time-inputs"><div class="form-group"><label for="startTime" title="When your work day starts">Start Time</label> <input type="time" id="startTime" value="08:00"></div><div class="form-group"><label for="endTime" title="When your work day ends">End Time</label> <input type="time" id="endTime" value="18:00"></div></div></div><div class="schedule-section"><h4>Working Days</h4><div class="working-days-grid"><div class="checkbox-group"><input type="checkbox" id="monday" checked="checked"> <label for="monday">Monday</label></div><div class="checkbox-group"><input type="checkbox" id="tuesday" checked="checked"> <label for="tuesday">Tuesday</label></div><div class="checkbox-group"><input type="checkbox" id="wednesday" checked="checked"> <label for="wednesday">Wednesday</label></div><div class="checkbox-group"><input type="checkbox" id="thursday" checked="checked"> <label for="thursday">Thursday</label></div><div class="checkbox-group"><input type="checkbox" id="friday" checked="checked"> <label for="friday">Friday</label></div><div class="checkbox-group"><input type="checkbox" id="saturday"> <label for="saturday">Saturday</label></div><div class="checkbox-group"><input type="checkbox" id="sunday"> <label for="sunday">Sunday</label></div></div></div></div></div><div class="pomodoro-section"><div class="settings-card"><h3>Pomodoro Mode</h3><p class="card-description">Structured work/break intervals with automatic notifications</p><div class="pomodoro-settings"><div class="checkbox-group"><input type="checkbox" id="pomodoroEnabled"> <label for="pomodoroEnabled" title="Enable Pomodoro timing mode with work and break alerts">Enable Pomodoro Mode</label></div><div class="pomodoro-config" id="pomodoroConfig" style="display:none"><div class="pomodoro-timers"><div class="form-group"><label for="pomodoroWorkDuration" title="Length of work periods in minutes">Work Duration (minutes)</label> <select id="pomodoroWorkDuration"><option value="15">15 minutes</option><option value="20">20 minutes</option><option value="25" selected="selected">25 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option><option value="60">60 minutes</option></select></div><div class="form-group"><label for="pomodoroBreakDuration" title="Length of short break periods in minutes">Short Break Duration (minutes)</label> <select id="pomodoroBreakDuration"><option value="3">3 minutes</option><option value="5" selected="selected">5 minutes</option><option value="10">10 minutes</option><option value="15">15 minutes</option></select></div><div class="form-group"><label for="pomodoroLongBreakDuration" title="Length of long break periods in minutes">Long Break Duration (minutes)</label> <select id="pomodoroLongBreakDuration"><option value="15" selected="selected">15 minutes</option><option value="20">20 minutes</option><option value="30">30 minutes</option><option value="45">45 minutes</option><option value="60">60 minutes</option></select></div><div class="form-group"><label for="pomodoroLongBreakInterval" title="Number of work sessions before taking a long break">Sessions before long break</label> <select id="pomodoroLongBreakInterval"><option value="2">Every 2 sessions</option><option value="3">Every 3 sessions</option><option value="4" selected="selected">Every 4 sessions</option><option value="5">Every 5 sessions</option><option value="6">Every 6 sessions</option></select></div></div><div class="pomodoro-sounds"><h4>Tick Sounds</h4><div class="form-group"><label for="pomodoroTickSound" title="Optional tick sound to remind you're in a work session">Tick Sound Type</label> <select id="pomodoroTickSound"><option value="none" selected="selected">No ticking</option><option value="soft">Soft tick</option><option value="classic">Classic tick</option><option value="digital">Digital tick</option></select></div><div class="form-group"><label for="pomodoroTickInterval" title="How often to play the tick sound in seconds">Tick Interval (seconds)</label> <select id="pomodoroTickInterval"><option value="0" selected="selected">Off (no ticking)</option><option value="1">Every 1 second</option><option value="2">Every 2 seconds</option><option value="3">Every 3 seconds</option><option value="4">Every 4 seconds</option><option value="5">Every 5 seconds</option><option value="10">Every 10 seconds</option><option value="15">Every 15 seconds</option><option value="30">Every 30 seconds</option><option value="60">Every minute</option></select></div></div><div class="pomodoro-announce-sounds"><h4>Announce Sounds</h4><div class="form-group"><label for="pomodoroShortBreakSound" title="Sound to play when short break starts">Short Break Announce</label> <select id="pomodoroShortBreakSound"></select></div><div class="form-group"><label for="pomodoroLongBreakSound" title="Sound to play when long break starts">Long Break Announce</label> <select id="pomodoroLongBreakSound"></select></div><div class="form-group"><label for="pomodoroResumeSound" title="Sound to play when resuming work after break">Resume Work Announce</label> <select id="pomodoroResumeSound"></select></div></div><div class="pomodoro-options"><h4>Options</h4><div class="checkbox-group"><input type="checkbox" id="pomodoroAutoStart"> <label for="pomodoroAutoStart" title="Automatically start the next session without requiring manual intervention">Automatically start next session</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroAutoLog" checked="checked"> <label for="pomodoroAutoLog" title="Prompt for activity description and create log entries for work sessions">Prompt for work session descriptions</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroLogBreaks"> <label for="pomodoroLogBreaks" title="Also log break sessions in the activity tracker">Log break sessions too</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroLongBreak" checked="checked"> <label for="pomodoroLongBreak" title="Enable long breaks after completing multiple sessions">Enable long breaks</label></div><div class="checkbox-group"><input type="checkbox" id="pomodoroPauseAllowed" checked="checked"> <label for="pomodoroPauseAllowed" title="Allow pausing Pomodoro sessions from the banner">Allow session pausing</label></div></div></div></div></div></div><div class="data-management-section"><div class="data-management-grid"><div class="settings-card"><h3>Report Templates</h3><p class="card-description">Manage templates for report generation</p><div class="card-actions"><button class="btn btn-primary" onclick="openTemplateManager()" title="Open the template editor to create and modify report templates">Manage Templates</button> <button class="btn btn-secondary" onclick="resetReportTemplates()" title="Restore all templates to their original default versions">Reset to Default</button> <button class="btn btn-info" onclick="showTemplateGuide()" title="View help documentation for template syntax and available data">Template Guide</button></div></div><div class="settings-card"><h3>Database Backup</h3><p class="card-description">Export or import your activity data</p><div class="card-actions"><button class="btn btn-primary" onclick="exportDatabase()">Export Database</button> <button class="btn btn-secondary" onclick="importDatabase()">Import Database</button> <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImportFile(event)"></div></div></div></div><button class="btn btn-primary" onclick="saveSettings()">Manual Save Settings</button> <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button></div><div id="search" class="section"><h2>Search Results</h2><div class="search-controls"><div class="search-info" id="searchInfo"><span id="searchQuery"></span> <span id="searchCount">0 results</span></div><div class="search-options"><div class="filter-group"><label for="searchSort">Sort by:</label> <select id="searchSort" onchange="tracker.sortSearchResults()"><option value="relevance">Relevance</option><option value="date-desc">Newest First</option><option value="date-asc">Oldest First</option><option value="activity-asc">Activity A-Z</option><option value="activity-desc">Activity Z-A</option></select></div><div class="filter-group"><label for="searchFilter">Show:</label> <select id="searchFilter" onchange="tracker.filterSearchResults()"><option value="all">All Items</option><option value="activities">Activities Only</option><option value="todos">Todos Only</option><option value="completed">Completed Only</option></select></div></div></div><div class="search-results-list" id="searchResultsList"><p class="empty-state">Use the search box above to find activities, todos, and hashtags.</p></div><div class="search-pagination" id="searchPagination" style="display:none"><button class="btn btn-secondary" id="searchPrevBtn" onclick="tracker.previousSearchPage()">‚Üê Previous</button> <span id="searchPageInfo">Page 1 of 1</span> <button class="btn btn-secondary" id="searchNextBtn" onclick="tracker.nextSearchPage()">Next ‚Üí</button></div></div></div><div id="notificationStack" class="notification-stack"></div><div id="editModal" class="modal"><div class="modal-content"><h3>Edit Entry</h3><form id="editForm"><input type="hidden" id="editId"><div class="form-group"><label for="editActivity">Activity</label> <input id="editActivity" required></div><div class="form-group"><label for="editDescription">Description</label> <textarea id="editDescription" rows="3"></textarea></div><div class="form-group form-group-row"><div class="form-group"><label for="editTimestamp">Time</label> <input type="datetime-local" id="editTimestamp" required></div><div class="form-group"><label for="editDueDate">Due Date (optional)</label> <input type="datetime-local" id="editDueDate"><div class="due-date-quick-sets"><button type="button" class="btn-quick-set" onclick="setEditDueDate('tomorrow')">Tomorrow</button> <button type="button" class="btn-quick-set" onclick="setEditDueDate('nextWeek')">Next Week</button> <button type="button" class="btn-quick-set" onclick="setEditDueDate('nextMonth')">Next Month</button></div></div></div><div class="form-group"><div class="checkbox-group"><input type="checkbox" id="editTodoCheckbox"> <label for="editTodoCheckbox">Is Todo</label></div></div><button type="submit" class="btn btn-primary">Update Entry</button> <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button></form></div></div><div id="templateManagerOverlay" class="template-overlay"><div class="template-overlay-content"><div class="template-manager-header"><h2>Template Manager</h2><div class="template-manager-actions"><button class="btn btn-primary" onclick="saveAllTemplates()">Save All Changes</button> <button class="btn btn-secondary" onclick="closeTemplateManager()">Close</button></div></div><div class="template-manager-body"><div class="template-list-panel"><h3>Templates</h3><div class="template-list" id="templateList"></div><div class="template-list-actions"><button class="btn btn-primary" onclick="addNewTemplate()">Add Template</button> <button class="btn btn-secondary" onclick="resetToDefaults()">Reset All</button></div></div><div class="template-editor-panel"><div class="template-editor-header"><h3 id="templateEditorTitle">Select a template to edit</h3><div class="template-editor-actions" id="templateEditorActions" style="display:none"><button class="btn btn-success" onclick="saveCurrentTemplate()">Save</button> <button class="btn btn-danger" onclick="deleteCurrentTemplate()">Delete</button> <button class="btn btn-secondary" onclick="duplicateCurrentTemplate()">Duplicate</button></div></div><div class="template-editor-tabs" id="templateEditorTabs" style="display:none"><button class="template-tab active" id="tabEditor" onclick="switchTemplateTab('editor')">Editor</button> <button class="template-tab" id="tabPreview" onclick="switchTemplateTab('preview')">Preview</button></div><div class="template-editor-content"><div class="template-editor-form" id="templateEditorForm" style="display:none"><div class="form-group"><label for="templateName">Template Name</label> <input id="templateName" placeholder="e.g., My Custom Template"></div><div class="form-group"><label for="templateDescription">Description</label> <input id="templateDescription" placeholder="Brief description of the template"></div><div class="form-group"><label for="templateType">Output Type</label> <select id="templateType"><option value="html">HTML</option><option value="markdown">Markdown</option><option value="csv">CSV</option><option value="text">Plain Text</option></select></div><div class="form-group"><label for="templateContent">Template Content</label> <textarea id="templateContent" rows="20" placeholder="Enter your template content here..."></textarea></div><div class="checkbox-group"><input type="checkbox" id="templateIsDefault"> <label for="templateIsDefault">Set as default template</label></div></div><div class="template-preview-panel" id="templatePreviewPanel" style="display:none"><div class="template-preview-header"><h4>Preview</h4><div class="template-preview-controls"><div class="preview-format-tabs"><button class="preview-tab active" id="previewTabRendered" onclick="switchPreviewTab('rendered')">Rendered</button> <button class="preview-tab" id="previewTabSource" onclick="switchPreviewTab('source')">Source</button></div><button class="btn btn-secondary btn-small" onclick="refreshTemplatePreview()">Refresh</button></div></div><div class="template-preview-content" id="templatePreviewContent"><p class="template-preview-placeholder">Select a template to see preview</p></div></div></div></div></div></div></div><div id="templateGuideModal" class="modal"><div class="modal-content template-guide-content"><div class="modal-header"><h3>Template Guide</h3><button class="btn-close" onclick="closeTemplateGuide()">&times;</button></div><div class="modal-body"><h4>Template Syntax</h4><p>Templates use a simple variable substitution syntax with double curly braces:</p><ul><li><code>{{variable}}</code> - Simple variable substitution</li><li><code>{{#each array}}</code> ... <code>{{/each}}</code> - Loop through arrays</li><li><code>{{#if condition}}</code> ... <code>{{/if}}</code> - Conditional content</li></ul><h4>Available Data</h4><p>The following data is available in your templates:</p><ul><li><code>{{reportTitle}}</code> - The report title</li><li><code>{{startDate}}</code> - Report start date (formatted)</li><li><code>{{endDate}}</code> - Report end date (formatted)</li><li><code>{{totalEntries}}</code> - Total number of activity entries</li><li><code>{{entries}}</code> - Array of all activity entries</li></ul><h4>Entry Properties</h4><p>Each entry in the <code>{{#each entries}}</code> loop has:</p><ul><li><code>{{activity}}</code> - The activity name</li><li><code>{{description}}</code> - Activity description</li><li><code>{{timestamp}}</code> - When the activity was logged</li><li><code>{{formattedTime}}</code> - Nicely formatted time (e.g., "2:30 PM")</li><li><code>{{formattedDate}}</code> - Nicely formatted date (e.g., "Jan 15, 2025")</li></ul><h4>Example Template</h4><pre><code># {{reportTitle}}
From {{startDate}} to {{endDate}}

Total activities: {{totalEntries}}

{{#each entries}}
## {{formattedTime}} - {{activity}}
{{#if description}}
*{{description}}*
{{/if}}

{{/each}}</code></pre><h4>Tips</h4><ul><li>Use HTML templates for rich formatting with CSS styles</li><li>Use Markdown templates for simple, readable formatting</li><li>CSV templates are great for data analysis in spreadsheets</li><li>Test your templates with the preview feature</li></ul></div></div></div><div id="pomodoroActivityModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Work Session Activity</h3><button class="btn-close" onclick="closePomodoroActivityModal()">&times;</button></div><div class="modal-body"><form id="pomodoroActivityForm"><div class="form-group"><label for="pomodoroActivityName">What will you be working on?</label> <input id="pomodoroActivityName" required placeholder="e.g., Writing report, Meeting preparation"></div><div class="form-group"><label for="pomodoroActivityDescription">Description (optional)</label> <textarea id="pomodoroActivityDescription" rows="3" placeholder="Additional details about this work session"></textarea></div><div class="modal-actions"><button type="submit" class="btn btn-primary">Start Work Session</button> <button type="button" class="btn btn-secondary" onclick="closePomodoroActivityModal()">Cancel</button></div></form></div></div></div><div id="hashtagBrowserModal" class="modal"><div class="modal-content hashtag-browser-content"><div class="modal-header"><h3>Hashtag Browser</h3><button class="btn-close" onclick="closeHashtagBrowser()">&times;</button></div><div class="modal-body"><div class="hashtag-stats" id="hashtagStats"><span id="hashtagCount">0 hashtags found</span></div><div class="hashtag-cloud" id="hashtagCloud"><p class="empty-state">No hashtags found. Add activities with #hashtags to see them here!</p></div></div></div></div><div id="userGuideModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>üìö User Guide</h3><button class="btn-close" onclick="closeUserGuide()">&times;</button></div><div class="modal-body"><div class="user-guide-content"><div class="guide-section"><h4>üöÄ Getting Started</h4><p>Activity Tracker helps you log activities, manage todos, and generate reports with automatic reminders.</p></div><div class="guide-section"><h4>‚å®Ô∏è Keyboard Shortcuts</h4><ul><li><kbd>Ctrl</kbd> + <kbd>Enter</kbd> - Submit activity form</li><li><kbd>Shift</kbd> + <kbd>Enter</kbd> - Mark as todo and submit</li><li><kbd>Esc</kbd> - Close modals</li></ul></div><div class="guide-section"><h4>üìù Adding Activities</h4><ul><li>Enter what you're doing in the activity field</li><li>Add #hashtags for easy categorization</li><li>Use the "Add as Todo" button for tasks that need completion</li><li>Set due dates for todos using quick-set buttons</li></ul></div><div class="guide-section"><h4>üîç Search & Navigation</h4><ul><li>Use the global search to find activities, todos, and hashtags</li><li>Click the üè∑Ô∏è button to browse hashtags in a visual cloud</li><li>Click any hashtag to search for related items</li><li>Use pagination controls to navigate through large lists</li></ul></div><div class="guide-section"><h4>‚úÖ Managing Todos</h4><ul><li>View all todos in the dedicated "To Do" section</li><li>Filter by status, due date, or category</li><li>Click "Mark Complete" to finish todos</li><li>Overdue items are highlighted in red</li></ul></div><div class="guide-section"><h4>üìä Reports</h4><ul><li>Generate weekly, custom date range, or template-based reports</li><li>Export reports in HTML, Markdown, or CSV formats</li><li>Create custom report templates with variables</li><li>Include/exclude completed todos from reports</li></ul></div><div class="guide-section"><h4>üçÖ Pomodoro Mode (Optional)</h4><ul><li>Enable Pomodoro technique with customizable work/break intervals</li><li>Automatic activity logging during Pomodoro sessions</li><li>Audio notifications for work/break transitions</li><li>Focus timer to help maintain productivity</li></ul></div><div class="guide-section"><h4>‚öôÔ∏è Settings & Customization</h4><ul><li>Customize notification intervals and working hours</li><li>Choose from multiple notification sounds</li><li>Switch between light/dark themes</li><li>Set pagination size for better navigation</li><li>All settings auto-save as you change them</li></ul></div><div class="guide-section"><h4>üíæ Data Management</h4><ul><li>Export your data as JSON backup</li><li>Import previously exported data</li><li>Data is stored locally in your browser</li><li>Works offline after initial load</li></ul></div></div></div></div></div><div id="aboutModal" class="modal"><div class="modal-content about-modal-content"><div class="modal-header"><h3>About Activity Tracker</h3><button class="btn-close" onclick="closeAbout()">&times;</button></div><div class="modal-body"><div class="about-section"><h4>Application Info</h4><div class="debug-info" id="aboutDebugInfo">Loading...</div></div><div class="about-section"><h4>Diagnostic Tools</h4><div class="diagnostic-buttons"><button class="btn btn-secondary" onclick="testNotification()" title="Send a test notification">Test Notification</button> <button class="btn btn-primary" onclick="testNotificationSound()" title="Play a test notification sound">Test Notification Sound</button> <button class="btn btn-secondary" onclick="runServiceWorkerTest()" title="Run comprehensive service worker diagnostics">Test Service Worker</button> <button class="btn btn-secondary" onclick="refreshNotificationStatus()" title="Refresh the notification permission status display - useful if permissions changed outside the app">Refresh Notification Status</button></div></div><div class="about-section"><h4>Version History</h4><p>This is a personal activity tracking application with smart notifications, comprehensive reporting, and Pomodoro timer functionality.</p><p><strong>Features:</strong></p><ul><li>üçÖ Pomodoro Timer with configurable work/break cycles</li><li>‚è∞ Smart notification system with customizable sounds</li><li>üìä Comprehensive activity reporting with custom templates</li><li>üåô Dark mode support</li><li>üíæ Offline functionality with service worker</li><li>üì± Progressive Web App (PWA) support</li></ul></div></div></div></div><script>const APP_VERSION="2025.08.01.368";function formatDateTime(t){return new Date(t).toLocaleString("en-GB",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function formatDate(t){return t.toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function formatTime(t){return new Date(t).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}function escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function showNotification(t,e="info",i=3e3){const n=document.createElement("div");n.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        padding: 15px 20px;\n        border-radius: 8px;\n        color: white;\n        font-weight: 600;\n        z-index: 10000;\n        background: ${"success"===e?"#48bb78":"error"===e?"#f56565":"#667eea"};\n        box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n        animation: slideIn 0.3s ease-out;\n    `;const o=document.createElement("style");o.textContent="\n        @keyframes slideIn {\n            from {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            to {\n                transform: translateX(0);\n                opacity: 1;\n            }\n        }\n        @keyframes slideOut {\n            from {\n                transform: translateX(0);\n                opacity: 1;\n            }\n            to {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n        }\n    ",document.head.appendChild(o),n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{n.parentNode&&n.remove()},300)},i)}function downloadFile(t,e,i){const n=new Blob([t],{type:i}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}function getCurrentTimeForInput(){const t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}function escapeCsv(t){return t?t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t:""}function generateId(){return Date.now().toString()+Math.random().toString(36).substr(2,9)}function isValidDate(t){const e=new Date(t);return e instanceof Date&&!isNaN(e)}function getWeekStart(t){const e=new Date(t),i=t.getDay(),n=0===i?-6:1-i;return e.setDate(t.getDate()+n),e.setHours(0,0,0,0),e}function getWeekEnd(t){const e=new Date(getWeekStart(t));return e.setDate(e.getDate()+6),e.setHours(23,59,59,999),e}function deepClone(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>deepClone(t));if("object"==typeof t){const e={};return Object.keys(t).forEach(i=>{e[i]=deepClone(t[i])}),e}}class SoundManager{constructor(){this.audioContext=null,this.soundTypes={classic:"Classic Bloop",gentle:"Gentle Chime",urgent:"Urgent Ping",digital:"Digital Beep",nature:"Nature Drop",mechanical:"Mechanical Click",spacey:"Spacey Wobble",corporate:"Corporate Ding",retro:"Retro Arcade",piano:"Piano Note",bell:"Temple Bell",whistle:"Train Whistle",bubble:"Bubble Pop",glass:"Glass Tap",wood:"Wood Block",metal:"Metal Ting",ethereal:"Ethereal Hum",cosmic:"Cosmic Blip",ocean:"Ocean Wave",forest:"Forest Chirp",failsafe:"Failsafe","soft-tick":"Soft Tick","classic-tick":"Classic Tick","digital-tick":"Digital Tick"},this.initAudioContext()}initAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.warn("Web Audio API not supported:",t),this.audioContext=null}}getSoundTypes(){return this.soundTypes}playSound(t="classic",e=!1){if(this.audioContext&&!e)try{"suspended"===this.audioContext.state&&this.audioContext.resume();const e=this.audioContext.currentTime;switch(t){case"classic":default:this.playClassicBloop(e);break;case"gentle":this.playGentleChime(e);break;case"urgent":this.playUrgentPing(e);break;case"digital":this.playDigitalBeep(e);break;case"nature":this.playNatureDrop(e);break;case"mechanical":this.playMechanicalClick(e);break;case"spacey":this.playSpaceyWobble(e);break;case"corporate":this.playCorporateDing(e);break;case"retro":this.playRetroArcade(e);break;case"piano":this.playPianoNote(e);break;case"bell":this.playTempleBell(e);break;case"whistle":this.playTrainWhistle(e);break;case"bubble":this.playBubblePop(e);break;case"glass":this.playGlassTap(e);break;case"wood":this.playWoodBlock(e);break;case"metal":this.playMetalTing(e);break;case"ethereal":this.playEtherealHum(e);break;case"cosmic":this.playCosmicBlip(e);break;case"ocean":this.playOceanWave(e);break;case"forest":this.playForestChirp(e);break;case"failsafe":this.playFailsafe(e);break;case"soft-tick":this.playSoftTick(e);break;case"classic-tick":this.playClassicTick(e);break;case"digital-tick":this.playDigitalTick(e)}}catch(t){console.warn("Error playing notification sound:",t)}}playClassicBloop(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(400,t),e.frequency.exponentialRampToValueAtTime(600,t+.1),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playGentleChime(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",i.type="sine",e.frequency.setValueAtTime(523.25,t),i.frequency.setValueAtTime(659.25,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.2,t+.05),n.gain.exponentialRampToValueAtTime(.01,t+1),e.start(t),i.start(t),e.stop(t+1),i.stop(t+1)}playUrgentPing(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(1200,t+.05),e.frequency.exponentialRampToValueAtTime(800,t+.1),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.02),i.gain.exponentialRampToValueAtTime(.01,t+.15),e.start(t),e.stop(t+.15)}playDigitalBeep(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="square",e.frequency.setValueAtTime(1e3,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.01),i.gain.linearRampToValueAtTime(.3,t+.05),i.gain.linearRampToValueAtTime(0,t+.06),e.start(t),e.stop(t+.06)}playNatureDrop(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(1200,t),e.frequency.exponentialRampToValueAtTime(200,t+.8),n.type="lowpass",n.frequency.setValueAtTime(2e3,t),n.frequency.exponentialRampToValueAtTime(300,t+.8),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.25,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+.8),e.start(t),e.stop(t+.8)}playMechanicalClick(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(150,t),n.type="highpass",n.frequency.setValueAtTime(100,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.5,t+.005),i.gain.linearRampToValueAtTime(0,t+.05),e.start(t),e.stop(t+.05)}playSpaceyWobble(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createGain(),o=this.audioContext.createGain();i.connect(n),n.connect(e.frequency),e.connect(o),o.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(300,t),i.type="sine",i.frequency.setValueAtTime(6,t),n.gain.setValueAtTime(50,t),o.gain.setValueAtTime(0,t),o.gain.linearRampToValueAtTime(.3,t+.1),o.gain.exponentialRampToValueAtTime(.01,t+1.2),i.start(t),e.start(t),i.stop(t+1.2),e.stop(t+1.2)}playCorporateDing(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",i.type="sine",e.frequency.setValueAtTime(880,t),i.frequency.setValueAtTime(1108.73,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.25,t+.02),n.gain.exponentialRampToValueAtTime(.01,t+.5),e.start(t),i.start(t),e.stop(t+.5),i.stop(t+.5)}playRetroArcade(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="square",e.frequency.setValueAtTime(220,t),e.frequency.setValueAtTime(330,t+.1),e.frequency.setValueAtTime(440,t+.2),e.frequency.setValueAtTime(550,t+.3),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.02),i.gain.exponentialRampToValueAtTime(.01,t+.4),e.start(t),e.stop(t+.4)}playPianoNote(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createGain();e.connect(n),i.connect(n),n.connect(this.audioContext.destination),e.type="sine",i.type="triangle",e.frequency.setValueAtTime(523.25,t),i.frequency.setValueAtTime(523.25,t),n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(.4,t+.01),n.gain.exponentialRampToValueAtTime(.01,t+1.5),e.start(t),i.start(t),e.stop(t+1.5),i.stop(t+1.5)}playTempleBell(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(400,t+2),n.type="lowpass",n.frequency.setValueAtTime(1200,t),n.Q.setValueAtTime(5,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+2),e.start(t),e.stop(t+2)}playTrainWhistle(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain();e.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(880,t),e.frequency.setValueAtTime(660,t+.5),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.1),i.gain.linearRampToValueAtTime(.4,t+.4),i.gain.exponentialRampToValueAtTime(.01,t+.8),e.start(t),e.stop(t+.8)}playBubblePop(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(800,t),e.frequency.exponentialRampToValueAtTime(400,t+.1),n.type="bandpass",n.frequency.setValueAtTime(600,t),n.Q.setValueAtTime(3,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.01),i.gain.exponentialRampToValueAtTime(.01,t+.1),e.start(t),e.stop(t+.1)}playGlassTap(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(2e3,t),n.type="highpass",n.frequency.setValueAtTime(1e3,t),n.Q.setValueAtTime(2,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.5,t+.005),i.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playWoodBlock(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(400,t),n.type="bandpass",n.frequency.setValueAtTime(800,t),n.Q.setValueAtTime(5,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.6,t+.01),i.gain.exponentialRampToValueAtTime(.01,t+.08),e.start(t),e.stop(t+.08)}playMetalTing(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="triangle",e.frequency.setValueAtTime(1500,t),n.type="highpass",n.frequency.setValueAtTime(800,t),n.Q.setValueAtTime(3,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.4,t+.01),i.gain.exponentialRampToValueAtTime(.01,t+.6),e.start(t),e.stop(t+.6)}playEtherealHum(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),o=this.audioContext.createGain(),a=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();n.connect(o),o.connect(e.frequency),e.connect(s),i.connect(s),s.connect(a),a.connect(this.audioContext.destination),e.type="sine",i.type="sine",e.frequency.setValueAtTime(220,t),i.frequency.setValueAtTime(330,t),n.type="sine",n.frequency.setValueAtTime(.5,t),o.gain.setValueAtTime(10,t),s.type="lowpass",s.frequency.setValueAtTime(800,t),s.Q.setValueAtTime(1,t),a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(.2,t+.3),a.gain.exponentialRampToValueAtTime(.01,t+2),n.start(t),e.start(t),i.start(t),n.stop(t+2),e.stop(t+2),i.stop(t+2)}playCosmicBlip(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),n=this.audioContext.createGain(),o=this.audioContext.createGain(),a=this.audioContext.createBiquadFilter();i.connect(n),n.connect(e.frequency),e.connect(a),a.connect(o),o.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(600,t),i.type="sine",i.frequency.setValueAtTime(20,t),n.gain.setValueAtTime(200,t),a.type="bandpass",a.frequency.setValueAtTime(800,t),a.Q.setValueAtTime(2,t),o.gain.setValueAtTime(0,t),o.gain.linearRampToValueAtTime(.3,t+.05),o.gain.exponentialRampToValueAtTime(.01,t+.4),i.start(t),e.start(t),i.stop(t+.4),e.stop(t+.4)}playOceanWave(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sawtooth",e.frequency.setValueAtTime(80,t),e.frequency.exponentialRampToValueAtTime(40,t+1.5),n.type="lowpass",n.frequency.setValueAtTime(200,t),n.frequency.exponentialRampToValueAtTime(80,t+1.5),n.Q.setValueAtTime(2,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.3,t+.2),i.gain.linearRampToValueAtTime(.2,t+1),i.gain.exponentialRampToValueAtTime(.01,t+1.5),e.start(t),e.stop(t+1.5)}playForestChirp(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.type="sine",e.frequency.setValueAtTime(1200,t),e.frequency.exponentialRampToValueAtTime(1800,t+.1),e.frequency.exponentialRampToValueAtTime(1e3,t+.3),n.type="bandpass",n.frequency.setValueAtTime(1400,t),n.Q.setValueAtTime(3,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.25,t+.05),i.gain.exponentialRampToValueAtTime(.01,t+.3),e.start(t),e.stop(t+.3)}playFailsafe(t){const e=[],i=[],n=[];[130.81,163.5125,196.215,261.62,327.025,392.43,523.24,659.2824].forEach((o,a)=>{const s=this.audioContext.createOscillator(),r=this.audioContext.createGain(),c=this.audioContext.createBiquadFilter();e.push(s),i.push(r),n.push(c),s.connect(c),c.connect(r),r.connect(this.audioContext.destination),s.type=a%2==0?"sine":"triangle",s.frequency.setValueAtTime(o,t),s.frequency.exponentialRampToValueAtTime(1.618*o,t+.8),s.frequency.exponentialRampToValueAtTime(2*o,t+1.6),s.frequency.exponentialRampToValueAtTime(.5*o,t+2.4),c.type="bandpass",c.frequency.setValueAtTime(2*o,t),c.frequency.exponentialRampToValueAtTime(8*o,t+1.2),c.Q.setValueAtTime(3+.5*a,t);const l=.1*a,d=.08/(a+1);r.gain.setValueAtTime(0,t+l),r.gain.linearRampToValueAtTime(d,t+l+.2),r.gain.exponentialRampToValueAtTime(.7*d,t+l+1),r.gain.linearRampToValueAtTime(.3*d,t+l+2),r.gain.exponentialRampToValueAtTime(.001,t+l+3),s.start(t+l),s.stop(t+l+3)});for(let e=0;e<5;e++){const i=this.audioContext.createOscillator(),n=this.audioContext.createGain(),o=this.audioContext.createBiquadFilter();i.connect(o),o.connect(n),n.connect(this.audioContext.destination);const a=800+1200*Math.random();i.type="sine",i.frequency.setValueAtTime(a,t),i.frequency.exponentialRampToValueAtTime(2*a,t+.3),o.type="highpass",o.frequency.setValueAtTime(1500,t),o.Q.setValueAtTime(10,t);const s=.4*e;n.gain.setValueAtTime(0,t+s),n.gain.linearRampToValueAtTime(.03,t+s+.05),n.gain.exponentialRampToValueAtTime(.001,t+s+.3),i.start(t+s),i.stop(t+s+.3)}const o=this.audioContext.createDelay(.3),a=this.audioContext.createGain(),s=this.audioContext.createBiquadFilter();o.delayTime.setValueAtTime(.15,t),a.gain.setValueAtTime(.2,t),s.type="lowpass",s.frequency.setValueAtTime(8e3,t),o.connect(s),s.connect(a),a.connect(o),a.connect(this.audioContext.destination),i.length>0&&(i[0].connect(o),i.length>2&&i[2].connect(o))}playSoftTick(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(1800,t),e.frequency.exponentialRampToValueAtTime(900,t+.005),n.type="bandpass",n.frequency.setValueAtTime(1200,t),n.Q.setValueAtTime(4,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.035,t+5e-4),i.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}playClassicTick(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(2e3,t),e.frequency.exponentialRampToValueAtTime(1e3,t+.005),n.type="bandpass",n.frequency.setValueAtTime(1350,t),n.Q.setValueAtTime(5,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.045,t+5e-4),i.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}playDigitalTick(t){const e=this.audioContext.createOscillator(),i=this.audioContext.createGain(),n=this.audioContext.createBiquadFilter();e.type="triangle",e.frequency.setValueAtTime(2200,t),e.frequency.exponentialRampToValueAtTime(1100,t+.005),n.type="bandpass",n.frequency.setValueAtTime(1500,t),n.Q.setValueAtTime(6,t),i.gain.setValueAtTime(0,t),i.gain.linearRampToValueAtTime(.05,t+5e-4),i.gain.exponentialRampToValueAtTime(.001,t+.02),e.connect(n),n.connect(i),i.connect(this.audioContext.destination),e.start(t),e.stop(t+.02)}testSound(t,e=!1){this.playSound(t,e)}}"undefined"!=typeof window&&(window.SoundManager=SoundManager);class PauseManager{constructor(t){this.tracker=t,this.countdownInterval=null,this.pauseButton=null,this.originalButtonText="Pause Alerts",this.init()}init(){this.pauseButton=document.getElementById("pauseButton"),this.pauseButton&&this.updatePauseButtonDisplay()}startPause(t){this.stopCountdown(),-1===t?(this.tracker.settings.notificationsPausedUntil=1/0,this.updatePauseButtonForever()):(this.tracker.settings.notificationsPausedUntil=(new Date).getTime()+60*t*1e3,this.startCountdown()),this.tracker.saveSettings()}resume(){this.stopCountdown(),this.tracker.settings.notificationsPausedUntil=null,this.updatePauseButtonNormal(),this.tracker.saveSettings()}startCountdown(){this.countdownInterval&&clearInterval(this.countdownInterval),this.updateCountdownDisplay(),this.countdownInterval=setInterval(()=>{this.updateCountdownDisplay()},1e3)}stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}updateCountdownDisplay(){if(!this.pauseButton||!this.tracker.settings.notificationsPausedUntil)return void this.updatePauseButtonNormal();const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil;if(e===1/0)return void this.updatePauseButtonForever();const i=e-t;if(i<=0)return this.resume(),void showNotification("Notifications automatically resumed","success");const n=Math.floor(i/1e3),o=Math.floor(n/3600),a=Math.floor(n%3600/60),s=n%60;let r;r=o>0?`${o}h ${a}m ${s}s`:a>0?`${a}m ${s}s`:`${s}s`,this.pauseButton.textContent=`Resume (${r})`;const c=60*this.tracker.settings.pauseDuration*1e3,l=c-i,d=Math.max(0,Math.min(100,l/c*100));this.applyDrainingEffect(d)}applyDrainingEffect(t){const e="rgba(229, 62, 62, 0.3)",i="#e53e3e";this.pauseButton.style.background=`linear-gradient(to left, ${e} 0%, ${e} ${t}%, ${i} ${t}%, ${i} 100%)`,this.pauseButton.style.transition="background 1s ease-out",this.pauseButton.style.animation=t>90?"pulse 1s infinite":"none"}updatePauseButtonForever(){this.pauseButton.textContent="Resume (Paused Forever)",this.pauseButton.style.background="#e53e3e",this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}updatePauseButtonNormal(){const t=this.tracker.settings.notificationsEnabled?"Pause Alerts":"Start Alerts";this.pauseButton.textContent=t,this.pauseButton.style.background="",this.pauseButton.style.animation="none",this.pauseButton.style.transition=""}updatePauseButtonDisplay(){this.pauseButton&&(this.tracker.settings.notificationsPausedUntil?this.tracker.settings.notificationsPausedUntil===1/0?this.updatePauseButtonForever():this.startCountdown():this.updatePauseButtonNormal())}isPaused(){return!!this.tracker.settings.notificationsPausedUntil&&(this.tracker.settings.notificationsPausedUntil===1/0||(new Date).getTime()<this.tracker.settings.notificationsPausedUntil)}getRemainingTime(){if(!this.tracker.settings.notificationsPausedUntil)return 0;if(this.tracker.settings.notificationsPausedUntil===1/0)return-1;const t=(new Date).getTime(),e=this.tracker.settings.notificationsPausedUntil-t;return Math.max(0,e)}destroy(){this.stopCountdown()}}"undefined"!=typeof window&&(window.PauseManager=PauseManager);class PomodoroManager{constructor(t){this.activityTracker=t,this.isActive=!1,this.isRunning=!1,this.isPaused=!1,this.pausedAt=null,this.currentPhase="work",this.cycleCount=0,this.totalSessions=0,this.timer=null,this.tickTimer=null,this.remainingTime=0,this.startTime=null,this.originalDuration=0,this.settings={enabled:!1,workDuration:25,breakDuration:5,longBreakDuration:15,longBreakInterval:4,tickSound:"none",tickInterval:0,shortBreakSound:"gentle",longBreakSound:"bell",resumeSound:"digital",autoStart:!1,autoLog:!0,logBreaks:!1,longBreak:!0,pauseAllowed:!0},this.statusUpdateInterval=null,this.init()}init(){const t=document.getElementById("pomodoroEnabled");t&&t.addEventListener("change",()=>{this.togglePomodoroMode(t.checked)}),this.setupAutoSaveListeners(),this.loadSettings()}setupAutoSaveListeners(){["pomodoroWorkDuration","pomodoroBreakDuration","pomodoroLongBreakDuration","pomodoroLongBreakInterval","pomodoroTickSound","pomodoroTickInterval","pomodoroShortBreakSound","pomodoroLongBreakSound","pomodoroResumeSound","pomodoroAutoStart","pomodoroAutoLog","pomodoroLogBreaks","pomodoroLongBreak"].forEach(t=>{const e=document.getElementById(t);if(e){const t=(e.type,"change");e.addEventListener(t,()=>{this.saveSettings(),this.loadSettings()})}})}loadSettings(){if(this.activityTracker&&this.activityTracker.settings){const t=this.activityTracker.settings;this.settings={enabled:t.pomodoroEnabled||!1,workDuration:parseInt(t.pomodoroWorkDuration)||25,breakDuration:parseInt(t.pomodoroBreakDuration)||5,longBreakDuration:parseInt(t.pomodoroLongBreakDuration)||15,longBreakInterval:parseInt(t.pomodoroLongBreakInterval)||4,tickSound:t.pomodoroTickSound||"none",tickInterval:parseInt(t.pomodoroTickInterval)||0,shortBreakSound:t.pomodoroShortBreakSound||"gentle",longBreakSound:t.pomodoroLongBreakSound||"bell",resumeSound:t.pomodoroResumeSound||"digital",autoStart:t.pomodoroAutoStart||!1,autoLog:!1!==t.pomodoroAutoLog,logBreaks:t.pomodoroLogBreaks||!1,longBreak:!1!==t.pomodoroLongBreak,pauseAllowed:!1!==t.pomodoroPauseAllowed},this.cycleCount=parseInt(t.pomodoroCycleCount)||0,this.totalSessions=parseInt(t.pomodoroTotalSessions)||0;const e=t.pomodoroIsActive||!1,i=t.pomodoroIsRunning||!1,n=t.pomodoroCurrentPhase||"work",o=t.pomodoroStartTime,a=t.pomodoroRemainingTime;e&&i&&o&&a?this.restoreActiveSession(n,o,a):e&&!i&&(this.isActive=!0),this.updateUI()}}updateUI(){const t=document.getElementById("pomodoroEnabled"),e=document.getElementById("pomodoroConfig"),i=document.getElementById("pomodoroWorkDuration"),n=document.getElementById("pomodoroBreakDuration"),o=document.getElementById("pomodoroLongBreakDuration"),a=document.getElementById("pomodoroLongBreakInterval"),s=document.getElementById("pomodoroTickSound"),r=document.getElementById("pomodoroTickInterval"),c=document.getElementById("pomodoroShortBreakSound"),l=document.getElementById("pomodoroLongBreakSound"),d=document.getElementById("pomodoroResumeSound"),u=document.getElementById("pomodoroAutoStart"),m=document.getElementById("pomodoroAutoLog"),p=document.getElementById("pomodoroLogBreaks"),h=document.getElementById("pomodoroLongBreak"),g=document.getElementById("pomodoroStatus");t&&(t.checked=this.settings.enabled),e&&(e.style.display=this.settings.enabled?"block":"none"),i&&(i.value=this.settings.workDuration.toString()),n&&(n.value=this.settings.breakDuration.toString()),o&&(o.value=this.settings.longBreakDuration.toString()),a&&(a.value=this.settings.longBreakInterval.toString()),s&&(s.value=this.settings.tickSound),r&&(r.value=this.settings.tickInterval.toString()),c&&(c.value=this.settings.shortBreakSound),l&&(l.value=this.settings.longBreakSound),d&&(d.value=this.settings.resumeSound),u&&(u.checked=this.settings.autoStart),m&&(m.checked=this.settings.autoLog),p&&(p.checked=this.settings.logBreaks),h&&(h.checked=this.settings.longBreak),this.updatePomodoroButton(),g&&this.updateStatusDisplay()}togglePomodoroMode(t){this.settings.enabled=t,this.isActive=t;const e=document.getElementById("pomodoroConfig");e&&(e.style.display=t?"block":"none"),this.updatePomodoroButton(),t?this.startPomodoroMode():this.stopPomodoroMode(),this.activityTracker&&(this.activityTracker.settings.pomodoroEnabled=t,this.activityTracker.saveSettings())}startPomodoroMode(){this.isActive&&(this.currentPhase="work",this.cycleCount=0,this.isRunning=!1,this.updateStatusDisplay(),showNotification("üçÖ Pomodoro mode enabled! Click the üçÖ button to start your first session.","success"))}stopPomodoroMode(){this.isActive=!1,this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.settings.autoLog&&"work"===this.currentPhase&&this.logActivity("Pomodoro session ended","Work session interrupted"),this.activityTracker&&this.activityTracker.settings&&(this.activityTracker.settings.pomodoroIsActive=!1,this.activityTracker.settings.pomodoroIsRunning=!1,this.activityTracker.settings.pomodoroCurrentPhase=null,this.activityTracker.settings.pomodoroStartTime=null,this.activityTracker.settings.pomodoroRemainingTime=null,this.activityTracker.saveSettings()),this.updateUI(),showNotification("üçÖ Pomodoro mode stopped.","info")}startWorkPeriod(){if(this.isActive)return this.settings.autoLog?(this.pendingWorkSession=!0,void this.showWorkActivityModal()):void this.actuallyStartWorkPeriod()}actuallyStartWorkPeriod(){this.isActive&&(this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.currentPhase="work",this.isRunning=!0,this.isPaused=!1,this.pausedAt=null,this.remainingTime=60*this.settings.workDuration*1e3,this.originalDuration=this.remainingTime,this.startTime=Date.now(),this.timer=setTimeout(()=>{this.endWorkPeriod()},this.remainingTime),this.startTickSounds(),this.startStatusUpdates(),this.saveSessionProgress(),this.updateUI())}endWorkPeriod(){this.isActive&&(this.cycleCount++,this.totalSessions++,this.isRunning=!1,this.stopTickSounds(),this.saveSessionProgress(),this.settings.autoLog&&(this.currentWorkActivity?this.logActivity(this.currentWorkActivity.name,this.currentWorkActivity.description||`Completed ${this.settings.workDuration} minute Pomodoro work session`):this.logActivity(`Pomodoro work period #${this.cycleCount} completed`,`Completed ${this.settings.workDuration} minute focused work session`)),this.activityTracker&&this.activityTracker.playNotificationSound(),this.showWorkCompleteNotification(),this.updateUI(),setTimeout(()=>{this.startBreakPeriod()},1e3))}startBreakPeriod(){if(!this.isActive)return;this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.currentPhase="break",this.isRunning=!0,this.isPaused=!1,this.pausedAt=null;const t=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0,e=t?this.settings.longBreakDuration:this.settings.breakDuration;this.remainingTime=60*e*1e3,this.originalDuration=this.remainingTime,this.startTime=Date.now(),this.timer=setTimeout(()=>{this.endBreakPeriod()},this.remainingTime),this.startStatusUpdates(),this.saveSessionProgress(),this.updateUI();const i=t?"long break":"break",n=t?this.settings.longBreakSound:this.settings.shortBreakSound;if(this.activityTracker&&this.activityTracker.soundManager){const t=this.activityTracker.isPomodoroSoundMuted();this.activityTracker.soundManager.playSound(n,t)}this.showBreakStartNotification(i,e)}endBreakPeriod(){if(this.isActive){if(this.isRunning=!1,this.settings.logBreaks){const t=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0?"long break":"break";this.logActivity(`Pomodoro ${t} completed`,"Finished rest period, ready for next work session")}if(this.activityTracker&&this.activityTracker.playNotificationSound(),this.activityTracker&&this.activityTracker.soundManager){const t=this.activityTracker.isPomodoroSoundMuted();this.activityTracker.soundManager.playSound(this.settings.resumeSound,t)}this.showBackToWorkNotification(),this.updateUI(),this.settings.autoStart?setTimeout(()=>{this.startWorkPeriod()},1e3):showNotification("üçÖ Break finished! Click the Pomodoro button to continue.","info",1e4)}}showWorkCompleteNotification(){const t={body:`Work period #${this.cycleCount} complete! Time for a break.`,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23f56565"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',tag:"pomodoro-work-complete",requireInteraction:!0,actions:[{action:"start-break",title:"Start Break",icon:"‚òï"},{action:"continue-work",title:"Continue Working",icon:"üí™"}]};this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker("üçÖ Pomodoro - Work Complete!",t)}showBreakStartNotification(t,e){const i={body:`Take a ${t} for ${e} minutes. You've earned it!`,icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2348bb78"><path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zM20.71 4.63l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/></svg>',tag:"pomodoro-break-start",requireInteraction:!1};this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker(`üçÖ ${t.charAt(0).toUpperCase()+t.slice(1)} Time!`,i)}showBackToWorkNotification(){this.activityTracker&&this.activityTracker.showNotificationWithServiceWorker("üçÖ Back to Work!",{body:"Break time is over. Ready to get back to focused work?",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"pomodoro-back-to-work",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Log Work Activity",placeholder:"What will you work on next?"}]})}logActivity(t,e){if(!this.activityTracker||!this.settings.autoLog)return;const i={id:Date.now().toString()+Math.random().toString(36).substr(2,9),activity:t,description:e||"",timestamp:(new Date).toISOString(),created:(new Date).toISOString(),source:"pomodoro"};this.activityTracker.addEntry(i)}saveSettings(){if(!this.activityTracker)return;const t=document.getElementById("pomodoroWorkDuration"),e=document.getElementById("pomodoroBreakDuration"),i=document.getElementById("pomodoroLongBreakDuration"),n=document.getElementById("pomodoroLongBreakInterval"),o=document.getElementById("pomodoroTickSound"),a=document.getElementById("pomodoroTickInterval"),s=document.getElementById("pomodoroShortBreakSound"),r=document.getElementById("pomodoroLongBreakSound"),c=document.getElementById("pomodoroResumeSound"),l=document.getElementById("pomodoroAutoStart"),d=document.getElementById("pomodoroAutoLog"),u=document.getElementById("pomodoroLogBreaks"),m=document.getElementById("pomodoroLongBreak");t&&(this.settings.workDuration=parseInt(t.value)),e&&(this.settings.breakDuration=parseInt(e.value)),i&&(this.settings.longBreakDuration=parseInt(i.value)),n&&(this.settings.longBreakInterval=parseInt(n.value)),o&&(this.settings.tickSound=o.value),a&&(this.settings.tickInterval=parseInt(a.value)),s&&(this.settings.shortBreakSound=s.value),r&&(this.settings.longBreakSound=r.value),c&&(this.settings.resumeSound=c.value),l&&(this.settings.autoStart=l.checked),d&&(this.settings.autoLog=d.checked),u&&(this.settings.logBreaks=u.checked),m&&(this.settings.longBreak=m.checked),this.activityTracker.settings.pomodoroWorkDuration=this.settings.workDuration,this.activityTracker.settings.pomodoroBreakDuration=this.settings.breakDuration,this.activityTracker.settings.pomodoroLongBreakDuration=this.settings.longBreakDuration,this.activityTracker.settings.pomodoroLongBreakInterval=this.settings.longBreakInterval,this.activityTracker.settings.pomodoroTickSound=this.settings.tickSound,this.activityTracker.settings.pomodoroTickInterval=this.settings.tickInterval,this.activityTracker.settings.pomodoroShortBreakSound=this.settings.shortBreakSound,this.activityTracker.settings.pomodoroLongBreakSound=this.settings.longBreakSound,this.activityTracker.settings.pomodoroResumeSound=this.settings.resumeSound,this.activityTracker.settings.pomodoroAutoStart=this.settings.autoStart,this.activityTracker.settings.pomodoroAutoLog=this.settings.autoLog,this.activityTracker.settings.pomodoroLogBreaks=this.settings.logBreaks,this.activityTracker.settings.pomodoroLongBreak=this.settings.longBreak}getCurrentStatus(){if(!this.isActive)return"Disabled";if(!this.isRunning)return"Paused";const t=Math.ceil((this.remainingTime-(Date.now()-this.startTime))/6e4);return`${"work"===this.currentPhase?"Working":"Break"}${"work"===this.currentPhase?` (Session ${this.cycleCount+1})`:""} - ${Math.max(0,t)}m left`}startTickSounds(){if(this.stopTickSounds(),!this.isActive||"work"!==this.currentPhase||"none"===this.settings.tickSound||this.settings.tickInterval<=0)return;const t=()=>{this.isActive&&this.isRunning&&"work"===this.currentPhase&&(this.playTickSound(),this.tickTimer=setTimeout(t,1e3*this.settings.tickInterval))};this.tickTimer=setTimeout(t,1e3*this.settings.tickInterval)}stopTickSounds(){this.tickTimer&&(clearTimeout(this.tickTimer),this.tickTimer=null)}playTickSound(){if(!this.activityTracker||!this.activityTracker.soundManager)return void console.warn("üçÖ Tick sound: No sound manager available");if("none"===this.settings.tickSound)return;if(this.activityTracker.isPomodoroSoundMuted())return;let t="soft-tick";switch(this.settings.tickSound){case"soft":t="soft-tick";break;case"classic":t="classic-tick";break;case"digital":t="digital-tick"}this.activityTracker.soundManager.playSound(t,!1)}abandonCurrentSession(){if(!this.isActive||!this.isRunning)return;const t="work"===this.currentPhase?this.cycleCount+1:this.cycleCount;this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.settings.autoLog&&this.logActivity(`Pomodoro session ${t} abandoned`,`Session interrupted, restarting at session ${t}`),"work"===this.currentPhase||(this.cycleCount=Math.max(0,this.cycleCount-1)),this.isRunning=!1,this.currentPhase="work",this.saveSessionProgress(),showNotification(`üçÖ Session abandoned. Restarting at session ${t}`,"warning"),this.updateUI(),setTimeout(()=>{this.startWorkPeriod()},2e3)}saveSessionProgress(){this.activityTracker&&this.activityTracker.settings&&(this.activityTracker.settings.pomodoroCycleCount=this.cycleCount,this.activityTracker.settings.pomodoroTotalSessions=this.totalSessions,this.activityTracker.settings.pomodoroIsActive=this.isActive,this.activityTracker.settings.pomodoroIsRunning=this.isRunning,this.activityTracker.settings.pomodoroCurrentPhase=this.currentPhase,this.activityTracker.settings.pomodoroStartTime=this.startTime,this.activityTracker.settings.pomodoroRemainingTime=this.remainingTime,localStorage.setItem("activityTrackerSettings",JSON.stringify(this.activityTracker.settings)))}updateStatusDisplay(){const t=document.getElementById("pomodoroStatus"),e=document.getElementById("pomodoroStatusBanner"),i=document.getElementById("pomodoroTimer"),n=document.getElementById("pomodoroTimeRemaining"),o=document.getElementById("pomodoroPhase");if(!t)return;if(!this.isActive)return t.textContent="Pomodoro mode disabled",t.className="pomodoro-status disabled",void(e&&(e.style.display="none"));if(e&&(e.style.display="block"),!this.isRunning){const e=this.cycleCount+1;return this.settings.longBreak&&this.settings.longBreakInterval,t.textContent=`Ready to start session ${e}`,t.className="pomodoro-status ready",i&&(i.style.display="none"),void this.hidePauseButton()}i&&(i.style.display="flex");const a=Math.ceil((this.remainingTime-(Date.now()-this.startTime))/6e4);let s;if(Math.max(0,a),this.isPaused){const t=this.pausedAt-this.startTime;s=this.originalDuration-t}else s=this.remainingTime-(Date.now()-this.startTime);const r=Math.floor(s/6e4),c=Math.floor(s%6e4/1e3),l=`${Math.max(0,r)}:${Math.max(0,c).toString().padStart(2,"0")}`;if("work"===this.currentPhase){const e=this.cycleCount+1,i=this.isPaused?`Work Session ${e} (Paused)`:`Work Session ${e}`;t.textContent=i,t.className=this.isPaused?"pomodoro-status paused":"pomodoro-status working",n&&(n.textContent=l),o&&(o.textContent=this.isPaused?"Work Session (Paused)":"Work Session")}else{const e=this.settings.longBreak&&this.cycleCount>0&&this.cycleCount%this.settings.longBreakInterval===0?"Long Break":"Short Break",i=this.isPaused?`${e} (Paused)`:e;t.textContent=i,t.className=this.isPaused?"pomodoro-status paused":"pomodoro-status breaking",n&&(n.textContent=l),o&&(o.textContent=i)}this.settings.pauseAllowed?(this.showPauseButton(),this.updatePauseButtonText()):this.hidePauseButton()}updatePomodoroButton(){const t=document.getElementById("pomodoroButton");if(t)if(this.settings.enabled)if(t.style.display="inline-block",this.isActive)if(this.isRunning)if("work"===this.currentPhase){const e=this.cycleCount+1;t.textContent=`üçÖ Abandon Session ${e}`,t.className="nav-btn pomodoro-btn active",t.title="Abandon current work session and restart"}else t.textContent="üçÖ On Break",t.className="nav-btn pomodoro-btn breaking",t.title="Currently on break - click to abandon and restart";else{const e=this.cycleCount+1;t.textContent=`üçÖ Start Session ${e}`,t.className="nav-btn pomodoro-btn",t.title=`Start work session ${e}`}else t.textContent="üçÖ Start Pomodoro",t.className="nav-btn pomodoro-btn",t.title="Start a new Pomodoro session";else t.style.display="none"}togglePomodoroFromButton(){this.isActive?this.isRunning?this.abandonCurrentSession():this.startWorkPeriod():this.togglePomodoroMode(!0)}startStatusUpdates(){this.stopStatusUpdates(),this.statusUpdateInterval=setInterval(()=>{this.isActive&&this.isRunning&&(this.updateStatusDisplay(),this.updatePomodoroButton())},1e3)}stopStatusUpdates(){this.statusUpdateInterval&&(clearInterval(this.statusUpdateInterval),this.statusUpdateInterval=null)}restoreActiveSession(t,e,i){const n=Date.now(),o=i-(n-e);o<=0?"work"===t?(this.isActive=!0,this.isRunning=!1,this.currentPhase="work",showNotification("üçÖ Work session completed while page was closed. Ready for break!","info")):(this.isActive=!0,this.isRunning=!1,this.currentPhase="break",showNotification("üçÖ Break completed while page was closed. Ready for next work session!","info")):(this.isActive=!0,this.isRunning=!0,this.currentPhase=t,this.startTime=n,this.remainingTime=o,this.timer=setTimeout(()=>{"work"===this.currentPhase?this.endWorkPeriod():this.endBreakPeriod()},o),"work"===this.currentPhase&&this.startTickSounds(),this.startStatusUpdates(),showNotification(`üçÖ Pomodoro session restored! ${Math.ceil(o/6e4)} minutes remaining in ${t} period.`,"success")),this.updateUI()}resetSessionCounter(){this.cycleCount=0,this.totalSessions=0,this.saveSessionProgress(),this.updateUI(),this.settings.autoLog&&this.logActivity("Pomodoro session counter reset","Starting fresh Pomodoro cycle"),showNotification("üçÖ Pomodoro session counter reset","info")}showWorkActivityModal(){if("function"==typeof showPomodoroActivityModal){showPomodoroActivityModal();const t=document.getElementById("pomodoroActivityForm");t&&!t.pomodoroHandlerAdded&&(t.addEventListener("submit",t=>{t.preventDefault(),this.handleWorkActivitySubmit()}),t.pomodoroHandlerAdded=!0)}}handleWorkActivitySubmit(){const t=document.getElementById("pomodoroActivityName"),e=document.getElementById("pomodoroActivityDescription");t&&t.value.trim()&&(this.currentWorkActivity={name:t.value.trim(),description:e?e.value.trim():""},"function"==typeof closePomodoroActivityModal&&closePomodoroActivityModal(),this.pendingWorkSession=!1,this.actuallyStartWorkPeriod())}togglePause(){this.isActive&&this.isRunning&&(this.settings.pauseAllowed?this.isPaused?this.resumeSession():this.pauseSession():showNotification("üçÖ Session pausing is disabled in settings","warning"))}pauseSession(){this.isActive&&this.isRunning&&!this.isPaused&&(this.isPaused=!0,this.pausedAt=Date.now(),this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.updateStatusDisplay(),this.updatePomodoroButton(),showNotification("üçÖ Pomodoro session paused","info"))}resumeSession(){if(!this.isActive||!this.isPaused)return;const t=this.pausedAt-this.startTime,e=this.originalDuration-t;this.startTime=Date.now(),this.remainingTime=e,this.isPaused=!1,this.pausedAt=null,this.timer=setTimeout(()=>{"work"===this.currentPhase?this.endWorkPeriod():this.endBreakPeriod()},this.remainingTime),"work"===this.currentPhase&&this.startTickSounds(),this.startStatusUpdates(),this.updateStatusDisplay(),this.updatePomodoroButton(),showNotification("üçÖ Pomodoro session resumed","success")}showPauseButton(){const t=document.getElementById("pomodoroBannerControls");t&&(t.style.display="flex")}hidePauseButton(){const t=document.getElementById("pomodoroBannerControls");t&&(t.style.display="none")}updatePauseButtonText(){const t=document.getElementById("pomodoroPauseBtn");t&&(t.textContent=this.isPaused?"Resume":"Pause")}destroy(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.stopTickSounds(),this.stopStatusUpdates(),this.isActive=!1,this.isRunning=!1}}"undefined"!=typeof window&&(window.PomodoroManager=PomodoroManager);class MarkdownRenderer{constructor(){this.rules=[{pattern:/^### (.*$)/gim,replacement:"<h3>$1</h3>"},{pattern:/^## (.*$)/gim,replacement:"<h2>$1</h2>"},{pattern:/^# (.*$)/gim,replacement:"<h1>$1</h1>"},{pattern:/\*\*(.*)\*\*/gim,replacement:"<strong>$1</strong>"},{pattern:/\*(.*)\*/gim,replacement:"<em>$1</em>"},{pattern:/`(.*)`/gim,replacement:"<code>$1</code>"},{pattern:/\[([^\]]*)\]\(([^\)]*)\)/gim,replacement:'<a href="$2">$1</a>'},{pattern:/^---\s*$/gim,replacement:"<hr>"},{pattern:/^> (.*)$/gim,replacement:"<blockquote>$1</blockquote>"},{pattern:/^\- (.*)$/gim,replacement:"<li>$1</li>"}]}render(t,e=!1){if(!t||"string"!=typeof t)return"";let i=t.trim();return this.rules.forEach(t=>{i=i.replace(t.pattern,t.replacement)}),i=i.replace(/\n\s*\n/gim,"</p><p>"),i=i.replace(/\n(?![<\/])/gim,"<br>"),e&&i.match(/^<(h[1-6]|ul|ol|blockquote|hr)/)||(i="<p>"+i+"</p>"),i=i.replace(/<p>\s*<\/p>/gim,""),i=i.replace(/<p><h/gim,"<h"),i=i.replace(/<\/h([1-6])><\/p>/gim,"</h$1>"),i=i.replace(/<p><hr><\/p>/gim,"<hr>"),i=i.replace(/<p><blockquote>/gim,"<blockquote>"),i=i.replace(/<\/blockquote><\/p>/gim,"</blockquote>"),i=i.replace(/<p><ul>/gim,"<ul>"),i=i.replace(/<\/ul><\/p>/gim,"</ul>"),i=this.renderLists(i),i=i.replace(/<br>\s*<\/li>/gim,"</li>"),i=i.replace(/<li><br>/gim,"<li>"),i=i.replace(/<\/ul><br>/gim,"</ul>"),i=i.replace(/<br><ul>/gim,"<ul>"),i}renderLists(t){return(t=(t=(t=(t=(t=(t=t.replace(/(<li>.*?<\/li>)(\s*(<br>)?\s*<li>.*?<\/li>)*/gim,t=>(t.replace(/<br>\s*(?=<li>)/gim,""),"<ul>"+t+"</ul>"))).replace(/<p><ul>/gim,"<ul>")).replace(/<\/ul><\/p>/gim,"</ul>")).replace(/<p><li>/gim,"<li>")).replace(/<\/li><\/p>/gim,"</li>")).replace(/<br>\s*<ul>/gim,"<ul>")).replace(/<\/ul>\s*<br>/gim,"</ul>")}renderInline(t){return this.render(t,!0)}renderWithClasses(t,e=!1){let i=this.render(t,e);return i=i.replace(/<h1>/gim,'<h1 class="md-h1">'),i=i.replace(/<h2>/gim,'<h2 class="md-h2">'),i=i.replace(/<h3>/gim,'<h3 class="md-h3">'),i=i.replace(/<blockquote>/gim,'<blockquote class="md-blockquote">'),i=i.replace(/<code>/gim,'<code class="md-code">'),i=i.replace(/<ul>/gim,'<ul class="md-list">'),i=i.replace(/<p>/gim,'<p class="md-paragraph">'),i=i.replace(/<hr>/gim,'<hr class="md-hr">'),i}renderInlineWithClasses(t){return this.renderWithClasses(t,!0)}preview(t,e=10){if(!t)return"";const i=t.split("\n").slice(0,e),n=i.join("\n");return i.length>=e&&t.split("\n").length>e?this.renderWithClasses(n)+'<p class="md-preview-more">...</p>':this.renderWithClasses(n)}}"undefined"!=typeof window&&(window.MarkdownRenderer=MarkdownRenderer);class TemplatingEngine{constructor(){this.formatters={date:(t,e="dd/mm/yyyy")=>this.formatDate(t,e),time:t=>{if(!t)return"--:--";let e=t instanceof Date?t:new Date(t);return isNaN(e.getTime())?"--:--":e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})},datetime:t=>new Date(t).toLocaleString("en-GB"),uppercase:t=>String(t).toUpperCase(),lowercase:t=>String(t).toLowerCase(),capitalize:t=>String(t).charAt(0).toUpperCase()+String(t).slice(1),escapeHtml:t=>this.escapeHtml(t),escapeCsv:t=>this.escapeCsv(t),nl2br:t=>String(t).replace(/\n/g,"<br>"),stripLinebreaks:t=>String(t).replace(/(\r\n|\n|\r)/gm," "),duration:t=>this.formatDuration(t),markdown:t=>window.MarkdownRenderer?(new window.MarkdownRenderer).renderInlineWithClasses(String(t)):this.escapeHtml(t)}}render(t,e){try{const i=this.tokenize(t),n=this.parse(i);return this.evaluate(n,e)}catch(t){return console.error("‚ùå Template render error:",t),`Template Error: ${t.message}`}}tokenize(t){const e=[];let i=0;for(;i<t.length;){const n=t.indexOf("{{",i);if(-1===n){i<t.length&&e.push({type:"TEXT",value:t.substring(i)});break}n>i&&e.push({type:"TEXT",value:t.substring(i,n)});const o=t.indexOf("}}",n);if(-1===o)throw new Error("Unclosed template expression at position "+n);const a=t.substring(n+2,o).trim(),s=this.parseExpression(a);e.push(s),i=o+2}return e}parseExpression(t){if(t.startsWith("#each ")){const e=t.match(/^#each\s+(\w+)\s*=\s*([\w.]+)$/);if(!e)throw new Error("Invalid each expression: "+t);return{type:"EACH_START",itemVar:e[1],arrayPath:e[2]}}if("/each"===t)return{type:"EACH_END"};if(t.startsWith("#if "))return{type:"IF_START",condition:t.substring(4).trim()};if("else"===t)return{type:"ELSE"};if("/if"===t)return{type:"IF_END"};const e=t.split("|").map(t=>t.trim());return{type:"VARIABLE",path:e[0],formatters:e.slice(1)}}parse(t){const e=[];let i=0;for(;i<t.length;){const n=this.parseNode(t,i);n?(e.push(n.node),i=n.nextIndex):i++}return e}parseNode(t,e){if(e>=t.length)return null;const i=t[e];switch(i.type){case"TEXT":return{node:{type:"text",value:i.value},nextIndex:e+1};case"VARIABLE":return{node:{type:"variable",path:i.path,formatters:i.formatters},nextIndex:e+1};case"EACH_START":return this.parseEachLoop(t,e);case"IF_START":return this.parseIfStatement(t,e);case"EACH_END":case"IF_END":case"ELSE":return console.warn("‚ö†Ô∏è Orphaned token:",i.type,"at index",e),null;default:throw new Error("Unknown token type: "+i.type)}}parseEachLoop(t,e){const i=t[e],n=[];let o=e+1,a=1;for(;o<t.length&&a>0;){const e=t[o];if("EACH_START"===e.type){const e=this.parseEachLoop(t,o);n.push(e.node),o=e.nextIndex}else if("EACH_END"===e.type){if(a--,0===a)break;console.error(`‚ùå Unexpected EACH_END at depth ${a} for ${i.itemVar}`),o++}else{const e=this.parseNode(t,o);e?(n.push(e.node),o=e.nextIndex):o++}}if(a>0)throw console.error(`‚ùå Unclosed each loop for ${i.itemVar}, depth: ${a}, current: ${o}, tokens.length: ${t.length}`),console.error("Remaining tokens:",t.slice(o).map(t=>`${t.type}: ${JSON.stringify(t.value||t.path)}`)),new Error(`Unclosed each loop for ${i.itemVar}`);return{node:{type:"each",itemVar:i.itemVar,arrayPath:i.arrayPath,children:n},nextIndex:o+1}}parseIfStatement(t,e){const i=t[e],n=[],o=[];let a=e+1,s=1,r=!1;for(;a<t.length&&s>0;){const e=t[a];if("IF_START"===e.type){s++;const e=this.parseIfStatement(t,a);r?o.push(e.node):n.push(e.node),a=e.nextIndex}else if("IF_END"===e.type){if(s--,0===s)break;a++}else if("ELSE"===e.type&&1===s)r=!0,a++;else{const e=this.parseNode(t,a);e?(r?o.push(e.node):n.push(e.node),a=e.nextIndex):a++}}return{node:{type:"if",condition:i.condition,ifChildren:n,elseChildren:o},nextIndex:a+1}}evaluate(t,e,i=0){return"  ".repeat(i),t.map(t=>this.evaluateNode(t,e,i)).join("")}evaluateNode(t,e,i=0){const n="  ".repeat(i);switch(t.type){case"text":return t.value;case"variable":let o=this.getValue(e,t.path);for(const e of t.formatters||[])o=this.applyFormatter(o,e);return null!=o?String(o):"";case"each":const a=this.getValue(e,t.arrayPath);return Array.isArray(a)?a.map((n,o)=>{const s={...e,[t.itemVar]:n,index:o,first:0===o,last:o===a.length-1};return this.evaluate(t.children,s,i+1)}).join(""):(console.warn(`${n}‚ö†Ô∏è Not an array:`,a),"");case"if":const s=this.getValue(e,t.condition),r=this.isTruthy(s)?t.ifChildren:t.elseChildren;return this.evaluate(r,e,i+1);default:throw new Error("Unknown node type: "+t.type)}}getValue(t,e){if(!e||!t)return;const i=e.split(".");let n=t;for(const t of i){if(null==n)return;n=n[t]}return n}isTruthy(t){return null!=t&&("boolean"==typeof t?t:"number"==typeof t?0!==t:"string"==typeof t||Array.isArray(t)?t.length>0:"object"==typeof t?Object.keys(t).length>0:!!t)}applyFormatter(t,e){const i=e.match(/^(\w+)(?:\s*\(\s*['"]?(.*?)['"]?\s*\))?$/);if(!i)return t;const[,n,o]=i;if(!this.formatters[n])return console.warn("‚ö†Ô∏è Unknown formatter:",n),t;try{return void 0!==o?this.formatters[n](t,o):this.formatters[n](t)}catch(e){return console.warn("‚ùå Formatter error:",n,e),t}}formatDate(t,e){const i=new Date(t);if(isNaN(i.getTime()))return"Invalid Date";const n=i.getFullYear(),o=i.getMonth(),a=i.getDate();let s=e.replace(/mmm/g,["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o]);return s=s.replace(/yyyy/g,n).replace(/mm/g,String(o+1).padStart(2,"0")).replace(/dd/g,String(a).padStart(2,"0")),s}formatDuration(t){if(isNaN(t)||t<0)return"";const e=Math.floor(t/60),i=t%60;let n="";return e>0&&(n+=`${e}h `),i>0&&(n+=`${i}m`),n.trim()}escapeHtml(t){return null==t?"":String(t).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]))}escapeCsv(t){if(null==t)return"";let e=String(t);return e.includes(",")||e.includes('"')||e.includes("\n")?`"${e.replace(/"/g,'""')}"`:e}}window.TemplatingEngine=TemplatingEngine,window.ReportTemplates={"detailed-html":{name:"Detailed Report (HTML)",description:"A comprehensive HTML report with timings and full descriptions.",type:"html",template:'<!DOCTYPE html>\n<html lang="en-GB">\n<head>\n    <meta charset="UTF-8">\n    <title>Activity Report: {{ report.startDate | date(\'dd/mm/yyyy\') }} - {{ report.endDate | date(\'dd/mm/yyyy\') }}</title>\n    <style>\n        body { font-family: sans-serif; line-height: 1.5; color: #333; }\n        .report-container { max-width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }\n        .report-header { text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 10px; margin-bottom: 20px; }\n        .report-summary { background: #f0f2ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\n        .day-group { margin-bottom: 20px; }\n        .day-header { font-size: 1.2em; font-weight: bold; color: #667eea; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; }\n        .entry { margin-bottom: 10px; padding-left: 15px; border-left: 3px solid #ccc; }\n        .entry-time { font-weight: bold; }\n        .entry-activity { font-size: 1.1em; }\n        .entry-description { color: #555; font-style: italic; }\n        .duration { font-size: 0.9em; color: #888; }\n    </style>\n</head>\n<body>\n    <div class="report-container">\n        <div class="report-header">\n            <h1>Activity Report</h1>\n            <p>{{ report.startDate | date(\'dd mmm yyyy\') }} to {{ report.endDate | date(\'dd mmm yyyy\') }}</p>\n        </div>\n        <div class="report-summary">\n            <h3>Report Summary</h3>\n            <p><strong>Total Entries:</strong> {{ report.totalEntries }}</p>\n            <p><strong>Total Duration:</strong> {{ report.totalDuration | duration }}</p>\n            <p><strong>Active Days:</strong> {{ report.activeDays }}</p>\n        </div>\n        \n        {{#each day = days}}\n        <div class="day-group">\n            <h2 class="day-header">{{ day.date }} ({{ day.entries.length }} entries, {{ day.totalDuration | duration }})</h2>\n            {{#each entry = day.entries}}\n            <div class="entry">\n                <p><span class="entry-time">{{ entry.timestamp | time }}</span>: <span class="entry-activity">{{ entry.activity | escapeHtml }}</span></p>\n                {{#if entry.description}}\n                <div class="entry-description">{{ entry.description | markdown }}</div>\n                {{/if}}\n                <p class="duration">Duration: {{ entry.duration | duration }}</p>\n            </div>\n            {{/each}}\n        </div>\n        {{/each}}\n    </div>\n</body>\n</html>'},"summary-markdown":{name:"Summary (Markdown)",description:"A summary report in Markdown, suitable for pasting into documents.",type:"markdown",template:"# Activity Report\n\n**Period:** {{ report.startDate | date('dd mmm yyyy') }} to {{ report.endDate | date('dd mmm yyyy') }}\n\n## Summary\n- **Total Entries:** {{ report.totalEntries }}\n- **Total Duration:** {{ report.totalDuration | duration }}\n- **Active Days:** {{ report.activeDays }}\n\n---\n\n{{#each day = days}}\n## {{ day.date }} (Total: {{ day.totalDuration | duration }})\n{{#each entry = day.entries}}\n- **{{ entry.timestamp | time }} ({{ entry.duration | duration }})**: {{ entry.activity }}\n{{/each}}\n{{/each}}"},"basic-csv":{name:"Basic Export (CSV)",description:"A simple CSV file with core activity data.",type:"csv",template:"Date,Time,Activity,Description\n{{#each entry = entries}}{{ entry.timestamp | date('yyyy-mm-dd') }},{{ entry.timestamp | time }},{{ entry.activity | escapeCsv | stripLinebreaks }},{{ entry.description | escapeCsv | stripLinebreaks }}\n{{/each}}"},"timed-csv":{name:"Timed Export (CSV)",description:"A detailed CSV file including calculated durations.",type:"csv",template:'Date,StartTime,EndTime,DurationMinutes,Activity,Description\n{{#each entry = entries}}{{ entry.timestamp | date(\'yyyy-mm-dd\') }},{{ entry.timestamp | time }},{{ entry.endTime | time }},{{ entry.duration }},"{{ entry.activity | escapeCsv | stripLinebreaks }}","{{ entry.description | escapeCsv | stripLinebreaks }}"\n{{/each}}'}};class ActivityTracker{constructor(){let t=[];try{const e=JSON.parse(localStorage.getItem("activityEntries"));Array.isArray(e)&&(t=e.filter(t=>t&&"object"==typeof t&&t.timestamp).map(t=>(void 0===t.isTodo&&(t.isTodo=!1),t.tags||(t.tags=[]),t.dueDate||(t.dueDate=null),t.startedAt||(t.startedAt=null),t)))}catch(t){console.error("Error parsing activity entries from localStorage",t),localStorage.removeItem("activityEntries")}this.entries=t,this.settings={notificationInterval:60,startTime:"08:00",endTime:"18:00",workingDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},pauseDuration:60,notificationsPausedUntil:null,notificationsEnabled:!0,autoStartAlerts:!1,soundMuteMode:"none",notificationSoundType:"classic",darkModePreference:"light",paginationSize:20,...JSON.parse(localStorage.getItem("activitySettings")||"{}")},this.notificationTimer=null,this.currentReportEntries=[],this.currentWeekStart=null,this.soundManager=null,this.pauseManager=null,this.init()}init(){this.loadSettings(),this.migrateExistingEntries(),this.initMarkdownRenderer(),this.initReportTemplates(),this.loadReportTemplatesIntoEditor(),this.initTemplatePreviewGrid(),this.displayEntries(),this.displayTodos(),this.updateNotificationStatus(),this.updateDebugInfo(),this.updatePauseButtonState(),this.settings.autoStartAlerts&&this.startNotificationTimer(),this.setWeeklyReport(),this.initSoundManager(),this.initPauseManager(),this.initPomodoroManager(),this.attachEventListeners(),this.initSearch(),this.setCurrentTime(),document.getElementById("activity").focus(),"file:"===window.location.protocol&&console.warn("Running from local file - notifications may have limitations")}migrateExistingEntries(){let t=!1;this.entries.forEach(e=>{e.tags&&0!==e.tags.length||(e.tags=this.extractHashtags(e.activity+" "+(e.description||"")),t=!0)}),t&&this.saveEntries()}getReportTemplates(){const t={...window.ReportTemplates||{}},e=localStorage.getItem("customReportTemplates");if(e)try{const i=JSON.parse(e);Object.assign(t,i)}catch(t){console.error("Error parsing custom report templates from localStorage",t)}return t}loadReportTemplatesIntoEditor(){const t=document.getElementById("report-templates-editor");if(!t)return;const e=this.getReportTemplates();t.innerHTML=Object.keys(e).map(t=>`\n            <div class="template-group">\n                <label for="template-${t}">${e[t].name}</label>\n                <textarea id="template-${t}" data-key="${t}">${escapeHtml(e[t].template)}</textarea>\n            </div>\n        `).join("")}saveReportTemplates(){const t=document.getElementById("report-templates-editor");if(!t)return;const e=this.getReportTemplates();t.querySelectorAll("textarea").forEach(t=>{const i=t.dataset.key;e[i]&&(e[i].template=t.value)}),localStorage.setItem("reportTemplates",JSON.stringify(e)),showNotification("Report templates saved successfully!","success"),this.initReportTemplates(),this.currentReportData&&this.previewReport()}resetReportTemplates(){confirm("Are you sure you want to reset all report templates to their default values?")&&(localStorage.removeItem("reportTemplates"),this.loadReportTemplatesIntoEditor(),this.initReportTemplates(),this.currentReportData&&this.previewReport(),showNotification("Report templates have been reset to default.","success"))}initMarkdownRenderer(){try{this.markdownRenderer=new MarkdownRenderer}catch(t){console.warn("Markdown Renderer initialization failed:",t)}}initPauseManager(){try{this.pauseManager=new PauseManager(this)}catch(t){console.warn("Pause Manager initialization failed:",t)}}attachEventListeners(){document.getElementById("activityForm").addEventListener("submit",t=>{t.preventDefault(),this.addEntry()}),document.getElementById("editForm").addEventListener("submit",t=>{t.preventDefault(),this.updateEntry()}),this.attachSettingsListeners()}attachSettingsListeners(){["notificationInterval","startTime","endTime","pauseDuration","soundMuteMode","notificationSoundType","darkModePreference","autoStartAlerts","paginationSize","pomodoroEnabled","pomodoroWorkDuration","pomodoroBreakDuration","pomodoroLongBreakDuration","pomodoroLongBreakInterval","pomodoroTickSound","pomodoroTickInterval","pomodoroShortBreakSound","pomodoroLongBreakSound","pomodoroResumeSound","pomodoroAutoStart","pomodoroAutoLog","pomodoroLogBreaks","pomodoroLongBreak","pomodoroPauseAllowed","monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{const e=document.getElementById(t);if(e){let t;t="checkbox"===e.type||"select"===e.tagName.toLowerCase()?"change":"input",e.addEventListener(t,()=>{this.autoSaveSettings()})}})}autoSaveSettings(){this.settings.notificationInterval=parseInt(document.getElementById("notificationInterval").value),this.settings.startTime=document.getElementById("startTime").value,this.settings.endTime=document.getElementById("endTime").value,this.settings.pauseDuration=parseInt(document.getElementById("pauseDuration").value),this.settings.soundMuteMode=document.getElementById("soundMuteMode").value,this.settings.notificationSoundType=document.getElementById("notificationSoundType").value,this.settings.darkModePreference=document.getElementById("darkModePreference").value,this.settings.autoStartAlerts=document.getElementById("autoStartAlerts")?.checked||!1,this.settings.paginationSize=parseInt(document.getElementById("paginationSize").value),this.settings.pomodoroAutoStart=document.getElementById("pomodoroAutoStart")?.checked||!1,this.settings.pomodoroAutoLog=!1!==document.getElementById("pomodoroAutoLog")?.checked,this.settings.pomodoroLogBreaks=document.getElementById("pomodoroLogBreaks")?.checked||!1,["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{this.settings.workingDays[t]=document.getElementById(t).checked}),this.applyTheme(),document.getElementById("paginationSize")&&this.updatePaginationSettings(),this.saveSettings(),this.settings.notificationsEnabled&&this.startNotificationTimer(),this.updateDebugInfo(),this.pomodoroManager&&(this.pomodoroManager.saveSettings(),this.pomodoroManager.loadSettings()),showNotification("Settings saved automatically","success",1500)}initSoundManager(){try{this.soundManager=new SoundManager}catch(t){console.warn("Sound Manager failed to initialise:",t)}}isNotificationSoundMuted(){return"all"===this.settings.soundMuteMode||"notifications"===this.settings.soundMuteMode}isPomodoroSoundMuted(){return"all"===this.settings.soundMuteMode||"pomodoro"===this.settings.soundMuteMode}playNotificationSound(){this.soundManager&&this.soundManager.playSound(this.settings.notificationSoundType,this.isNotificationSoundMuted())}testNotificationSound(){this.soundManager&&this.soundManager.playSound(this.settings.notificationSoundType,this.isNotificationSoundMuted()),showNotification("Test sound played!","success")}addEntry(t){let e=t;if(!e){const t=document.getElementById("activity").value,i=document.getElementById("description").value,n=document.getElementById("timestamp").value,o=isTodoModeActive(),a=document.getElementById("dueDate")?.value||null;e={id:generateId(),activity:t,description:i,timestamp:new Date(n).toISOString(),created:(new Date).toISOString(),isTodo:o,tags:this.extractHashtags(t+" "+(i||"")),dueDate:a?new Date(a).toISOString():null,startedAt:o?new Date(n).toISOString():null}}if(this.entries.unshift(e),this.saveEntries(),this.displayEntries(),this.displayTodos(),!t){document.getElementById("activityForm").reset();const t=document.getElementById("todoToggleBtn");t&&(t.classList.remove("active"),t.textContent="Add as Todo"),this.setCurrentTime(),document.getElementById("activity").focus()}showNotification("Entry added successfully!","success")}updateEntry(){const t=document.getElementById("editId").value,e=document.getElementById("editActivity").value,i=document.getElementById("editDescription").value,n=document.getElementById("editTimestamp").value,o=document.getElementById("editTodoCheckbox").checked,a=document.getElementById("editDueDate").value,s=this.entries.findIndex(e=>e.id===t);if(-1!==s){const t=this.entries[s];this.entries[s]={...t,activity:e,description:i,timestamp:new Date(n).toISOString(),isTodo:o,tags:this.extractHashtags(e+" "+(i||"")),dueDate:a?new Date(a).toISOString():null,startedAt:o?t.startedAt||new Date(n).toISOString():t.startedAt},this.saveEntries(),this.displayEntries(),this.displayTodos(),this.closeEditModal(),showNotification("Entry updated successfully!","success")}}deleteEntry(t){confirm("Are you sure you want to delete this entry?")&&(this.entries=this.entries.filter(e=>e.id!==t),this.saveEntries(),this.displayEntries(),this.displayTodos(),showNotification("Entry deleted successfully!","success"))}editEntry(t){const e=this.entries.find(e=>e.id===t);e&&(document.getElementById("editId").value=e.id,document.getElementById("editActivity").value=e.activity,document.getElementById("editDescription").value=e.description||"",document.getElementById("editTimestamp").value=new Date(e.timestamp).toISOString().slice(0,16),document.getElementById("editTodoCheckbox").checked=e.isTodo||!1,document.getElementById("editDueDate").value=e.dueDate?new Date(e.dueDate).toISOString().slice(0,16):"",document.getElementById("editModal").style.display="block")}closeEditModal(){document.getElementById("editModal").style.display="none"}displayEntries(){const t=document.getElementById("entriesList");this.entriesPagination||(this.entriesPagination={currentPage:1,itemsPerPage:this.settings.paginationSize||20}),this.entriesPagination.itemsPerPage=this.settings.paginationSize||20;const e=(this.entriesPagination.currentPage-1)*this.entriesPagination.itemsPerPage,i=e+this.entriesPagination.itemsPerPage,n=this.entries.slice(e,i);0!==n.length?(t.innerHTML=n.map(t=>{const e=new Date,i=t.isTodo&&t.dueDate&&new Date(t.dueDate)<e;let n="entry-item";t.isTodo&&(n+=i?" entry-todo entry-overdue":" entry-todo");const o=t.tags&&t.tags.length>0?`<div class="entry-tags">${t.tags.map(t=>`<span class="entry-tag" onclick="tracker.searchByHashtag('${t}')">#${t}</span>`).join("")}</div>`:"",a=t.dueDate?`<div class="entry-due-date">Due: ${formatDateTime(t.dueDate)}</div>`:"",s=t.isTodo?'<span class="entry-todo-indicator">üìã Todo</span>':"";return`\n                <div class="${n}">\n                    <div class="entry-content">\n                        <div class="entry-time">${formatDateTime(t.timestamp)} ${s}</div>\n                        <div class="entry-activity">${escapeHtml(t.activity)}</div>\n                        ${t.description?`<div class="entry-description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                        ${o}\n                        ${a}\n                    </div>\n                    <div class="entry-actions">\n                        ${t.isTodo?`<button class="btn btn-success btn-small" onclick="tracker.completeEntry('${t.id}')" title="Mark as completed">Mark Complete</button>`:""}\n                        <button class="btn btn-secondary btn-small" onclick="tracker.editEntry('${t.id}')">Edit</button>\n                        <button class="btn btn-danger btn-small" onclick="tracker.deleteEntry('${t.id}')">Delete</button>\n                    </div>\n                </div>\n            `}).join(""),this.updateEntriesPagination(this.entries.length)):t.innerHTML="<p>No entries yet. Add your first activity above!</p>"}renderDescriptionMarkdown(t){return this.markdownRenderer||void 0===MarkdownRenderer||this.initMarkdownRenderer(),this.markdownRenderer&&t?this.markdownRenderer.renderInlineWithClasses(t):escapeHtml(t)}saveEntries(){localStorage.setItem("activityEntries",JSON.stringify(this.entries))}saveSettings(){this.settings={...this.settings,notificationInterval:parseInt(document.getElementById("notificationInterval").value),startTime:document.getElementById("startTime").value,endTime:document.getElementById("endTime").value,pauseDuration:parseInt(document.getElementById("pauseDuration").value),soundMuteMode:document.getElementById("soundMuteMode").value,notificationSoundType:document.getElementById("notificationSoundType").value,darkModePreference:document.getElementById("darkModePreference").value,autoStartAlerts:document.getElementById("autoStartAlerts")?.checked||!1,paginationSize:parseInt(document.getElementById("paginationSize").value),workingDays:{monday:document.getElementById("monday").checked,tuesday:document.getElementById("tuesday").checked,wednesday:document.getElementById("wednesday").checked,thursday:document.getElementById("thursday").checked,friday:document.getElementById("friday").checked,saturday:document.getElementById("saturday").checked,sunday:document.getElementById("sunday").checked},pomodoroEnabled:document.getElementById("pomodoroEnabled")?.checked||!1,pomodoroWorkDuration:parseInt(document.getElementById("pomodoroWorkDuration")?.value)||25,pomodoroBreakDuration:parseInt(document.getElementById("pomodoroBreakDuration")?.value)||5,pomodoroAutoStart:document.getElementById("pomodoroAutoStart")?.checked||!1,pomodoroAutoLog:!1!==document.getElementById("pomodoroAutoLog")?.checked,pomodoroLogBreaks:document.getElementById("pomodoroLogBreaks")?.checked||!1,pomodoroLongBreak:document.getElementById("pomodoroLongBreak")?.checked||!1,pomodoroPauseAllowed:!1!==document.getElementById("pomodoroPauseAllowed")?.checked},localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.applyTheme(),this.startNotificationTimer(),this.pomodoroManager&&(this.pomodoroManager.saveSettings(),this.pomodoroManager.loadSettings()),this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&this.saveTemplatesQuietly(),this.updatePaginationSettings(),showNotification("Settings saved successfully!","success")}updatePaginationSettings(){const t=this.settings.paginationSize||20;this.entriesPagination&&(this.entriesPagination.itemsPerPage=t,this.entriesPagination.currentPage=1),this.todoPagination&&(this.todoPagination.itemsPerPage=t,this.todoPagination.currentPage=1),this.searchState&&this.searchState.searchPagination&&(this.searchState.searchPagination.itemsPerPage=t,this.searchState.searchPagination.currentPage=1),this.displayEntries(),this.displayTodos(),this.searchState&&this.searchState.currentQuery&&this.performSearch(this.searchState.currentQuery)}loadSettings(){document.getElementById("notificationInterval").value=this.settings.notificationInterval,document.getElementById("startTime").value=this.settings.startTime,document.getElementById("endTime").value=this.settings.endTime,document.getElementById("pauseDuration").value=this.settings.pauseDuration,document.getElementById("soundMuteMode").value=this.settings.soundMuteMode,document.getElementById("darkModePreference").value=this.settings.darkModePreference,document.getElementById("autoStartAlerts").checked=this.settings.autoStartAlerts,document.getElementById("paginationSize").value=this.settings.paginationSize,this.populateSoundDropdowns(),Object.entries(this.settings.workingDays).forEach(([t,e])=>{document.getElementById(t).checked=e}),this.applyTheme()}populateSoundDropdowns(){[{id:"notificationSoundType",selectedValue:this.settings.notificationSoundType},{id:"pomodoroShortBreakSound",selectedValue:this.settings.pomodoroShortBreakSound||"gentle"},{id:"pomodoroLongBreakSound",selectedValue:this.settings.pomodoroLongBreakSound||"bell"},{id:"pomodoroResumeSound",selectedValue:this.settings.pomodoroResumeSound||"digital"}].forEach(({id:t,selectedValue:e})=>{const i=document.getElementById(t);i&&"function"==typeof generateSoundOptions&&(i.innerHTML=generateSoundOptions([],e))})}applyTheme(){let t=!1;switch(this.settings.darkModePreference){case"dark":t=!0;break;case"light":default:t=!1;break;case"system":t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}t?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode"),"system"===this.settings.darkModePreference&&(this.systemThemeListener||(this.systemThemeListener=t=>{"system"===this.settings.darkModePreference&&this.applyTheme()},window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",this.systemThemeListener)))}async enableNotifications(){if(!("Notification"in window)||!("serviceWorker"in navigator))return alert("This browser does not support notifications or service workers."),void this.updateDebugInfo();if(this.settings.notificationsEnabled&&"granted"===Notification.permission)return this.settings.notificationsEnabled=!1,this.saveSettings(),this.stopNotificationTimer(),showNotification("Notifications disabled","success"),this.updateNotificationStatus(),void this.updateDebugInfo();try{const t=await Notification.requestPermission();"granted"===t?(this.settings.notificationsEnabled=!0,this.saveSettings(),showNotification("Notifications enabled successfully!","success"),this.startNotificationTimer(),setTimeout(()=>{this.testNotification(!0)},1e3)):showNotification("denied"===t?"Notifications were denied. Please check your browser settings and try again.":"Notification permission was not granted. Please try again.","error"),setTimeout(()=>{this.updateNotificationStatus(),this.updateDebugInfo()},500)}catch(t){console.error("Error requesting notification permission:",t),showNotification("Error requesting notification permission: "+t.message,"error"),this.updateDebugInfo()}}async showNotificationWithServiceWorker(t,e){if("Notification"in window)if("granted"===Notification.permission){try{if("serviceWorker"in navigator&&navigator.serviceWorker.controller){const i=await navigator.serviceWorker.ready;return void await i.showNotification(t,e)}}catch(t){console.warn("Service Worker notification failed, falling back to direct notification:",t)}try{const i={body:e.body,icon:e.icon,tag:e.tag,requireInteraction:e.requireInteraction},n=new Notification(t,i);n.onclick=()=>{window.focus(),n.close()},e.requireInteraction||setTimeout(()=>{n.close()},5e3)}catch(t){console.error("Both Service Worker and direct notification failed:",t),showNotification("Activity reminder: "+(e.body||"Time to log your activity!"),"info",8e3)}}else console.warn("Notification permission not granted");else console.warn("Notifications not supported")}testNotification(t=!1){if(this.updateDebugInfo(),this.playNotificationSound(),"granted"===Notification.permission)try{const e={body:"This is a test notification. Try entering an activity in the text field below!",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"test-notification",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Log Activity",placeholder:"e.g. coding"}]};this.showNotificationWithServiceWorker("Activity Tracker Test",e),t||showNotification("Test notification sent successfully!","success")}catch(t){console.error("Error creating test notification:",t),showNotification("Error creating test notification: "+t.message,"error"),this.updateDebugInfo()}else t||showNotification("Please enable notifications first! Current permission: "+Notification.permission,"error")}refreshNotificationStatus(){this.updateNotificationStatus(),this.updateDebugInfo(),showNotification("Notification status refreshed","success")}updateNotificationStatus(){const t=document.getElementById("notificationStatus"),e=document.getElementById("statusIndicator"),i=document.getElementById("statusText"),n=document.querySelector('button[onclick="enableNotifications()"]');if("Notification"in window)switch(Notification.permission){case"granted":this.settings.notificationsEnabled?(t.className="notification-status notification-enabled",e.className="status-indicator status-active",i.textContent="Notifications are enabled and working",n&&(n.textContent="Disable Notifications")):(t.className="notification-status notification-warning",e.className="status-indicator status-inactive",i.textContent="Notifications are disabled by user",n&&(n.textContent="Enable Notifications"));break;case"denied":t.className="notification-status notification-disabled",e.className="status-indicator status-inactive",i.textContent="Notifications are blocked - please enable them in browser settings",n&&(n.textContent="Enable Notifications");break;default:t.className="notification-status notification-warning",e.className="status-indicator status-inactive",i.textContent='Notifications are disabled - click "Enable Notifications" to activate',n&&(n.textContent="Enable Notifications")}else t.className="notification-status notification-disabled",e.className="status-indicator status-inactive",i.textContent="Notifications not supported in this browser",n&&(n.textContent="Not Supported");"file:"===window.location.protocol&&(t.className="notification-status notification-warning",i.textContent+=" (Note: Running from local file may limit notification functionality)")}showNotificationBanner(){const t=document.getElementById("notificationStatusBanner");t&&this.settings.notificationsEnabled&&(t.style.display="block")}hideNotificationBanner(){const t=document.getElementById("notificationStatusBanner");t&&(t.style.display="none")}startNotificationCountdown(){this.notificationCountdownTimer&&clearInterval(this.notificationCountdownTimer),this.updateNotificationCountdown(),this.notificationCountdownTimer=setInterval(()=>{this.updateNotificationCountdown()},1e3)}updateNotificationCountdown(){const t=document.getElementById("notificationTimeRemaining");if(!t||!this.settings.notificationsEnabled)return;const e=new Date,i=60*e.getHours()+e.getMinutes(),n=this.settings.notificationInterval;let o,a=Math.ceil(i/n)*n;a>=1440&&(a=0),o=0===a?1440-i:a-i;const s=Math.floor(o/60),r=o%60,c=60-e.getSeconds();let l;l=s>0?`${s}h ${r}m ${c}s`:r>0?`${r}m ${c}s`:`${c}s`,t.textContent=l}updateDebugInfo(){const t=document.getElementById("debugText");if(!t)return;const e=[];e.push(`Version: ${APP_VERSION}`),e.push(""),e.push(`Browser: ${navigator.userAgent.split(" ").slice(-2).join(" ")}`),e.push(`Platform: ${navigator.platform||"Unknown"}`),e.push(`Protocol: ${window.location.protocol}`),e.push("Notification API: "+("Notification"in window?"Available":"Not Available")),"Notification"in window&&(e.push(`Permission: ${Notification.permission}`),e.push(`Max Actions: ${Notification.maxActions||"Unknown"}`)),"serviceWorker"in navigator?(e.push("Service Worker: Available"),navigator.serviceWorker.controller?(e.push(`SW State: ${navigator.serviceWorker.controller.state}`),e.push(`SW URL: ${navigator.serviceWorker.controller.scriptURL.split("/").pop()}`)):e.push("SW State: No controller"),navigator.serviceWorker.getRegistration().then(t=>{if(t){const e=document.getElementById("debugText");e&&e.innerHTML.includes("SW Scope: Checking...")&&(e.innerHTML=e.innerHTML.replace("SW Scope: Checking...",`SW Scope: ${t.scope}`))}}).catch(t=>{console.warn("SW registration check failed:",t)}),e.push("SW Scope: Checking...")):(e.push("Service Worker: Not Available"),"file:"===window.location.protocol&&e.push("SW Reason: file:// protocol (expected)")),e.push("Audio Support: "+(this.soundManager&&this.soundManager.audioContext?"Yes":"No")),e.push(`Sound Settings: ${"none"===this.settings.soundMuteMode?"All enabled":this.settings.soundMuteMode}`),e.push(`Sound Type: ${this.settings.notificationSoundType}`),e.push(`Last Updated: ${(new Date).toLocaleTimeString("en-GB")}`),t.innerHTML=e.join("<br>")}async updateAboutDebugInfo(){const t=document.getElementById("aboutDebugInfo");if(!t)return;const e=[];if(e.push(`<strong>Version:</strong> ${APP_VERSION}`),e.push(""),e.push(`<strong>Browser:</strong> ${navigator.userAgent.split(" ").slice(-2).join(" ")}`),e.push(`<strong>Platform:</strong> ${navigator.platform||"Unknown"}`),e.push(`<strong>Protocol:</strong> ${window.location.protocol}`),e.push(""),e.push("<strong>Notification API:</strong> "+("Notification"in window?"Available":"Not Available")),"Notification"in window&&(e.push(`<strong>Permission:</strong> ${Notification.permission}`),e.push(`<strong>Max Actions:</strong> ${Notification.maxActions||"Unknown"}`)),e.push(""),"serviceWorker"in navigator){e.push("<strong>Service Worker:</strong> Available"),navigator.serviceWorker.controller?(e.push(`<strong>SW State:</strong> ${navigator.serviceWorker.controller.state}`),e.push(`<strong>SW URL:</strong> ${navigator.serviceWorker.controller.scriptURL.split("/").pop()}`)):e.push("<strong>SW State:</strong> No controller");try{const t=await navigator.serviceWorker.getRegistration();t?e.push(`<strong>SW Scope:</strong> ${t.scope}`):e.push("<strong>SW Scope:</strong> No registration")}catch(t){console.warn("SW registration check failed:",t),e.push("<strong>SW Scope:</strong> Check failed")}}else e.push("<strong>Service Worker:</strong> Not Available"),"file:"===window.location.protocol&&e.push("<strong>SW Reason:</strong> file:// protocol (expected)");e.push(""),e.push("<strong>Audio Support:</strong> "+(this.soundManager&&this.soundManager.audioContext?"Yes":"No")),e.push(`<strong>Sound Settings:</strong> ${"none"===this.settings.soundMuteMode?"All enabled":this.settings.soundMuteMode}`),e.push(`<strong>Sound Type:</strong> ${this.settings.notificationSoundType}`),e.push(`<strong>Last Updated:</strong> ${(new Date).toLocaleTimeString("en-GB")}`),t.innerHTML=e.join("<br>")}async runServiceWorkerDiagnostics(){const t={available:"serviceWorker"in navigator,protocol:window.location.protocol,userAgent:navigator.userAgent,platform:navigator.platform,registration:null,controller:null,error:null};if(!t.available)return t.error="Service Worker API not available",t;try{if(t.registration=await navigator.serviceWorker.getRegistration(),t.controller=navigator.serviceWorker.controller,t.controller)try{const e=new MessageChannel,i=await new Promise((i,n)=>{const o=setTimeout(()=>n(new Error("SW communication timeout")),5e3);e.port1.onmessage=t=>{clearTimeout(o),i(t.data)},t.controller.postMessage({type:"GET_VERSION"},[e.port2])});t.communication="Working",t.swVersion=i.version}catch(e){t.communication=`Failed: ${e.message}`}}catch(e){t.error=e.message}return t}startNotificationTimer(){this.notificationTimer&&clearInterval(this.notificationTimer),this.notificationCountdownTimer&&clearInterval(this.notificationCountdownTimer),this.notificationTimer=setInterval(()=>{this.checkForNotification()},6e4),this.startNotificationCountdown(),this.showNotificationBanner()}stopNotificationTimer(){this.notificationTimer&&(clearInterval(this.notificationTimer),this.notificationTimer=null),this.notificationCountdownTimer&&(clearInterval(this.notificationCountdownTimer),this.notificationCountdownTimer=null),this.hideNotificationBanner()}checkForNotification(){if(!this.settings.notificationsEnabled)return;if(this.settings.notificationsPausedUntil){if((new Date).getTime()<this.settings.notificationsPausedUntil)return;this.unpauseNotifications(!1)}if("granted"!==Notification.permission)return;const t=new Date,e=60*t.getHours()+t.getMinutes(),i=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()];if(!this.settings.workingDays[i])return;const[n,o]=this.settings.startTime.split(":").map(Number),[a,s]=this.settings.endTime.split(":").map(Number);if(e<60*n+o||e>60*a+s)return;const r=localStorage.getItem("lastNotificationTime"),c=t.getTime()-(r||0),l=60*this.settings.notificationInterval*1e3;l>0&&c>=l&&(this.showActivityReminder(),localStorage.setItem("lastNotificationTime",t.getTime().toString()))}showActivityReminder(){this.playNotificationSound(),this.setCurrentTime();try{const t={body:"What are you working on right now?",icon:'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23667eea"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',tag:"activity-reminder",requireInteraction:!0,actions:[{action:"reply",type:"text",title:"Log Activity",placeholder:"e.g. coding"}]};this.showNotificationWithServiceWorker("Activity Tracker Reminder",t)}catch(t){console.error("Error showing activity reminder:",t)}}setCurrentTime(){const t=document.getElementById("timestamp");t&&(t.value=getCurrentTimeForInput())}initPomodoroManager(){void 0!==PomodoroManager?this.pomodoroManager=new PomodoroManager(this):console.warn("PomodoroManager class not found")}togglePause(t=!0){this.settings.notificationsEnabled?(this.settings.notificationsEnabled=!1,this.stopNotificationTimer(),t&&showNotification("Notifications stopped","info")):(this.settings.notificationsEnabled=!0,this.startNotificationTimer(),t&&showNotification("Notifications started","success")),this.updatePauseButtonState(),this.saveSettings(),this.updateNotificationStatus(),this.updateDebugInfo()}unpauseNotifications(t=!0){this.settings.notificationsPausedUntil=null,t&&showNotification("Notifications resumed","success"),this.updatePauseButtonState(),this.saveSettings()}updatePauseButtonState(){this.pauseManager&&this.pauseManager.updatePauseButtonDisplay()}clearAllData(){confirm("Are you sure you want to clear all data? This cannot be undone.")&&(localStorage.removeItem("activityEntries"),localStorage.removeItem("activitySettings"),localStorage.removeItem("lastNotificationTime"),this.entries=[],this.currentReportEntries=[],this.displayEntries(),document.getElementById("reportPreview").innerHTML="",showNotification("All data cleared successfully!","success"))}exportDatabase(){try{const t={version:"1.0",timestamp:(new Date).toISOString(),entries:this.entries,settings:this.settings},e=JSON.stringify(t,null,2),i=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=`activity-tracker-backup-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),showNotification("Database exported successfully!","success")}catch(t){console.error("Error exporting database:",t),showNotification("Error exporting database: "+t.message,"error")}}importDatabase(t){try{const e=JSON.parse(t);if(!e.entries||!Array.isArray(e.entries))throw new Error("Invalid backup file: missing or invalid entries data");const i=e.entries.length,n=e.timestamp?new Date(e.timestamp).toLocaleDateString("en-GB"):"unknown date";if(!confirm(`Import ${i} entries from backup created on ${n}? This will replace all current data.`))return;const o=e.entries.filter(t=>t&&"object"==typeof t&&t.timestamp);o.length!==e.entries.length&&console.warn(`Filtered out ${e.entries.length-o.length} invalid entries`),this.entries=o,localStorage.setItem("activityEntries",JSON.stringify(this.entries)),e.settings&&"object"==typeof e.settings&&(this.settings={...this.settings,...e.settings},localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.loadSettings()),this.displayEntries(),this.currentReportEntries=[],document.getElementById("reportPreview").innerHTML="",showNotification(`Database imported successfully! Restored ${o.length} entries.`,"success")}catch(t){console.error("Error importing database:",t),showNotification("Error importing database: "+t.message,"error")}}initTemplatePreviewGrid(){}openTemplateManager(){this.templateManagerState={templates:{...this.getReportTemplates()},currentTemplateId:null,hasUnsavedChanges:!1,originalTemplates:{...this.getReportTemplates()}};const t=document.getElementById("templateManagerOverlay");t&&(t.classList.add("active"),this.populateTemplateList(),this.clearTemplateEditor())}closeTemplateManager(){if(this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&!confirm("You have unsaved changes. Are you sure you want to close without saving?"))return;const t=document.getElementById("templateManagerOverlay");t&&t.classList.remove("active"),this.templateManagerState=null}populateTemplateList(){const t=document.getElementById("templateList");if(!t||!this.templateManagerState)return;const e=this.templateManagerState.templates,i=this.settings.defaultTemplate||"detailed-html";t.innerHTML="",Object.keys(e).forEach(n=>{const o=e[n],a=n===i,s=n===this.templateManagerState.currentTemplateId,r=document.createElement("div");r.className=`template-list-item ${s?"active":""} ${a?"default":""}`,r.onclick=()=>this.selectTemplate(n),r.innerHTML=`\n                <div class="template-list-item-name">${o.name}</div>\n                <div class="template-list-item-desc">${o.description}</div>\n                <div class="template-list-item-type">${o.type}</div>\n            `,t.appendChild(r)})}selectTemplate(t){this.templateManagerState&&this.templateManagerState.hasUnsavedChanges&&!confirm("You have unsaved changes. Continue without saving?")||(this.templateManagerState.currentTemplateId=t,this.templateManagerState.hasUnsavedChanges=!1,this.populateTemplateList(),this.loadTemplateIntoEditor(t),this.refreshTemplatePreview())}loadTemplateIntoEditor(t){const e=this.templateManagerState.templates[t];if(!e)return;document.getElementById("templateEditorTitle").textContent=`Editing: ${e.name}`,document.getElementById("templateEditorActions").style.display="flex",document.getElementById("templateEditorTabs").style.display="flex",this.switchTemplateTab("editor"),document.getElementById("templateName").value=e.name,document.getElementById("templateDescription").value=e.description,document.getElementById("templateType").value=e.type,document.getElementById("templateContent").value=e.template;const i=this.settings.defaultTemplate||"detailed-html";document.getElementById("templateIsDefault").checked=t===i,["templateName","templateDescription","templateType","templateContent","templateIsDefault"].forEach(t=>{const e=document.getElementById(t);e&&e.addEventListener("input",()=>{this.templateManagerState.hasUnsavedChanges=!0})})}clearTemplateEditor(){document.getElementById("templateEditorTitle").textContent="Select a template to edit",document.getElementById("templateEditorActions").style.display="none",document.getElementById("templateEditorTabs").style.display="none",document.getElementById("templateEditorForm").style.display="none",document.getElementById("templatePreviewPanel").style.display="none",document.getElementById("templatePreviewContent").innerHTML='<p class="template-preview-placeholder">Select a template to see preview</p>'}addNewTemplate(){const t="custom-"+Date.now();this.templateManagerState.templates[t]={name:"New Template",description:"Custom template",type:"html",template:"# {{report.startDate}} - {{report.endDate}}\n\n{{#each entry = entries}}\n- {{entry.activity}}\n{{/each}}"},this.templateManagerState.hasUnsavedChanges=!0,this.populateTemplateList(),this.selectTemplate(t)}saveCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=document.getElementById("templateName").value.trim(),i=document.getElementById("templateDescription").value.trim(),n=document.getElementById("templateType").value,o=document.getElementById("templateContent").value,a=document.getElementById("templateIsDefault").checked;e&&o?(this.templateManagerState.templates[t]={name:e,description:i,type:n,template:o},a?this.settings.defaultTemplate=t:this.settings.defaultTemplate===t&&(this.settings.defaultTemplate="detailed-html"),this.templateManagerState.hasUnsavedChanges=!1,this.populateTemplateList(),this.refreshTemplatePreview(),showNotification("Template saved","success")):showNotification("Template name and content are required","error")}deleteCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t];confirm(`Delete template "${e.name}"? This cannot be undone.`)&&(window.ReportTemplates&&window.ReportTemplates[t]?showNotification("Cannot delete default templates","error"):(delete this.templateManagerState.templates[t],this.settings.defaultTemplate===t&&(this.settings.defaultTemplate="detailed-html"),this.templateManagerState.hasUnsavedChanges=!0,this.templateManagerState.currentTemplateId=null,this.populateTemplateList(),this.clearTemplateEditor(),showNotification("Template deleted","success")))}duplicateCurrentTemplate(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t],i="custom-"+Date.now(),n={name:e.name+" (Copy)",description:e.description,type:e.type,template:e.template};this.templateManagerState.templates[i]=n,this.templateManagerState.hasUnsavedChanges=!0,this.populateTemplateList(),this.selectTemplate(i),showNotification("Template duplicated","success")}resetToDefaults(){confirm("Reset all templates to defaults? This will delete all custom templates.")&&(this.templateManagerState.templates={...window.ReportTemplates},this.settings.defaultTemplate="detailed-html",this.templateManagerState.hasUnsavedChanges=!0,this.templateManagerState.currentTemplateId=null,this.populateTemplateList(),this.clearTemplateEditor(),showNotification("Templates reset to defaults","success"))}generateTestData(){const t=new Date,e=new Date(t.getTime()-6048e5),i=t,n=new Date(e),o=new Date(e.getTime()+864e5),a=new Date(e.getTime()+1728e5),s=[{id:"1",timestamp:n.toISOString(),activity:"Planning project roadmap",description:"Defined key milestones and deliverables for Q3",duration:45,endTime:new Date(n.getTime()+27e5).toISOString()},{id:"2",timestamp:new Date(n.getTime()+72e5).toISOString(),activity:"Team standup meeting",description:"Discussed progress and blocked items",duration:30,endTime:new Date(n.getTime()+72e5+18e5).toISOString()}],r=[{id:"3",timestamp:o.toISOString(),activity:"Code review",description:"Reviewed pull requests for **authentication module**",duration:60,endTime:new Date(o.getTime()+36e5).toISOString()}],c=[{id:"4",timestamp:a.toISOString(),activity:"Documentation update",description:"Updated API documentation with new endpoints",duration:90,endTime:new Date(a.getTime()+54e5).toISOString()}],l=[...s,...r,...c],d=l.reduce((t,e)=>t+e.duration,0);return{report:{startDate:e.toISOString(),endDate:i.toISOString(),totalEntries:l.length,totalDuration:d,activeDays:3},entries:l,days:[{date:n.toDateString(),entries:s,totalDuration:s.reduce((t,e)=>t+e.duration,0)},{date:o.toDateString(),entries:r,totalDuration:r.reduce((t,e)=>t+e.duration,0)},{date:a.toDateString(),entries:c,totalDuration:c.reduce((t,e)=>t+e.duration,0)}]}}refreshTemplatePreview(){if(!this.templateManagerState||!this.templateManagerState.currentTemplateId)return;const t=this.templateManagerState.currentTemplateId,e=this.templateManagerState.templates[t],i=document.getElementById("templatePreviewContent");if(!e||!i)return;const n=document.getElementById("templateContent"),o={...e,template:n?n.value:e.template},a=document.getElementById("previewTabRendered"),s=a&&a.classList.contains("active");try{const t=this.generateTestData();this.templatingEngine||(this.templatingEngine=new TemplatingEngine);const e=this.templatingEngine.render(o.template,t);if(s){if("html"===o.type){const t=document.createElement("iframe");return t.style.width="100%",t.style.height="400px",t.style.border="none",t.style.borderRadius="4px",i.innerHTML="",i.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),void t.contentDocument.close()}if("markdown"===o.type&&this.markdownRenderer){const t=this.markdownRenderer.render(e);return void(i.innerHTML=`<div class="markdown-preview">${t}</div>`)}i.innerHTML=`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${this.escapeHtml(e)}</pre>`}else i.innerHTML=`<pre style="white-space: pre-wrap; font-family: monospace; font-size: 12px;">${this.escapeHtml(e)}</pre>`}catch(t){i.innerHTML=`<div style="color: #e53e3e; padding: 20px; text-align: center;">\n                <strong>Error generating preview:</strong><br>\n                <code style="background: #fed7d7; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 8px;">${t.message}</code>\n            </div>`}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}switchPreviewTab(t){document.getElementById("previewTabRendered").classList.toggle("active","rendered"===t),document.getElementById("previewTabSource").classList.toggle("active","source"===t),this.refreshTemplatePreview()}switchReportPreviewTab(t){document.getElementById("reportPreviewTabRendered").classList.toggle("active","rendered"===t),document.getElementById("reportPreviewTabSource").classList.toggle("active","source"===t),this.previewReport()}switchTemplateTab(t){document.getElementById("tabEditor").classList.toggle("active","editor"===t),document.getElementById("tabPreview").classList.toggle("active","preview"===t),document.getElementById("templateEditorForm").style.display="editor"===t?"flex":"none",document.getElementById("templatePreviewPanel").style.display="preview"===t?"flex":"none","preview"===t&&this.refreshTemplatePreview()}saveAllTemplates(){if(!this.templateManagerState)return;this.templateManagerState.currentTemplateId&&this.saveCurrentTemplate();const t={};if(Object.keys(this.templateManagerState.templates).forEach(e=>{window.ReportTemplates&&window.ReportTemplates[e]||(t[e]=this.templateManagerState.templates[e])}),localStorage.setItem("customReportTemplates",JSON.stringify(t)),localStorage.setItem("activitySettings",JSON.stringify(this.settings)),this.initTemplatePreviewGrid(),this.initReportTemplates){const t=document.getElementById("reportTemplate")?.value;this.initReportTemplates();const e=document.getElementById("reportTemplate");e&&t&&(e.value=t)}this.closeTemplateManager(),showNotification("All templates saved successfully!","success")}saveTemplatesQuietly(){if(!this.templateManagerState)return;this.templateManagerState.currentTemplateId&&this.saveCurrentTemplate();const t={};if(Object.keys(this.templateManagerState.templates).forEach(e=>{window.ReportTemplates&&window.ReportTemplates[e]||(t[e]=this.templateManagerState.templates[e])}),localStorage.setItem("customReportTemplates",JSON.stringify(t)),this.templateManagerState.hasUnsavedChanges=!1,this.initReportTemplates){const t=document.getElementById("reportTemplate")?.value;this.initReportTemplates();const e=document.getElementById("reportTemplate");e&&t&&(e.value=t)}}extractHashtags(t){if(!t||"string"!=typeof t)return[];const e=/#(\w+)/g,i=[];let n;for(;null!==(n=e.exec(t));){const t=n[1].toLowerCase();i.includes(t)||i.push(t)}return i}completeEntry(t){const e=this.entries.find(e=>e.id===t);e&&e.isTodo&&(e.startedAt=e.timestamp,e.timestamp=(new Date).toISOString(),e.isTodo=!1,this.saveEntries(),this.displayEntries(),this.displayTodos(),showNotification("Todo completed!","success"))}toggleTodoStatus(t){const e=this.entries.find(e=>e.id===t);e&&(e.isTodo?this.completeEntry(t):(e.isTodo=!0,e.startedAt=e.timestamp,this.saveEntries(),this.displayEntries(),this.displayTodos(),showNotification("Entry marked as todo!","success")))}displayTodos(){const t=document.getElementById("todoList"),e=document.getElementById("todoStats");if(!t||!e)return;this.todoPagination||(this.todoPagination={currentPage:1,itemsPerPage:this.settings.paginationSize||20,filter:"all",sort:"created-desc"});const i=this.getFilteredTodos(),n=i.length;if(e.innerHTML=`<span id="todoCount">${n} todo${1!==n?"s":""}</span>`,0===n)return t.innerHTML='<p class="empty-state">No todos found. Add activities as todos to see them here!</p>',void(document.getElementById("todoPagination").style.display="none");const o=(this.todoPagination.currentPage-1)*this.todoPagination.itemsPerPage,a=o+this.todoPagination.itemsPerPage,s=i.slice(o,a);t.innerHTML=s.map(t=>this.renderTodoItem(t)).join(""),this.updateTodoPagination(n)}getFilteredTodos(){let t=this.entries.filter(t=>t.isTodo);switch(this.todoPagination.filter){case"due-today":t=t.filter(t=>{if(!t.dueDate)return!1;const e=(new Date).toDateString();return new Date(t.dueDate).toDateString()===e});break;case"overdue":t=t.filter(t=>!!t.dueDate&&new Date(t.dueDate)<new Date);break;case"no-due-date":t=t.filter(t=>!t.dueDate)}switch(this.todoPagination.sort){case"created-asc":t.sort((t,e)=>new Date(t.created)-new Date(e.created));break;case"created-desc":t.sort((t,e)=>new Date(e.created)-new Date(t.created));break;case"due-asc":t.sort((t,e)=>t.dueDate||e.dueDate?t.dueDate?e.dueDate?new Date(t.dueDate)-new Date(e.dueDate):-1:1:0);break;case"due-desc":t.sort((t,e)=>t.dueDate||e.dueDate?t.dueDate?e.dueDate?new Date(e.dueDate)-new Date(t.dueDate):-1:1:0);break;case"activity-asc":t.sort((t,e)=>t.activity.localeCompare(e.activity));break;case"activity-desc":t.sort((t,e)=>e.activity.localeCompare(t.activity))}return t}renderTodoItem(t){const e=new Date,i=t.dueDate&&new Date(t.dueDate)<e,n=(t.dueDate&&(new Date(t.dueDate).toDateString(),e.toDateString()),i?"todo-item todo-overdue":"todo-item todo-incomplete"),o=t.tags&&t.tags.length>0?`<div class="todo-tags">${t.tags.map(t=>`<span class="todo-tag" onclick="tracker.searchByHashtag('${t}')">#${t}</span>`).join("")}</div>`:"",a=t.dueDate?`<span class="todo-due-date">Due: ${formatDateTime(t.dueDate)}</span>`:"",s=[`Created: ${formatDateTime(t.created)}`,a].filter(Boolean);return`\n            <div class="${n}">\n                <div class="todo-header">\n                    <div class="todo-content">\n                        <div class="todo-activity">${escapeHtml(t.activity)}</div>\n                        ${t.description?`<div class="todo-description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                        ${o}\n                        <div class="todo-meta">${s.join(" ‚Ä¢ ")}</div>\n                    </div>\n                    <div class="todo-actions">\n                        <button class="btn btn-success btn-small" onclick="tracker.completeEntry('${t.id}')" title="Mark as completed">Mark Complete</button>\n                        <button class="btn btn-secondary btn-small" onclick="tracker.editEntry('${t.id}')" title="Edit todo">Edit</button>\n                        <button class="btn btn-danger btn-small" onclick="tracker.deleteEntry('${t.id}')" title="Delete todo">Delete</button>\n                    </div>\n                </div>\n            </div>\n        `}updateTodoPagination(t){const e=document.getElementById("todoPagination"),i=document.getElementById("todoPrevBtn"),n=document.getElementById("todoNextBtn"),o=document.getElementById("todoPageInfo");if(!(e&&i&&n&&o))return;const a=Math.ceil(t/this.todoPagination.itemsPerPage);a<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.todoPagination.currentPage} of ${a}`,i.disabled=this.todoPagination.currentPage<=1,n.disabled=this.todoPagination.currentPage>=a)}updateEntriesPagination(t){const e=document.getElementById("entriesPagination"),i=document.getElementById("entriesPrevBtn"),n=document.getElementById("entriesNextBtn"),o=document.getElementById("entriesPageInfo");if(!(e&&i&&n&&o))return;const a=Math.ceil(t/this.entriesPagination.itemsPerPage);a<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.entriesPagination.currentPage} of ${a}`,i.disabled=this.entriesPagination.currentPage<=1,n.disabled=this.entriesPagination.currentPage>=a)}previousEntriesPage(){this.entriesPagination.currentPage>1&&(this.entriesPagination.currentPage--,this.displayEntries())}nextEntriesPage(){const t=Math.ceil(this.entries.length/this.entriesPagination.itemsPerPage);this.entriesPagination.currentPage<t&&(this.entriesPagination.currentPage++,this.displayEntries())}filterTodos(){const t=document.getElementById("todoFilter");t&&(this.todoPagination.filter=t.value,this.todoPagination.currentPage=1,this.displayTodos())}sortTodos(){const t=document.getElementById("todoSort");t&&(this.todoPagination.sort=t.value,this.todoPagination.currentPage=1,this.displayTodos())}previousTodoPage(){this.todoPagination.currentPage>1&&(this.todoPagination.currentPage--,this.displayTodos())}nextTodoPage(){const t=this.getFilteredTodos().length,e=Math.ceil(t/this.todoPagination.itemsPerPage);this.todoPagination.currentPage<e&&(this.todoPagination.currentPage++,this.displayTodos())}initSearch(){const t=document.getElementById("globalSearch"),e=document.getElementById("searchResults");if(!t||!e)return;let i;this.searchState={currentQuery:"",selectedIndex:-1,suggestions:[],searchPagination:{currentPage:1,itemsPerPage:this.settings.paginationSize||20,filter:"all",sort:"relevance"}},t.addEventListener("input",t=>{clearTimeout(i);const e=t.target.value.trim();0!==e.length?i=setTimeout(()=>{this.performSearch(e)},150):this.hideSearchSuggestions()}),t.addEventListener("keydown",e=>{const i=this.searchState.suggestions;"ArrowDown"===e.key?(e.preventDefault(),this.searchState.selectedIndex=Math.min(this.searchState.selectedIndex+1,i.length-1),this.updateSearchSuggestionSelection()):"ArrowUp"===e.key?(e.preventDefault(),this.searchState.selectedIndex=Math.max(this.searchState.selectedIndex-1,-1),this.updateSearchSuggestionSelection()):"Enter"===e.key?(e.preventDefault(),this.searchState.selectedIndex>=0?this.selectSearchSuggestion(this.searchState.selectedIndex):t.value.trim()&&this.showFullSearchResults(t.value.trim())):"Escape"===e.key&&(this.hideSearchSuggestions(),t.blur())}),document.addEventListener("click",i=>{t.contains(i.target)||e.contains(i.target)||this.hideSearchSuggestions()})}performSearch(t){this.searchState.currentQuery=t;const e=this.searchEntries(t,10);this.searchState.suggestions=e,this.showSearchSuggestions(e)}searchEntries(t,e=null){const i=t.toLowerCase().split(" "),n=[];return this.entries.forEach(t=>{let e=0;const o=(t.activity+" "+(t.description||"")+" "+(t.tags?t.tags.join(" "):"")).toLowerCase();i.forEach(i=>{t.activity.toLowerCase().includes(i)&&(e+=10),t.description&&t.description.toLowerCase().includes(i)&&(e+=5),t.tags&&t.tags.some(t=>t.includes(i))&&(e+=8),o.includes(i)&&(e+=1)}),e>0&&n.push({...t,searchScore:e})}),n.sort((t,e)=>e.searchScore-t.searchScore),e?n.slice(0,e):n}showSearchSuggestions(t){const e=document.getElementById("searchResults");e&&(0===t.length?e.innerHTML='<div class="search-suggestion">No results found</div>':e.innerHTML=t.map((t,e)=>{const i=t.tags&&t.tags.length>0?t.tags.map(t=>`<span class="search-hashtag">#${t}</span>`).join(""):"",n=t.isTodo?"üìã ":"",o=t.isTodo?"Todo":"Activity";return`\n                    <div class="search-suggestion" data-index="${e}" onclick="tracker.selectSearchSuggestion(${e})">\n                        <div class="search-suggestion-activity">${n}${escapeHtml(t.activity)}</div>\n                        <div class="search-suggestion-meta">${o} ‚Ä¢ ${formatDateTime(t.timestamp)} ${i}</div>\n                    </div>\n                `}).join(""),e.style.display="block",this.searchState.selectedIndex=-1)}hideSearchSuggestions(){const t=document.getElementById("searchResults");t&&(t.style.display="none"),this.searchState.selectedIndex=-1}updateSearchSuggestionSelection(){document.querySelectorAll(".search-suggestion").forEach((t,e)=>{e===this.searchState.selectedIndex?t.classList.add("selected"):t.classList.remove("selected")})}selectSearchSuggestion(t){const e=this.searchState.suggestions[t];e&&(this.editEntry(e.id),this.hideSearchSuggestions(),document.getElementById("globalSearch").value="")}showFullSearchResults(t){const e=this.searchEntries(t);this.searchState.searchPagination.filter="all",this.searchState.searchPagination.sort="relevance",this.searchState.searchPagination.currentPage=1,showSection("search");const i=document.getElementById("searchQuery"),n=document.getElementById("searchCount");i&&(i.textContent=`Search: "${t}"`),n&&(n.textContent=`${e.length} result${1!==e.length?"s":""}`),this.displaySearchResults(e),this.hideSearchSuggestions(),document.getElementById("globalSearch").value=""}displaySearchResults(t){const e=document.getElementById("searchResultsList"),i=this.searchState.searchPagination;if(!e)return;if(0===t.length)return e.innerHTML='<p class="empty-state">No results found. Try different search terms.</p>',void(document.getElementById("searchPagination").style.display="none");const n=(i.currentPage-1)*i.itemsPerPage,o=n+i.itemsPerPage,a=t.slice(n,o);e.innerHTML=a.map(t=>this.renderSearchResult(t)).join(""),this.updateSearchPagination(t.length)}renderSearchResult(t){new Date;t.isTodo&&t.dueDate&&new Date(t.dueDate);let e="search-result-item";t.isTodo?e+=" result-todo":e+=" result-completed";const i=t.tags&&t.tags.length>0?`<div class="search-result-tags">${t.tags.map(t=>`<span class="search-result-tag" onclick="tracker.searchByHashtag('${t}')">#${t}</span>`).join("")}</div>`:"",n=t.dueDate?`<span class="search-due-date">Due: ${formatDateTime(t.dueDate)}</span>`:"",o=[t.isTodo?"Todo":"Activity",`Created: ${formatDateTime(t.created)}`,n].filter(Boolean);return`\n            <div class="${e}">\n                <div class="search-result-header">\n                    <div class="search-result-content">\n                        <div class="search-result-activity">${escapeHtml(t.activity)}</div>\n                        ${t.description?`<div class="search-result-description">${this.renderDescriptionMarkdown(t.description)}</div>`:""}\n                        ${i}\n                        <div class="search-result-meta">${o.join(" ‚Ä¢ ")}</div>\n                    </div>\n                    <div class="search-result-actions">\n                        ${t.isTodo?`<button class="btn btn-success btn-small" onclick="tracker.completeEntry('${t.id}')" title="Mark as completed">Mark Complete</button>`:""}\n                        <button class="btn btn-secondary btn-small" onclick="tracker.editEntry('${t.id}')" title="Edit">Edit</button>\n                        <button class="btn btn-danger btn-small" onclick="tracker.deleteEntry('${t.id}')" title="Delete">Delete</button>\n                    </div>\n                </div>\n            </div>\n        `}updateSearchPagination(t){const e=document.getElementById("searchPagination"),i=document.getElementById("searchPrevBtn"),n=document.getElementById("searchNextBtn"),o=document.getElementById("searchPageInfo");if(!(e&&i&&n&&o))return;const a=Math.ceil(t/this.searchState.searchPagination.itemsPerPage);a<=1?e.style.display="none":(e.style.display="flex",o.textContent=`Page ${this.searchState.searchPagination.currentPage} of ${a}`,i.disabled=this.searchState.searchPagination.currentPage<=1,n.disabled=this.searchState.searchPagination.currentPage>=a)}sortSearchResults(){const t=document.getElementById("searchSort");t&&this.searchState.currentQuery&&(this.searchState.searchPagination.sort=t.value,this.searchState.searchPagination.currentPage=1,this.showFullSearchResults(this.searchState.currentQuery))}filterSearchResults(){const t=document.getElementById("searchFilter");t&&this.searchState.currentQuery&&(this.searchState.searchPagination.filter=t.value,this.searchState.searchPagination.currentPage=1,this.showFullSearchResults(this.searchState.currentQuery))}previousSearchPage(){this.searchState.searchPagination.currentPage>1&&(this.searchState.searchPagination.currentPage--,this.searchState.currentQuery&&this.showFullSearchResults(this.searchState.currentQuery))}nextSearchPage(){const t=this.searchEntries(this.searchState.currentQuery),e=Math.ceil(t.length/this.searchState.searchPagination.itemsPerPage);this.searchState.searchPagination.currentPage<e&&(this.searchState.searchPagination.currentPage++,this.searchState.currentQuery&&this.showFullSearchResults(this.searchState.currentQuery))}searchByHashtag(t){const e=`#${t}`;this.showFullSearchResults(e)}getHashtagFrequency(){const t={};return this.entries.forEach(e=>{e.tags&&e.tags.length>0&&e.tags.forEach(e=>{t[e]=(t[e]||0)+1})}),t}}function getWeekStart(t){const e=(t=new Date(t)).getDay(),i=t.getDate()-e+(0===e?-6:1);return new Date(t.setDate(i))}function getWeekEnd(t){const e=getWeekStart(t),i=new Date(e);return i.setDate(e.getDate()+6),i}let tracker,deferredPrompt;function showSection(t,e){if(document.querySelectorAll(".section").forEach(t=>{t.classList.remove("active")}),document.getElementById(t).classList.add("active"),document.querySelectorAll(".nav-btn").forEach(t=>{t.classList.remove("active")}),e&&e.target)e.target.classList.add("active");else{const e=document.querySelector(`.nav-btn[onclick*="'${t}'"]`);e&&e.classList.add("active")}if("tracker"===t&&setTimeout(()=>{const t=document.getElementById("activity");t&&t.focus()},100),"reports"===t){const t=document.getElementById("reportResults");!tracker||t&&t.innerHTML.trim()||tracker.setWeeklyReport()}}function addCurrentTime(){tracker&&tracker.setCurrentTime()}function generateSoundOptions(t=[],e=""){return Object.entries({classic:"Classic Bloop",gentle:"Gentle Chime",urgent:"Urgent Ping",digital:"Digital Beep",nature:"Nature Drop",mechanical:"Mechanical Click",spacey:"Spacey Wobble",corporate:"Corporate Ding",retro:"Retro Arcade",piano:"Piano Note",bell:"Temple Bell",whistle:"Train Whistle",bubble:"Bubble Pop",glass:"Glass Tap",wood:"Wood Block",metal:"Metal Ting",ethereal:"Ethereal Hum",cosmic:"Cosmic Blip",ocean:"Ocean Wave",forest:"Forest Chirp",failsafe:"Failsafe"}).filter(([e])=>!t.includes(e)).sort(([,t],[,e])=>t.localeCompare(e)).map(([t,i])=>`<option value="${t}"${t===e?" selected":""}>${i}</option>`).join("")}function generateReport(){tracker&&tracker.generateReport()}function setWeeklyReport(){tracker&&tracker.setWeeklyReport()}function previousWeek(){tracker&&tracker.previousWeek()}function nextWeek(){tracker&&tracker.nextWeek()}function downloadReport(){tracker&&tracker.downloadReport()}function saveSettings(){tracker&&tracker.saveSettings()}function enableNotifications(){tracker&&tracker.enableNotifications()}function testNotification(){tracker&&tracker.testNotification()}function testNotificationSound(){tracker&&tracker.testNotificationSound()}function previewNotificationSound(){const t=document.getElementById("notificationSoundType").value;tracker&&tracker.soundManager&&!tracker.isNotificationSoundMuted()&&tracker.soundManager.playSound(t,!1)}function showTemplateGuide(){const t=document.getElementById("templateGuideModal");t&&(t.style.display="block")}function closeTemplateGuide(){const t=document.getElementById("templateGuideModal");t&&(t.style.display="none")}function showAbout(){const t=document.getElementById("aboutModal");t&&(t.style.display="block",tracker&&tracker.updateAboutDebugInfo())}function closeAbout(){const t=document.getElementById("aboutModal");t&&(t.style.display="none")}function showUserGuide(){const t=document.getElementById("userGuideModal");t&&(t.style.display="block")}function closeUserGuide(){const t=document.getElementById("userGuideModal");t&&(t.style.display="none")}function setDueDate(t){const e=document.getElementById("dueDate");if(!e)return;const i=new Date;let n;switch(t){case"tomorrow":n=new Date(i),n.setDate(i.getDate()+1),n.setHours(9,0,0,0);break;case"nextWeek":n=new Date(i),n.setDate(i.getDate()+7),n.setHours(9,0,0,0);break;case"nextMonth":n=new Date(i),n.setMonth(i.getMonth()+1),n.setHours(9,0,0,0);break;default:return}e.value=n.toISOString().slice(0,16)}function setEditDueDate(t){const e=document.getElementById("editDueDate");if(!e)return;const i=new Date;let n;switch(t){case"tomorrow":n=new Date(i),n.setDate(i.getDate()+1),n.setHours(9,0,0,0);break;case"nextWeek":n=new Date(i),n.setDate(i.getDate()+7),n.setHours(9,0,0,0);break;case"nextMonth":n=new Date(i),n.setMonth(i.getMonth()+1),n.setHours(9,0,0,0);break;default:return}e.value=n.toISOString().slice(0,16)}function copyReportToClipboard(){const t=document.getElementById("reportPreview"),e=document.getElementById("reportPreviewTabRendered").classList.contains("active");let i="";if(e){const e=t.querySelector("iframe");i=e&&e.contentDocument?e.contentDocument.body.innerText||e.contentDocument.body.textContent:t.innerText||t.textContent}else i=t.innerText||t.textContent;i&&i.trim()?navigator.clipboard.writeText(i).then(()=>{showNotification("Report copied to clipboard!","success")}).catch(()=>{const t=document.createElement("textarea");t.value=i,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),showNotification("Report copied to clipboard!","success")}):showNotification("No report content to copy","error")}function refreshNotificationStatus(){tracker&&tracker.refreshNotificationStatus()}function clearAllData(){tracker&&tracker.clearAllData()}function closeEditModal(){tracker&&tracker.closeEditModal()}function closeModal(t){const e=document.getElementById(t);e&&(e.style.display="none")}function showHashtagBrowser(){const t=document.getElementById("hashtagBrowserModal");if(!t)return;const e=tracker.getHashtagFrequency(),i=t.querySelector(".hashtag-cloud");if(0===Object.keys(e).length)i.innerHTML="<p>No hashtags found in your entries.</p>";else{const t=Math.max(...Object.values(e)),n=Math.min(...Object.values(e)),o=t-n||1,a=Object.entries(e).sort(([,t],[,e])=>e-t).map(([t,e])=>{const i=(e-n)/o;return`<span class="hashtag-cloud-item" \n                              style="font-size: ${.8+1.2*i}em; opacity: ${.6+.4*i};"\n                              onclick="tracker.searchByHashtag('${t}'); closeModal('hashtagBrowserModal');"\n                              title="${e} occurrence${1!==e?"s":""}">#${t}</span>`}).join(" ");i.innerHTML=a}t.style.display="block"}function closeHashtagBrowser(){closeModal("hashtagBrowserModal")}function toggleTodoMode(){const t=document.getElementById("todoToggleBtn");t&&(t.classList.contains("active")?(t.classList.remove("active"),t.textContent="Add as Todo"):(t.classList.add("active"),t.textContent="‚úì Todo Mode"))}function isTodoModeActive(){const t=document.getElementById("todoToggleBtn");return!!t&&t.classList.contains("active")}function closePomodoroActivityModal(){const t=document.getElementById("pomodoroActivityModal");t&&(t.style.display="none",document.getElementById("pomodoroActivityForm").reset())}function showPomodoroActivityModal(){const t=document.getElementById("pomodoroActivityModal");t&&(t.style.display="block",setTimeout(()=>{const t=document.getElementById("pomodoroActivityName");t&&t.focus()},100))}function togglePause(){tracker&&tracker.togglePause()}function togglePomodoro(){tracker&&tracker.pomodoroManager&&tracker.pomodoroManager.togglePomodoroFromButton()}function togglePomodoroPause(){tracker&&tracker.pomodoroManager&&tracker.pomodoroManager.togglePause()}function testPomodoroTick(t="soft"){tracker&&tracker.pomodoroManager?(tracker.pomodoroManager.settings.tickSound=t,tracker.pomodoroManager.playTickSound()):console.error("Tracker or Pomodoro Manager not available")}function saveReportTemplates(){tracker&&tracker.saveReportTemplates()}function resetReportTemplates(){tracker&&tracker.resetReportTemplates()}function exportDatabase(){tracker&&tracker.exportDatabase()}function importDatabase(){const t=document.getElementById("importFile");t&&t.click()}function handleImportFile(t){const e=t.target.files[0];if(!e)return;if("application/json"!==e.type&&!e.name.endsWith(".json"))return void showNotification("Please select a valid JSON backup file.","error");const i=new FileReader;i.onload=function(e){tracker&&tracker.importDatabase(e.target.result),t.target.value=""},i.onerror=function(){showNotification("Error reading backup file.","error"),t.target.value=""},i.readAsText(e)}function openTemplateManager(){tracker&&tracker.openTemplateManager()}function closeTemplateManager(){tracker&&tracker.closeTemplateManager()}function addNewTemplate(){tracker&&tracker.addNewTemplate()}function resetToDefaults(){tracker&&tracker.resetToDefaults()}function saveCurrentTemplate(){tracker&&tracker.saveCurrentTemplate()}function deleteCurrentTemplate(){tracker&&tracker.deleteCurrentTemplate()}function duplicateCurrentTemplate(){tracker&&tracker.duplicateCurrentTemplate()}function refreshTemplatePreview(){tracker&&tracker.refreshTemplatePreview()}function saveAllTemplates(){tracker&&tracker.saveAllTemplates()}function switchPreviewTab(t){tracker&&tracker.switchPreviewTab(t)}function switchReportPreviewTab(t){tracker&&tracker.switchReportPreviewTab(t)}function switchTemplateTab(t){tracker&&tracker.switchTemplateTab(t)}async function runServiceWorkerTest(){if(tracker){showNotification("Running Service Worker diagnostics...","info");try{const t=await tracker.runServiceWorkerDiagnostics();let e="Service Worker Diagnostics:\n\n";e+=`Available: ${t.available}\n`,e+=`Protocol: ${t.protocol}\n`,e+=`Platform: ${t.platform}\n`,t.registration?(e+="Registration: Active\n",e+=`Scope: ${t.registration.scope}\n`):e+="Registration: None\n",t.controller?e+=`Controller: Active (${t.controller.state})\n`:e+="Controller: None\n",t.communication&&(e+=`Communication: ${t.communication}\n`),t.swVersion&&(e+=`SW Version: ${t.swVersion}\n`),t.error&&(e+=`Error: ${t.error}\n`),alert(e);const i=t.available&&t.registration?"success":"warning";showNotification(t.available&&t.registration?"Service Worker is working correctly":"Service Worker issues detected (see console)",i)}catch(t){console.error("Diagnostic test failed:",t),showNotification("Diagnostic test failed: "+t.message,"error")}}else showNotification("Tracker not initialized","error")}Object.assign(ActivityTracker.prototype,{initReportTemplates(){this.templatingEngine=new TemplatingEngine;const t=document.getElementById("reportTemplate");if(!t)return;const e=this.getReportTemplates(),i=window.ReportTemplates||{};t.innerHTML=Object.keys(e).map(t=>{const n=e[t];return`<option value="${t}">${i[t]?n.name:`${n.name} (Custom)`}</option>`}).join("")},prepareReportData(t,e,i){const n=[...t].sort((t,e)=>new Date(t.timestamp)-new Date(e.timestamp)),o=n.map((t,e)=>{t.timestamp||console.error("Entry missing timestamp:",t);const i=n[e+1];let o,a;if(i)o=new Date(i.timestamp),a=Math.round((o-new Date(t.timestamp))/6e4);else{const e=new Date(t.timestamp),[i,n]=this.settings.endTime.split(":").map(Number);e.setHours(i,n,0,0),o=new Date(Math.min(new Date,e)),a=Math.round((o-new Date(t.timestamp))/6e4)}return{...t,endTime:o,duration:a}}),a={};o.forEach(t=>{const e=new Date(t.timestamp).toLocaleDateString("en-GB",{weekday:"long",year:"numeric",month:"long",day:"numeric"});a[e]||(a[e]={entries:[],totalDuration:0}),a[e].entries.push(t),a[e].totalDuration+=t.duration>0?t.duration:0});const s=Object.keys(a).map(t=>({date:t,entries:a[t].entries,totalDuration:a[t].totalDuration})),r=s.reduce((t,e)=>t+e.totalDuration,0);return{report:{startDate:e,endDate:i,generatedDate:new Date,totalEntries:o.length,totalDuration:r,activeDays:s.length},days:s,entries:o}},renderReport(t,e){return this.templatingEngine.render(t,e)},generateReport(){const t=document.getElementById("reportStartDate").value,e=document.getElementById("reportEndDate").value;if(!t||!e)return void showNotification("Please select both start and end dates","error");const i=new Date(t),n=new Date(e);n.setHours(23,59,59,999);const o=document.getElementById("includeIncompleteTodos")?.checked||!1,a=this.entries.filter(t=>{const e=new Date(t.timestamp),a=e>=i&&e<=n;return!(t.isTodo&&!o)&&a});this.currentReportEntries=a,this.currentReportData=this.prepareReportData(a,i,n),this.previewReport()},previewReport(){const t=document.getElementById("reportPreview");if(!t)return;const e=document.getElementById("copyReportBtn");if(!this.currentReportData||0===this.currentReportEntries.length)return t.innerHTML="No data for the selected period. Generate a report first.",void(e&&(e.style.display="none"));const i=document.getElementById("reportTemplate").value,n=this.getReportTemplates()[i];if(!n)return t.textContent="Error: Selected report template not found.",void(e&&(e.style.display="none"));const o=document.getElementById("reportPreviewTabRendered"),a=o&&o.classList.contains("active");try{const i=this.renderReport(n.template,this.currentReportData);if(a)if("html"===n.type)t.innerHTML=`<iframe srcdoc="${this.templatingEngine.escapeHtml(i)}" style="width: 100%; height: 450px; border: none;"></iframe>`;else if("markdown"===n.type&&this.markdownRenderer){const e=this.markdownRenderer.render(i);t.innerHTML=e}else t.innerHTML=`<pre>${this.templatingEngine.escapeHtml(i)}</pre>`;else t.innerHTML=`<pre>${this.templatingEngine.escapeHtml(i)}</pre>`;e&&(e.style.display="inline-block")}catch(i){t.textContent="Error generating preview: "+i.message,e&&(e.style.display="none")}},downloadReport(){if(!this.currentReportData||0===this.currentReportEntries.length)return void showNotification("Please generate a report with data first","error");const t=document.getElementById("reportTemplate").value,e=this.getReportTemplates()[t],i=this.currentReportData.report.startDate,n=this.currentReportData.report.endDate,o=this.renderReport(e.template,this.currentReportData),a=e.type,s={html:"text/html",markdown:"text/markdown",csv:"text/csv"}[a]||"text/plain";downloadFile(o,`activity-report-${this.templatingEngine.formatDate(i,"yyyy-mm-dd")}-to-${this.templatingEngine.formatDate(n,"yyyy-mm-dd")}.${a}`,s),showNotification(`Report downloaded as ${e.name}`,"success")},setWeeklyReport(){const t=new Date;this.currentWeekStart=getWeekStart(t),this.updateWeekFromCurrent(),this.generateReport()},previousWeek(){this.currentWeekStart||(this.currentWeekStart=getWeekStart(new Date)),this.currentWeekStart.setDate(this.currentWeekStart.getDate()-7),this.updateWeekFromCurrent(),this.generateReport()},nextWeek(){this.currentWeekStart||(this.currentWeekStart=getWeekStart(new Date)),this.currentWeekStart.setDate(this.currentWeekStart.getDate()+7),this.updateWeekFromCurrent(),this.generateReport()},updateWeekFromCurrent(){const t=new Date(this.currentWeekStart),e=getWeekEnd(t);document.getElementById("reportStartDate").value=t.toISOString().split("T")[0],document.getElementById("reportEndDate").value=e.toISOString().split("T")[0],this.updateWeekDisplay()},updateWeekDisplay(){if(!this.currentWeekStart)return;const t=new Date(this.currentWeekStart),e=getWeekEnd(t),i=`Week of ${t.toLocaleDateString("en-GB",{day:"numeric",month:"short"})} - ${e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}`;document.getElementById("weekDisplay").textContent=i}}),document.addEventListener("DOMContentLoaded",()=>{tracker=new ActivityTracker,"serviceWorker"in navigator&&("file:"===window.location.protocol||navigator.serviceWorker.register("./sw.js").then(t=>{t.addEventListener("updatefound",()=>{const e=t.installing;e&&e.addEventListener("statechange",()=>{"installed"===e.state&&navigator.serviceWorker.controller&&showNotification("App updated! Refresh for latest version.","info",1e4)})}),tracker&&tracker.updateDebugInfo()}).catch(t=>{console.error("‚ùå Service Worker registration failed:",t),navigator.platform.includes("Mac")&&"SecurityError"===t.name&&(console.warn("üçé macOS Security Error: This may be due to strict security settings"),console.warn("üí° Try serving over HTTP/HTTPS instead of file://")),tracker&&tracker.updateDebugInfo()}),navigator.serviceWorker.addEventListener("message",t=>{t.data&&"add-entry"===t.data.type&&tracker&&(tracker.addEntry(t.data.entry),showNotification("Activity logged from notification!","success")),t.data&&"navigate-to-tracker"===t.data.type&&showSection("tracker")}),navigator.serviceWorker.addEventListener("controllerchange",()=>{tracker&&tracker.updateDebugInfo()})),"#tracker"===window.location.hash&&(showSection("tracker"),history.replaceState(null,document.title,window.location.pathname+window.location.search))}),document.addEventListener("click",t=>{t.target.classList.contains("modal")&&("templateGuideModal"===t.target.id?closeTemplateGuide():"aboutModal"===t.target.id?closeAbout():"pomodoroActivityModal"===t.target.id?closePomodoroActivityModal():"hashtagBrowserModal"===t.target.id?closeHashtagBrowser():"userGuideModal"===t.target.id?closeUserGuide():closeEditModal())}),document.addEventListener("keydown",t=>{if("Escape"===t.key){const t=document.getElementById("templateGuideModal"),e=document.getElementById("aboutModal"),i=document.getElementById("editModal"),n=document.getElementById("pomodoroActivityModal"),o=document.getElementById("hashtagBrowserModal"),a=document.getElementById("userGuideModal");t&&"block"===t.style.display?closeTemplateGuide():e&&"block"===e.style.display?closeAbout():n&&"block"===n.style.display?closePomodoroActivityModal():o&&"block"===o.style.display?closeHashtagBrowser():a&&"block"===a.style.display?closeUserGuide():i&&"block"===i.style.display&&closeEditModal()}if(t.shiftKey&&"Enter"===t.key){const e=document.activeElement;if(e&&("activity"===e.id||"description"===e.id)){t.preventDefault();const e=document.getElementById("todoToggleBtn");e&&!e.classList.contains("active")&&(e.classList.add("active"),e.textContent="‚úì Todo Mode");const i=document.getElementById("activityForm");i&&i.dispatchEvent(new Event("submit"))}return}if((t.ctrlKey||t.metaKey)&&"Enter"===t.key){const t=document.activeElement;if(t&&("activity"===t.id||"description"===t.id)){const t=document.getElementById("activityForm");t&&t.dispatchEvent(new Event("submit"))}if(t&&("editActivity"===t.id||"editDescription"===t.id||"editTimestamp"===t.id)){const t=document.getElementById("editForm");t&&t.dispatchEvent(new Event("submit"))}if(t&&("pomodoroActivityName"===t.id||"pomodoroActivityDescription"===t.id)){const t=document.getElementById("pomodoroActivityForm");t&&t.dispatchEvent(new Event("submit"))}}}),document.addEventListener("visibilitychange",()=>{tracker&&(document.hidden||tracker.updateDebugInfo())}),window.addEventListener("online",()=>{showNotification("Connection restored","success")}),window.addEventListener("offline",()=>{showNotification("Working offline","info")}),window.addEventListener("beforeunload",t=>{tracker&&tracker.pauseManager&&tracker.pauseManager.destroy();const e=document.getElementById("activity");if(e&&e.value.trim())return t.preventDefault(),t.returnValue="You have unsaved activity data. Are you sure you want to leave?",t.returnValue}),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),deferredPrompt=t,showNotification("This app can be installed on your device!","info")}),window.addEventListener("appinstalled",()=>{showNotification("Activity Tracker installed successfully!","success"),deferredPrompt=null}),window.addEventListener("error",t=>{console.error("‚ùå Uncaught error:",t.error),showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("unhandledrejection",t=>{console.error("‚ùå Unhandled promise rejection:",t.reason),showNotification("An unexpected error occurred. Please refresh the page.","error")}),window.addEventListener("load",()=>{if(window.performance&&window.performance.timing){const t=window.performance.timing;t.loadEventEnd,t.navigationStart}}),"undefined"!=typeof module&&module.exports&&(module.exports={showSection:showSection,addCurrentTime:addCurrentTime,generateReport:generateReport,setWeeklyReport:setWeeklyReport,previousWeek:previousWeek,nextWeek:nextWeek,downloadReport:downloadReport,saveSettings:saveSettings,enableNotifications:enableNotifications,testNotification:testNotification,testNotificationSound:testNotificationSound,refreshNotificationStatus:refreshNotificationStatus,clearAllData:clearAllData,closeEditModal:closeEditModal,togglePause:togglePause,exportDatabase:exportDatabase,importDatabase:importDatabase,handleImportFile:handleImportFile,runServiceWorkerTest:runServiceWorkerTest,previewNotificationSound:previewNotificationSound,showTemplateGuide:showTemplateGuide,closeTemplateGuide:closeTemplateGuide,showAbout:showAbout,closeAbout:closeAbout,copyReportToClipboard:copyReportToClipboard});</script></body></html>